var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();!function(e){var t=function(){function e(){}return e.setDbType=function(){self.indexedDB=self.indexedDB||self.mozIndexedDB||self.webkitIndexedDB||self.msIndexedDB,indexedDB?(self.IDBTransaction=self.IDBTransaction||self.webkitIDBTransaction||self.msIDBTransaction,self.IDBKeyRange=self.IDBKeyRange||self.webkitIDBKeyRange||self.msIDBKeyRange):self.alert?JsStore.Status={ConStatus:JsStore.ConnectionStatus.UnableToStart,LastError:JsStore.ErrorType.IndexedDbUndefined}:self.postMessage("message:WorkerFailed")},e}();e.Utils=t}(KeyStore||(KeyStore={}));!function(e){!function(e){e.Connected="connected",e.Closed="closed",e.NotStarted="not_connected"}(e.ConnectionStatus||(e.ConnectionStatus={})),e.RequestQueue=[],e.TableName="LocalStore",e.IsCodeExecuting=!1}(KeyStore||(KeyStore={}));!function(e){e.prcoessExecutionOfCode=function(t){e.RequestQueue.push(t),1==e.RequestQueue.length&&e.executeCode()},e.executeCode=function(){if(!e.IsCodeExecuting&&e.RequestQueue.length>0){e.IsCodeExecuting=!0;var t={Name:e.RequestQueue[0].Name,Query:e.RequestQueue[0].Query};e.executeCodeDirect(t)}},e.executeCodeDirect=function(t){var n=this;new e.Business.Main(function(e){n.processFinishedRequest(e)}).checkConnectionAndExecuteLogic(t)},e.processFinishedRequest=function(t){var n=e.RequestQueue.shift();e.IsCodeExecuting=!1,t.ErrorOccured?n.OnError&&n.OnError(t.ErrorDetails):n.OnSuccess&&(null!=t.ReturnedValue?n.OnSuccess(t.ReturnedValue):n.OnSuccess()),this.executeCode()}}(KeyStore||(KeyStore={}));!function(e){!function(e){var t=function(){return function(){this.Results=null,this.ErrorOccured=!1,this.ErrorCount=0,this.onErrorOccured=function(e){++this.ErrorCount,1==this.ErrorCount&&null!=this.OnError&&this.OnError(e.target.error)}}}();e.Base=t}(e.Business||(e.Business={}))}(KeyStore||(KeyStore={}));!function(e){!function(e){var t=function(t){function n(n,r,o){var s=t.call(this)||this;s.get=function(){var e=this,t=function(t,n){var r=e.ObjectStore.index(t).openCursor(IDBKeyRange.only(n));r.onerror=function(t){e.ErrorOccured=!0,e.onErrorOccured(t)},r.onsuccess=function(t){var n=t.target.result;n&&(e.Results=n.value.Value)}};for(var n in this.Query.Where){t(n,this.Query.Where[n]);break}};var u=s;return s.Query=n,s.OnError=o,s.Transaction=e.DbConnection.transaction([n.From],"readonly"),s.ObjectStore=s.Transaction.objectStore(n.From),s.Transaction.oncomplete=function(e){null!=r&&r(u.Results)},s.get(),s}return __extends(n,t),n}(e.Base);e.Get=t}(e.Business||(e.Business={}))}(KeyStore||(KeyStore={}));!function(e){!function(e){var t=function(t){function n(n,r,o){var s=t.call(this)||this;s.setData=function(e){var t=this,n=function(){t.ObjectStore.add(e).onerror=function(e){t.ErrorOccured=!0,t.onErrorOccured(e)}};!function(){var r=t.ObjectStore.index("Key").openCursor(IDBKeyRange.only(e.Key));r.onsuccess=function(t){var r=t.target.result;r?(r.value.Value=e.Value,r.update(r.value)):n()},r.onerror=function(e){t.ErrorOccured=!0,t.onErrorOccured(e)}}()};try{s.OnError=o,s.Transaction=e.DbConnection.transaction([n.TableName],"readwrite"),s.ObjectStore=s.Transaction.objectStore(n.TableName),s.Transaction.oncomplete=function(e){null!=r&&r()},s.setData(n.Set)}catch(e){}return s}return __extends(n,t),n}(e.Base);e.Set=t}(e.Business||(e.Business={}))}(KeyStore||(KeyStore={}));!function(e){!function(e){var t=function(t){function n(n,r,o){var s=t.call(this)||this;s.RowAffected=0,s.remove=function(){var e=this,t=function(t,n){var r=e.ObjectStore.index(t).openCursor(IDBKeyRange.only(n));r.onerror=function(t){e.ErrorOccured=!0,e.onErrorOccured(t)},r.onsuccess=function(t){var n=t.target.result;n&&(n.delete(),++e.RowAffected,n.continue())}};for(var n in this.Query.Where){e.ErrorOccured||t(n,e.Query.Where[n]);break}};var u=s;return s.Query=n,s.OnError=o,s.Transaction=e.DbConnection.transaction([n.From],"readwrite"),s.ObjectStore=s.Transaction.objectStore(n.From),s.Transaction.oncomplete=function(){null!=r&&r(u.RowAffected)},s.Transaction.onerror=function(e){u.onErrorOccured(e)},s.remove(),s}return __extends(n,t),n}(e.Base);e.Remove=t}(e.Business||(e.Business={}))}(KeyStore||(KeyStore={}));!function(e){!function(t){var n=function(){return function(n,r,o,s){var u=self.indexedDB.open(n,1);u.onerror=function(e){"InvalidStateError"==e.target.error.name&&(JsStore.Status={ConStatus:JsStore.ConnectionStatus.UnableToStart,LastError:JsStore.ErrorType.IndexedDbBlocked}),null!=s&&s(e.target.error)},u.onsuccess=function(n){t.Status.ConStatus=e.ConnectionStatus.Connected,t.DbConnection=u.result,t.DbConnection.onclose=function(){t.Status.ConStatus=e.ConnectionStatus.Closed,t.Status.LastError="Connection Closed"},t.DbConnection.onversionchange=function(e){null===e.newVersion&&e.target.close()},t.DbConnection.onerror=function(e){t.Status.LastError="Error occured in connection :"+e.target.result},t.DbConnection.onabort=function(n){t.Status.ConStatus=e.ConnectionStatus.Closed,t.Status.LastError="Connection aborted"},null!=o&&o()},u.onupgradeneeded=function(e){e.target.result.createObjectStore(r,{keyPath:"Key"}).createIndex("Key","Key",{unique:!0})}}}();t.InitDb=n}(e.Business||(e.Business={}))}(KeyStore||(KeyStore={}));!function(e){!function(t){t.Status={ConStatus:e.ConnectionStatus.NotStarted,LastError:""};var n=function(){return function(n){void 0===n&&(n=null),this.checkConnectionAndExecuteLogic=function(n){if("create_db"==n.Name||"open_db"==n.Name)this.executeLogic(n);else if(t.Status.ConStatus==e.ConnectionStatus.Connected)this.executeLogic(n);else if(t.Status.ConStatus==e.ConnectionStatus.NotStarted)r=this,setTimeout(function(){r.checkConnectionAndExecuteLogic(n)},100);else if(t.Status.ConStatus==e.ConnectionStatus.Closed){var r=this;this.createDb(e.TableName,function(){r.checkConnectionAndExecuteLogic(n)},100)}},this.returnResult=function(e){this.OnSuccess&&this.OnSuccess(e)},this.executeLogic=function(e){var t=this,n=function(e){t.returnResult({ReturnedValue:e})},r=function(e){t.returnResult({ErrorOccured:!0,ErrorDetails:e})};switch(e.Name){case"get":this.get(e.Query,n,r);break;case"set":this.set(e.Query,n,r);break;case"remove":this.remove(e.Query,n,r);break;case"create_db":this.createDb(e.Query,n,r)}},this.set=function(e,n,r){new t.Set(e,n,r)},this.remove=function(e,n,r){new t.Remove(e,n,r)},this.get=function(e,n,r){new t.Get(e,n,r)},this.createDb=function(e,n,r){new t.InitDb("KeyStore",e,n,r)},this.OnSuccess=n}}();t.Main=n}(e.Business||(e.Business={}))}(KeyStore||(KeyStore={}));var KeyStore;!function(e){e.init=function(){e.Utils.setDbType(),indexedDB&&e.prcoessExecutionOfCode({Name:"create_db",Query:e.TableName})},e.get=function(t,n,r){void 0===r&&(r=null);var o={From:this.TableName,Where:{Key:t}};return e.prcoessExecutionOfCode({Name:"get",Query:o,OnSuccess:n,OnError:r}),this},e.set=function(t,n,r,o){void 0===r&&(r=null),void 0===o&&(o=null);var s={TableName:this.TableName,Set:{Key:t,Value:n}};return e.prcoessExecutionOfCode({Name:"set",Query:s,OnSuccess:r,OnError:o}),this},e.remove=function(t,n,r){void 0===n&&(n=null),void 0===r&&(r=null);var o={From:this.TableName,Where:{Key:t}};return e.prcoessExecutionOfCode({Name:"remove",Query:o,OnSuccess:n,OnError:r}),this}}(KeyStore||(KeyStore={}));!function(e){!function(e){e.UndefinedColumn="undefined_column",e.UndefinedValue="undefined_value",e.UndefinedColumnName="undefined_column_name",e.UndefinedColumnValue="undefined_column_value",e.NotArray="not_array",e.NoValueSupplied="no_value_supplied",e.ColumnNotExist="column_not_exist",e.InvalidOp="invalid_operator",e.NullValue="null_value",e.BadDataType="bad_data_type",e.NextJoinNotExist="next_join_not_exist",e.TableNotExist="table_not_exist",e.DbNotExist="db_not_exist",e.IndexedDbUndefined="indexeddb_undefined",e.IndexedDbBlocked="indexeddb_blocked"}(e.ErrorType||(e.ErrorType={}));!function(e){e.First="f",e.Last="l",e.Any="a"}(e.Occurence||(e.Occurence={}));!function(e){e.Registered="registerd",e.Failed="failed",e.NotStarted="not_started"}(e.WebWorkerStatus||(e.WebWorkerStatus={}));!function(e){e.Connected="connected",e.Closed="closed",e.NotStarted="not_started",e.UnableToStart="unable_to_start"}(e.ConnectionStatus||(e.ConnectionStatus={}));!function(e){e.In="In",e.Like="Like",e.Or="Or"}(e.WhereQryOption||(e.WhereQryOption={}));!function(e){e.String="string",e.Object="object",e.Array="array"}(e.DataType||(e.DataType={}))}(JsStore||(JsStore={}));!function(e){e.EnableLog=!1,e.DbVersion=0,e.Status={ConStatus:e.ConnectionStatus.NotStarted,LastError:""},e.TempResults=[],e.throwError=function(e){throw e},e.getObjectFirstKey=function(e){for(var t in e)return t;return null},e.log=function(t){e.EnableLog},e.logError=function(t){e.EnableLog}}(JsStore||(JsStore={}));!function(e){var t=function(){function t(){}return t.getError=function(t,n){var r={Name:t,Message:""};switch(t){case e.ErrorType.NotArray:r.Message="Supplied value is not an array";break;case e.ErrorType.UndefinedColumn:r.Message="Column is undefined in Where";break;case e.ErrorType.UndefinedValue:r.Message="Value is undefined in Where";break;case e.ErrorType.UndefinedColumnName:r.Message="Column name is undefined";break;case e.ErrorType.UndefinedColumnValue:r.Message="Column value is undefined";break;case e.ErrorType.NoValueSupplied:r.Message="No value supplied";break;case e.ErrorType.InvalidOp:r.Message="Invalid Op Value '"+n.Op+"'";break;case e.ErrorType.ColumnNotExist:r.Message="Column '"+n.ColumnName+"' does not exist";break;case e.ErrorType.NullValue:r.Message="Null value is not allowed for column '"+n.ColumnName+"'";break;case e.ErrorType.BadDataType:r.Message="Supplied value for column '"+n.ColumnName+"' does not have valid type";break;case e.ErrorType.NextJoinNotExist:r.Message="Next join details not supplied";break;case e.ErrorType.TableNotExist:r.Message="Table '"+n.TableName+"' does not exist";break;case e.ErrorType.DbNotExist:r.Message="Database '"+n.DbName+"' does not exist"}return r},t.convertObjectintoLowerCase=function(e){for(var t=Object.keys(e),n=t.length;n--;){var r=t[n];e[r.toLowerCase()]=e[r],delete e[r]}},t.setDbType=function(){self.indexedDB=self.indexedDB||self.mozIndexedDB||self.webkitIndexedDB||self.msIndexedDB,indexedDB?(self.IDBTransaction=self.IDBTransaction||self.webkitIDBTransaction||self.msIDBTransaction,self.IDBKeyRange=self.IDBKeyRange||self.webkitIDBKeyRange||self.msIDBKeyRange):e.throwError("Your browser doesnot support IndexedDb")},t}();e.Utils=t}(JsStore||(JsStore={}));!function(e){e.isDbExist=function(t,n,r){void 0===r&&(r=null);var o=!n;if(e.Status.ConStatus!=e.ConnectionStatus.UnableToStart){if(o)return new Promise(function(n,r){"string"==typeof t?e.getDbVersion(t,function(e){n(Boolean(e))}):e.getDbVersion(t.DbName,function(e){n(t.Table.Version<=e)})});"string"==typeof t?e.getDbVersion(t,function(e){n(Boolean(e))}):e.getDbVersion(t.DbName,function(e){n(t.Table.Version<=e)})}else{var s={Name:e.Status.LastError,Message:""};switch(s.Name){case e.ErrorType.IndexedDbBlocked:s.Message="IndexedDB is blocked";break;case e.ErrorType.IndexedDbUndefined:s.Message="IndexedDB is not supported"}if(o)return new Promise(function(e,t){t(s)});r&&r(s)}},e.getDbVersion=function(e,t){KeyStore.get("JsStore_"+e+"_Db_Version",function(e){t(Number(e))})},e.getDbSchema=function(e,t){t&&KeyStore.get("JsStore_"+e+"_Schema",function(e){t(e)})},e.isNull=function(e){if(null==e)return!0;switch(typeof e){case"string":return 0==e.length;case"number":return isNaN(e)}return!1},e.enableLog=function(){e.EnableLog=!0,e.WorkerInstance&&e.WorkerInstance.postMessage({Name:"change_log_status",Query:{logging:e.EnableLog}})},e.disableLog=function(){e.EnableLog=!1,e.WorkerInstance&&e.WorkerInstance.postMessage({Name:"change_log_status",Query:{logging:e.EnableLog}})}}(JsStore||(JsStore={}));!function(e){!function(t){var n=function(){return function(t,n){null!=t.Name?this.Name=t.Name:e.throwError("Column Name is not defined for table:"+n),this.AutoIncrement=null!=t.AutoIncrement&&t.AutoIncrement,this.PrimaryKey=null!=t.PrimaryKey&&t.PrimaryKey,this.Unique=null!=t.Unique&&t.Unique,this.NotNull=null!=t.NotNull&&t.NotNull,this.DataType=null!=t.DataType?t.DataType:t.AutoIncrement?"number":null,this.Default=t.Default}}();t.Column=n}(e.Model||(e.Model={}))}(JsStore||(JsStore={}));!function(e){!function(t){var n=function(){function n(e,n){this.Name="",this.Columns=[],this.RequireDelete=!1,this.RequireCreation=!1,this.PrimaryKey="",this.Name=e.Name,this.Version=void 0==e.Version?1:e.Version;var r=this;e.Columns.forEach(function(n){r.Columns.push(new t.Column(n,e.Name))}),this.setRequireDelete(n),this.setDbVersion(n),this.setPrimaryKey(n)}return n.prototype.setPrimaryKey=function(e){var t=this;this.Columns.forEach(function(e){e.PrimaryKey&&(t.PrimaryKey=e.Name)})},n.prototype.setRequireDelete=function(e){var t=this;KeyStore.get("JsStore_"+e+"_"+this.Name+"_Version",function(e){null==e?t.RequireCreation=!0:e<t.Version&&(t.RequireDelete=!0)})},n.prototype.setDbVersion=function(t){e.DbVersion=e.DbVersion>this.Version?e.DbVersion:this.Version,KeyStore.set("JsStore_"+t+"_Db_Version",e.DbVersion).set("JsStore_"+t+"_"+this.Name+"_Version",e.DbVersion),this.Version=e.DbVersion},n}();t.Table=n}(e.Model||(e.Model={}))}(JsStore||(JsStore={}));!function(e){!function(e){var t=function(){return function(t){this.Tables=[];var n=this;this.Name=t.Name,t.Tables.forEach(function(t){n.Tables.push(new e.Table(t,n.Name))})}}();e.DataBase=t}(e.Model||(e.Model={}))}(JsStore||(JsStore={}));!function(e){!function(e){var t=function(){function t(){this.getTable=function(t){var n;return e.ActiveDataBase.Tables.every(function(e){return e.Name!=t||(n=e,!1)}),n},this.getKeyRange=function(e,t){var n;switch(t){case"-":n=IDBKeyRange.bound(e.Low,e.High,!1,!1);break;case">":n=IDBKeyRange.lowerBound(e,!0);break;case">=":n=IDBKeyRange.lowerBound(e);break;case"<":n=IDBKeyRange.upperBound(e,!0);break;case"<=":n=IDBKeyRange.upperBound(e);break;default:n=IDBKeyRange.only(e)}return n},this.getObjectSecondKey=function(e){var t=!1;for(var n in e){if(t)return n;t=!0}},this.getPrimaryKey=function(e){var t=this.getTable(e).PrimaryKey;return t||this.getKeyPath()},this.getKeyPath=function(t){return e.DbConnection.transaction([t],"readonly").objectStore(t).keyPath},this.sortNumberInAsc=function(e){return e.sort(function(e,t){return e-t}),e},this.sortNumberInDesc=function(e){return e.sort(function(e,t){return t-e}),e},this.sortAlphabetInAsc=function(e){return e.sort(function(e,t){return e.toLowerCase().localeCompare(t.toLowerCase())}),e},this.sortAlphabetInDesc=function(e){return e.sort(function(e,t){return t.toLowerCase().localeCompare(e.toLowerCase())}),e}}return t.prototype.getCombination=function(e){var t=[],n=function(e,r,o){if(o==e.length)t.push(r.join(""));else{var s=e.charAt(o);r[o]=s.toLowerCase(),n(e,r,o+1),r[o]=s.toUpperCase(),n(e,r,o+1)}};return n(e,[],0),t},t.prototype.getAllCombinationOfWord=function(e,t){if(t){for(var n=[],r=0,o=e.length;r<o;r++)n=n.concat(this.getCombination(e[r]));return n}return this.getCombination(e)},t}();e.BaseHelper=t}(e.Business||(e.Business={}))}(JsStore||(JsStore={}));!function(e){!function(t){var n=function(t){function n(){var n=null!==t&&t.apply(this,arguments)||this;return n.ErrorOccured=!1,n.ErrorCount=0,n.RowAffected=0,n.SendResultFlag=!0,n.onErrorOccured=function(t,n){if(void 0===n&&(n=!1),++this.ErrorCount,1==this.ErrorCount&&null!=this.OnError){if(n)this.OnError(t);else{var r={Name:t.target.error.name,Message:t.target.error.message};this.OnError(r)}e.logError(r)}},n.onTransactionTimeout=function(e){},n.onExceptionOccured=function(t,n){switch(t.name){case"NotFoundError":var r=e.Utils.getError(e.ErrorType.TableNotExist,n);e.throwError(r)}},n.goToWhereLogic=function(){var t=e.getObjectFirstKey(this.Query.Where);if(!0===this.Query.IgnoreCase&&(this.Query.Where=this.makeQryInCaseSensitive(this.Query.Where)),this.ObjectStore.indexNames.contains(t)){var n=this.Query.Where[t];if("object"==typeof n){this.CheckFlag=Boolean(Object.keys(n).length>1||Object.keys(this.Query.Where).length>1);var r=e.getObjectFirstKey(n);switch(r){case"Like":var o=n.Like.split("%");o[1]?o.length>2?this.executeLikeLogic(t,o[1],e.Occurence.Any):this.executeLikeLogic(t,o[1],e.Occurence.Last):this.executeLikeLogic(t,o[0],e.Occurence.First);break;case"In":this.executeInLogic(t,n.In);break;case"-":case">":case"<":case">=":case"<=":this.executeWhereLogic(t,n,r);break;case"Aggregate":break;default:this.executeWhereLogic(t,n)}}else this.CheckFlag=Boolean(Object.keys(this.Query.Where).length>1),this.executeWhereLogic(t,n)}else this.ErrorOccured=!0,this.Error=e.Utils.getError(e.ErrorType.ColumnNotExist,{ColumnName:t}),e.throwError(this.Error)},n.makeQryInCaseSensitive=function(t){var n,r,o=[];for(var s in t)if("object"==typeof(n=t[s])){for(var u in n)switch(r=n[u],u){case e.WhereQryOption.In:o=o.concat(this.getAllCombinationOfWord(r,!0));break;case e.WhereQryOption.Like:break;default:o=o.concat(this.getAllCombinationOfWord(r))}t[s].In=o}else o=o.concat(this.getAllCombinationOfWord(n)),t[s]={In:o};return t},n}return __extends(n,t),n.prototype.checkForWhereConditionMatch=function(t){var n=this.Query.Where,r=!0,o=function(e,t){for(var o=n[e].In,s=0,u=o.length;s<u;s++){if(o[s]==t){r=!0;break}r=!1}},s=function(t,o){var s,u,i,c=n[t].Like.split("%");switch(c[1]?(u=c[1],s=c.length>2?e.Occurence.Any:e.Occurence.Last):(u=c[0],s=e.Occurence.First),o=o.toLowerCase(),s){case e.Occurence.Any:(i=o.indexOf(u.toLowerCase()))<0&&(r=!1);break;case e.Occurence.First:((i=o.indexOf(u.toLowerCase()))>0||i<0)&&(r=!1);break;default:(i=o.lastIndexOf(u.toLowerCase()))<o.length-u.length&&(r=!1)}},u=function(e,t,o){var s=n[e][o];switch(o){case">":t<=s&&(r=!1);break;case"<":t>=s&&(r=!1);break;case"<=":t>s&&(r=!1);break;case">=":t<s&&(r=!1);break;case"-":(t<s.Low||t>s.High)&&(r=!1)}};for(var i in n){var c=n[i];if(!r)break;if("object"==typeof c)for(var a in c){if(!r)break;switch(a){case"In":o(i,t[i]);break;case"Like":s(i,t[i]);break;case"-":case">":case"<":case">=":case"<=":u(i,t[i],a)}}else{if(c!=t[i]){r=!1;break}}}return r},n}(t.BaseHelper);t.Base=n}(e.Business||(e.Business={}))}(JsStore||(JsStore={}));!function(e){!function(t){var n=function(){return function(n,r,o){var s=[],u=indexedDB.open(t.ActiveDataBase.Name,n);u.onerror=function(e){null!=o&&o(e.target.error)},u.onsuccess=function(n){e.Status.ConStatus=e.ConnectionStatus.Connected,t.DbConnection=u.result,t.DbConnection.onclose=function(){e.Status.ConStatus=e.ConnectionStatus.Closed,e.Status.LastError="Connection Closed"},t.DbConnection.onversionchange=function(e){null===e.newVersion&&e.target.close()},t.DbConnection.onerror=function(t){e.Status.LastError="Error occured in connection :"+t.target.result},t.DbConnection.onabort=function(t){e.Status.ConStatus=e.ConnectionStatus.Closed,e.Status.LastError="Connection aborted"},null!=r&&r(s),KeyStore.set("JsStore_"+t.ActiveDataBase.Name+"_Schema",t.ActiveDataBase)},u.onupgradeneeded=function(e){var n=e.target.result;t.ActiveDataBase.Tables.forEach(function(e){e.RequireDelete?(n.objectStoreNames.contains(e.Name)&&n.deleteObjectStore(e.Name),i(n,e)):e.RequireCreation&&i(n,e)})};var i=function(e,n){try{if(n.PrimaryKey.length>0)r=e.createObjectStore(n.Name,{keyPath:n.PrimaryKey}),n.Columns.forEach(function(e){e.PrimaryKey?r.createIndex(e.Name,e.Name,{unique:!0}):r.createIndex(e.Name,e.Name,{unique:e.Unique}),e.AutoIncrement&&KeyStore.set("JsStore_"+t.ActiveDataBase.Name+"_"+n.Name+"_"+e.Name+"_Value",0)});else{var r=e.createObjectStore(n.Name,{autoIncrement:!0});n.Columns.forEach(function(e){r.createIndex(e.Name,e.Name,{unique:e.Unique}),e.AutoIncrement&&KeyStore.set("JsStore_"+t.ActiveDataBase.Name+"_"+n.Name+"_"+e.Name+"_Value",0)})}s.push(n.Name),KeyStore.set("JsStore_"+t.ActiveDataBase.Name+"_"+n.Name+"_Version",n.Version)}catch(e){}}}}();t.CreateDb=n}(e.Business||(e.Business={}))}(JsStore||(JsStore={}));!function(e){!function(t){var n=function(){return function(n,r,o){this.deleteDb=function(n,r,o){var s=indexedDB.deleteDatabase(n);s.onblocked=function(){null!=o&&o("database is blocked, cant be deleted right now.")},s.onerror=function(e){null!=o&&o(event.target.error)},s.onsuccess=function(){e.Status.ConStatus=e.ConnectionStatus.Closed,KeyStore.remove("JsStore_"+t.ActiveDataBase.Name+"_Db_Version"),t.ActiveDataBase.Tables.forEach(function(e){KeyStore.remove("JsStore_"+t.ActiveDataBase.Name+"_"+e.Name+"_Version"),e.Columns.forEach(function(n){n.AutoIncrement&&KeyStore.remove("JsStore_"+t.ActiveDataBase.Name+"_"+e.Name+"_"+n.Name+"_Value")})}),KeyStore.remove("JsStore_"+t.ActiveDataBase.Name+"_Schema"),r()}};var s=this;t.DbConnection.close(),setTimeout(function(){s.deleteDb(n,r,o)},100)}}();t.DropDb=n}(e.Business||(e.Business={}))}(JsStore||(JsStore={}));!function(e){!function(t){var n=function(n){function r(){var r=null!==n&&n.apply(this,arguments)||this;return r.ValuesAffected=[],r.onTransactionCompleted=function(){this.OnSuccess(this.Query.Return?this.ValuesAffected:this.RowAffected)},r.checkModifyInsertValues=function(n,r){var o,s=this,u=0,i=n.Name,c=function(){o=r[u++],a()},a=function(){o?l():s.insertData(r)},l=function(){var r=0,u=function(a){if(a){var l=function(t,n){s.ErrorOccured=!0,s.Error=e.Utils.getError(t,n)},h=function(){a.NotNull&&e.isNull(o[a.Name])?l(e.ErrorType.NullValue,{ColumnName:a.Name}):a.DataType&&typeof o[a.Name]!=a.DataType&&l(e.ErrorType.BadDataType,{ColumnName:a.Name}),u(n.Columns[r++])};s.ErrorOccured?s.onErrorOccured(s.Error,!0):a.AutoIncrement?KeyStore.get("JsStore_"+t.ActiveDataBase.Name+"_"+i+"_"+a.Name+"_Value",function(e){o[a.Name]=++e,KeyStore.set("JsStore_"+t.ActiveDataBase.Name+"_"+i+"_"+a.Name+"_Value",e),h()}):a.Default&&null==o[a.Name]?(o[a.Name]=a.Default,h()):h()}else c()};u(n.Columns[r++])};c()},r}return __extends(r,n),r}(t.Base);t.InsertHelper=n}(e.Business||(e.Business={}))}(JsStore||(JsStore={}));!function(e){!function(t){var n=function(n){function r(r,o,s){var u=n.call(this)||this;u.insertData=function(e){var n,r=this,o=0,s=this.Query.Return;n=s?function(t){if(t){var s=u.add(t);s.onerror=function(e){r.onErrorOccured(e)},s.onsuccess=function(s){r.ValuesAffected.push(t),n(e[o++])}}}:function(t){if(t){var s=u.add(t);s.onerror=function(e){r.onErrorOccured(e)},s.onsuccess=function(t){++r.RowAffected,n(e[o++])}}},r.Transaction=t.DbConnection.transaction([r.Query.Into],"readwrite");var u=r.Transaction.objectStore(r.Query.Into);r.Transaction.oncomplete=function(e){r.onTransactionCompleted()},n(e[o++])};try{u.Query=r,u.OnSuccess=o,u.OnError=s;var i=u.getTable(r.Into);if(i)u.Query.SkipDataCheck?(u.insertData(u.Query.Values),u.Query.Values=void 0):(u.checkModifyInsertValues(i,u.Query.Values),u.Query.Values=void 0);else{var c=e.Utils.getError(e.ErrorType.TableNotExist,{TableName:r.Into});e.throwError(c)}}catch(e){u.onExceptionOccured(e,{TableName:r.Into})}return u}return __extends(r,n),r}(t.InsertHelper);t.Insert=n}(e.Business||(e.Business={}))}(JsStore||(JsStore={}));!function(e){!function(t){var n=function(n){function r(r,o,s){var u=n.call(this)||this;u.ValuesAffected=[],u.ValuesIndex=0,u.onTransactionCompleted=function(){this.OnSuccess(this.Query.Return?this.ValuesAffected:this.RowAffected)},u.bulkinsertData=function(){var e=this;this.Transaction=t.DbConnection.transaction([this.Query.Into],"readwrite"),this.ObjectStore=this.Transaction.objectStore(this.Query.Into),this.Transaction.oncomplete=function(t){e.OnSuccess()},this.Query.Values.forEach(function(t){e.ObjectStore.add(t)})};try{u.Query=r,u.OnSuccess=o,u.OnError=s;if(u.Table=u.getTable(r.Into),u.Table)u.bulkinsertData();else{var i=e.Utils.getError(e.ErrorType.TableNotExist,{TableName:r.Into});e.throwError(i)}}catch(e){u.onExceptionOccured(e,{TableName:r.Into})}return u}return __extends(r,n),r}(t.Base);t.BulkInsert=n}(e.Business||(e.Business={}))}(JsStore||(JsStore={}));!function(e){!function(t){var n=function(){return function(n,r,o){if(t.ActiveDataBase.Name.length>0){var s=indexedDB.open(t.ActiveDataBase.Name,n);s.onerror=function(e){null!=o&&o(e.target.error)},s.onsuccess=function(n){e.Status.ConStatus=e.ConnectionStatus.Connected,t.DbConnection=s.result,t.DbConnection.onclose=function(){e.Status.ConStatus=e.ConnectionStatus.Closed,e.Status.LastError="Connection Closed, trying to reconnect"},t.DbConnection.onversionchange=function(e){null===e.newVersion&&e.target.close()},t.DbConnection.onerror=function(t){e.Status.LastError="Error occured in connection :"+t.target.result},t.DbConnection.onabort=function(t){e.Status.ConStatus=e.ConnectionStatus.Closed,e.Status.LastError="Connection Aborted"},null!=r&&r()}}else e.throwError("Database name is not supplied.")}}();t.OpenDb=n}(e.Business||(e.Business={}))}(JsStore||(JsStore={}));!function(e){!function(e){var t=function(t){function n(n,r,o){var s=t.call(this)||this,u=s,i=e.DbConnection.transaction([n],"readwrite").objectStore(n).clear();return i.onsuccess=function(t){u.getTable(n).Columns.forEach(function(t){t.AutoIncrement&&KeyStore.set("JsStore_"+e.ActiveDataBase.Name+"_"+n+"_"+t.Name+"_Value",0)}),null!=r&&r()},i.onerror=function(e){null!=o&&o()},s}return __extends(n,t),n}(e.Base);e.Clear=t}(e.Business||(e.Business={}))}(JsStore||(JsStore={}));!function(e){!function(t){var n=function(){return function(n){void 0===n&&(n=null),this.checkConnectionAndExecuteLogic=function(n){switch(e.log("checking connection and executing request:"+n.Name),n.Name){case"create_db":case"open_db":this.executeLogic(n);break;case"change_log_status":this.changeLogStatus(n);default:switch(e.Status.ConStatus){case e.ConnectionStatus.Connected:this.executeLogic(n);break;case e.ConnectionStatus.Closed:var r=this;this.openDb(t.ActiveDataBase.Name,function(){r.checkConnectionAndExecuteLogic(n)})}}},this.changeLogStatus=function(t){!0===t.Query.logging?e.EnableLog=!0:e.EnableLog=!1},this.returnResult=function(e){this.OnSuccess?this.OnSuccess(e):self.postMessage(e)},this.executeLogic=function(e){var t=this,n=function(e){t.returnResult({ReturnedValue:e})},r=function(e){t.returnResult({ErrorOccured:!0,ErrorDetails:e})};switch(e.Name){case"select":this.select(e.Query,n,r);break;case"insert":this.insert(e.Query,n,r);break;case"update":this.update(e.Query,n,r);break;case"delete":this.delete(e.Query,n,r);break;case"open_db":this.openDb(e.Query,n,r);break;case"create_db":this.createDb(e.Query,n,r);break;case"clear":this.clear(e.Query,n,r);break;case"drop_db":this.dropDb(n,r);break;case"count":this.count(e.Query,n,r);break;case"bulk_insert":this.bulkInsert(e.Query,n,r);break;case"export_json":this.exportJson(e.Query,n,r)}},this.openDb=function(n,r,o){KeyStore.get("JsStore_"+n+"_Db_Version",function(s){if(null==s)throw e.Utils.getError(e.ErrorType.DbNotExist,{DbName:n});KeyStore.get("JsStore_"+n+"_Schema",function(e){t.ActiveDataBase=e,new t.OpenDb(s,r,o)})})},this.closeDb=function(){e.Status.ConStatus==e.ConnectionStatus.Connected&&t.DbConnection.close()},this.dropDb=function(e,n){new t.DropDb(t.ActiveDataBase.Name,e,n)},this.update=function(e,n,r){new t.Update.Instance(e,n,r)},this.insert=function(n,r,o){Array.isArray(n.Values)?new t.Insert(n,r,o):e.throwError("Value should be array :- supplied value is not array")},this.bulkInsert=function(n,r,o){Array.isArray(n.Values)?new t.BulkInsert(n,r,o):e.throwError("Value should be array :- supplied value is not array")},this.delete=function(e,n,r){new t.Delete.Instance(e,n,r)},this.select=function(e,n,r){"object"==typeof e.From?new t.Select.Join(e,n,r):new t.Select.Instance(e,n,r)},this.count=function(e,n,r){"object"==typeof e.From?(e.Count=!0,new t.Select.Join(e,n,r)):new t.Count.Instance(e,n,r)},this.createDb=function(n,r,o){KeyStore.get("JsStore_"+n.Name+"_Db_Version",function(s){e.DbVersion=s,t.ActiveDataBase=new e.Model.DataBase(n);var u=function(){setTimeout(function(){var n=t.ActiveDataBase.Tables[t.ActiveDataBase.Tables.length-1];KeyStore.get("JsStore_"+t.ActiveDataBase.Name+"_"+n.Name+"_Version",function(s){s==n.Version?new t.CreateDb(e.DbVersion,r,o):u()})},200)};u()})},this.clear=function(e,n,r){new t.Clear(e,n,r)},this.exportJson=function(e,t,n){this.select(e,function(e){var n=URL.createObjectURL(new Blob([JSON.stringify(e)],{type:"text/json"}));t(n)},function(e){n(e)})},this.OnSuccess=n}}();t.Main=n}(e.Business||(e.Business={}))}(JsStore||(JsStore={}));!function(e){!function(e){!function(t){var n=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.Results=[],t.Sorted=!1,t.CheckFlag=!1,t.removeDuplicates=function(){var e=this.Results;this.Results=void 0;var t=this.getPrimaryKey(this.Query.From),n={};for(var r in e)n[e[r][t]]=e[r];e=[];for(r in n)e.push(n[r]);this.Results=e},t}return __extends(t,e),t}(e.Base);t.BaseSelect=n}(e.Select||(e.Select={}))}(e.Business||(e.Business={}))}(JsStore||(JsStore={}));!function(e){!function(t){!function(t){var n=function(t){function n(){var n=null!==t&&t.apply(this,arguments)||this;return n.executeWhereUndefinedLogic=function(){var t,n,r=this;if(this.Query.Order&&this.Query.Order.By)if(r.ObjectStore.indexNames.contains(this.Query.Order.By)){var o=this.Query.Order.Type&&"desc"==this.Query.Order.Type.toLowerCase()?"prev":"next";this.Sorted=!0,n=this.ObjectStore.index(r.Query.Order.By).openCursor(null,o)}else{var s=e.Utils.getError(e.ErrorType.ColumnNotExist,{ColumnName:this.Query.Order.By});e.throwError(s)}else n=this.ObjectStore.openCursor();this.SkipRecord&&this.LimitRecord?function(){var e=!1;n.onsuccess=function(n){(t=n.target.result)&&(e&&r.Results.length!=r.LimitRecord?(r.Results.push(t.value),t.continue()):(e=!0,t.advance(r.SkipRecord)))}}():this.SkipRecord?function(){var e=!1;n.onsuccess=function(n){(t=n.target.result)&&(e?(r.Results.push(t.value),t.continue()):(e=!0,t.advance(r.SkipRecord)))}}():this.LimitRecord?n.onsuccess=function(e){(t=e.target.result)&&r.Results.length!=r.LimitRecord&&(r.Results.push(t.value),t.continue())}:n.onsuccess=function(e){(t=e.target.result)&&(r.Results.push(t.value),t.continue())},n.onerror=function(e){r.ErrorOccured=!0,r.onErrorOccured(e)}},n}return __extends(n,t),n}(t.BaseSelect);t.NotWhere=n}(t.Select||(t.Select={}))}(e.Business||(e.Business={}))}(JsStore||(JsStore={}));!function(e){!function(e){!function(e){var t=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.executeSkipAndLimitForIn=function(e,t){var n,r=this.SkipRecord,o=this,s=this.ObjectStore.index(e),u=function(e){0==r?o.Results.push(e):--r};if(o.CheckFlag)for(var i=0,c=t.length;i<c;i++)o.ErrorOccured||(this.CursorOpenRequest=s.openCursor(IDBKeyRange.only(t[i])),this.CursorOpenRequest.onsuccess=function(e){n=e.target.result,o.Results.length!=o.LimitRecord&&n&&(o.checkForWhereConditionMatch(n.value)&&u(n.value),n.continue())},this.CursorOpenRequest.onerror=function(e){o.ErrorOccured=!0,o.onErrorOccured(e)});else for(var i=0,c=t.length;i<c;i++)o.ErrorOccured||(this.CursorOpenRequest=s.openCursor(IDBKeyRange.only(t[i])),this.CursorOpenRequest.onsuccess=function(e){n=e.target.result,o.Results.length!=o.LimitRecord&&n&&(u(n.value),n.continue())},this.CursorOpenRequest.onerror=function(e){o.ErrorOccured=!0,o.onErrorOccured(e)})},t.executeSkipForIn=function(e,t){var n,r=this.SkipRecord,o=this,s=this.ObjectStore.index(e),u=function(e){0==r?o.Results.push(e):--r};if(o.CheckFlag)for(var i=0,c=t.length;i<c;i++)o.ErrorOccured||(this.CursorOpenRequest=s.openCursor(IDBKeyRange.only(t[i])),this.CursorOpenRequest.onsuccess=function(e){(n=e.target.result)&&(o.checkForWhereConditionMatch(n.value)&&u(n.value),n.continue())},this.CursorOpenRequest.onerror=function(e){o.ErrorOccured=!0,o.onErrorOccured(e)});else for(var i=0,c=t.length;i<c;i++)o.ErrorOccured||(this.CursorOpenRequest=s.openCursor(IDBKeyRange.only(t[i])),this.CursorOpenRequest.onsuccess=function(e){(n=e.target.result)&&(u(n.value),n.continue())},this.CursorOpenRequest.onerror=function(e){o.ErrorOccured=!0,o.onErrorOccured(e)})},t.executeLimitForIn=function(e,t){var n,r=this,o=this.ObjectStore.index(e);if(r.CheckFlag)for(var s=0,u=t.length;s<u;s++)r.ErrorOccured||(this.CursorOpenRequest=o.openCursor(IDBKeyRange.only(t[s])),this.CursorOpenRequest.onsuccess=function(e){(n=e.target.result)&&r.Results.length!=r.LimitRecord&&(r.checkForWhereConditionMatch(n.value)&&r.Results.push(n.value),n.continue())},this.CursorOpenRequest.onerror=function(e){r.ErrorOccured=!0,r.onErrorOccured(e)});else for(var s=0,u=t.length;s<u;s++)r.ErrorOccured||(this.CursorOpenRequest=o.openCursor(IDBKeyRange.only(t[s])),this.CursorOpenRequest.onsuccess=function(e){(n=e.target.result)&&r.Results.length!=r.LimitRecord&&(r.Results.push(n.value),n.continue())},this.CursorOpenRequest.onerror=function(e){r.ErrorOccured=!0,r.onErrorOccured(e)})},t.executeSimpleForIn=function(e,t){var n,r=this,o=this.ObjectStore.index(e);if(r.CheckFlag)for(var s=0,u=t.length;s<u;s++)r.ErrorOccured||(this.CursorOpenRequest=o.openCursor(IDBKeyRange.only(t[s])),this.CursorOpenRequest.onsuccess=function(e){(n=e.target.result)&&(r.checkForWhereConditionMatch(n.value)&&r.Results.push(n.value),n.continue())},this.CursorOpenRequest.onerror=function(e){r.ErrorOccured=!0,r.onErrorOccured(e)});else for(var s=0,u=t.length;s<u;s++)r.ErrorOccured||(this.CursorOpenRequest=o.openCursor(IDBKeyRange.only(t[s])),this.CursorOpenRequest.onsuccess=function(e){(n=e.target.result)&&(r.Results.push(n.value),n.continue())},this.CursorOpenRequest.onerror=function(e){r.ErrorOccured=!0,r.onErrorOccured(e)})},t.executeInLogic=function(e,t){this.SkipRecord&&this.LimitRecord?this.executeSkipAndLimitForIn(e,t):this.SkipRecord?this.executeSkipForIn(e,t):this.LimitRecord?this.executeLimitForIn(e,t):this.executeSimpleForIn(e,t)},t}return __extends(t,e),t}(e.NotWhere);e.In=t}(e.Select||(e.Select={}))}(e.Business||(e.Business={}))}(JsStore||(JsStore={}));!function(e){!function(t){!function(t){var n=function(t){function n(){var n=null!==t&&t.apply(this,arguments)||this;return n.filterOnOccurence=function(t){var n=!1;switch(t=t.toLowerCase(),this.CompSymbol){case e.Occurence.Any:t.indexOf(this.CompValue)>=0&&(n=!0);break;case e.Occurence.First:0==t.indexOf(this.CompValue)&&(n=!0);break;default:t.lastIndexOf(this.CompValue)==t.length-this.CompValueLength&&(n=!0)}return n},n.executeSkipAndLimit=function(){var e,t=this.SkipRecord,n=this,r=function(e){0==t?n.Results.push(e):--t};n.CheckFlag?this.CursorOpenRequest.onsuccess=function(t){e=t.target.result,n.Results.length!=n.LimitRecord&&e&&(n.filterOnOccurence(e.key)&&n.checkForWhereConditionMatch(e.value)&&r(e.value),e.continue())}:this.CursorOpenRequest.onsuccess=function(t){e=t.target.result,n.Results.length!=n.LimitRecord&&e&&(n.filterOnOccurence(e.key)&&r(e.value),e.continue())}},n.executeSkip=function(){var e,t=this.SkipRecord,n=this,r=function(e){0==t?n.Results.push(e):--t};n.CheckFlag?this.CursorOpenRequest.onsuccess=function(t){(e=t.target.result)&&(n.filterOnOccurence(e.key)&&n.checkForWhereConditionMatch(e.value)&&r(e.value),e.continue())}:this.CursorOpenRequest.onsuccess=function(t){(e=t.target.result)&&(n.filterOnOccurence(e.key)&&r(e.value),e.continue())}},n.executeLimit=function(){var e,t=this;t.CheckFlag?this.CursorOpenRequest.onsuccess=function(n){e=n.target.result,t.Results.length!=t.LimitRecord&&e&&(t.filterOnOccurence(e.key)&&t.checkForWhereConditionMatch(e.value)&&t.Results.push(e.value),e.continue())}:this.CursorOpenRequest.onsuccess=function(n){e=n.target.result,t.Results.length!=t.LimitRecord&&e&&(t.filterOnOccurence(e.key)&&t.Results.push(e.value),e.continue())}},n.executeSimple=function(){var e,t=this;t.CheckFlag?this.CursorOpenRequest.onsuccess=function(n){(e=n.target.result)&&(t.filterOnOccurence(e.key)&&t.checkForWhereConditionMatch(e.value)&&t.Results.push(e.value),e.continue())}:this.CursorOpenRequest.onsuccess=function(n){(e=n.target.result)&&(t.filterOnOccurence(e.key)&&t.Results.push(e.value),e.continue())}},n.executeLikeLogic=function(e,t,n){var r=this;this.CompValue=t.toLowerCase(),this.CompValueLength=this.CompValue.length,this.CompSymbol=n,this.Column=e,this.CursorOpenRequest=this.ObjectStore.index(e).openCursor(),this.CursorOpenRequest.onerror=function(e){r.ErrorOccured=!0,r.onErrorOccured(e)},this.SkipRecord&&this.LimitRecord?this.executeSkipAndLimit():this.SkipRecord?this.executeSkip():this.LimitRecord?this.executeLimit():this.executeSimple()},n}return __extends(n,t),n}(t.In);t.Like=n}(t.Select||(t.Select={}))}(e.Business||(e.Business={}))}(JsStore||(JsStore={}));!function(e){!function(e){!function(e){var t=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.executeWhereLogic=function(e,t,n){var r,o,s=this;t=n?t[n]:t,(r=this.ObjectStore.index(e).openCursor(this.getKeyRange(t,n))).onerror=function(e){s.ErrorOccured=!0,s.onErrorOccured(e)},this.SkipRecord&&this.LimitRecord?function(){var e=!1;s.CheckFlag?r.onsuccess=function(t){(o=t.target.result)&&(e&&s.Results.length!=s.LimitRecord?(s.checkForWhereConditionMatch(o.value)&&s.Results.push(o.value),o.continue()):(e=!0,o.advance(s.SkipRecord)))}:r.onsuccess=function(t){(o=t.target.result)&&(e&&s.Results.length!=s.LimitRecord?(s.Results.push(o.value),o.continue()):(e=!0,o.advance(s.SkipRecord)))}}():this.SkipRecord?function(){var e=!1;s.CheckFlag?r.onsuccess=function(t){(o=t.target.result)&&(e?(s.checkForWhereConditionMatch(o.value)&&s.Results.push(o.value),o.continue()):(e=!0,o.advance(s.SkipRecord)))}:r.onsuccess=function(t){(o=t.target.result)&&(e?(s.Results.push(o.value),o.continue()):(e=!0,o.advance(s.SkipRecord)))}}():this.LimitRecord?s.CheckFlag?r.onsuccess=function(e){(o=e.target.result)&&s.Results.length!=s.LimitRecord&&s.checkForWhereConditionMatch(o.value)&&(s.Results.push(o.value),o.continue())}:r.onsuccess=function(e){(o=e.target.result)&&s.Results.length!=s.LimitRecord&&(s.Results.push(o.value),o.continue())}:s.CheckFlag?r.onsuccess=function(e){(o=e.target.result)&&(s.checkForWhereConditionMatch(o.value)&&s.Results.push(o.value),o.continue())}:r.onsuccess=function(e){(o=e.target.result)&&(s.Results.push(o.value),o.continue())}},t}return __extends(t,e),t}(e.Like);e.Where=t}(e.Select||(e.Select={}))}(e.Business||(e.Business={}))}(JsStore||(JsStore={}));!function(e){!function(e){!function(e){var t=function(t){function n(n,r,o){var s=t.call(this)||this;s.QueryStack=[],s.CurrentQueryStackIndex=0,s.onTransactionCompleted=function(e){null!=this.OnSuccess&&this.QueryStack.length==this.CurrentQueryStackIndex+1&&(this.Query.Count?this.OnSuccess(this.Results.length):(this.Query.Skip&&this.Query.Limit?(this.Results.splice(0,this.Query.Skip),this.Results.splice(this.Query.Limit-1,this.Results.length)):this.Query.Skip?this.Results.splice(0,this.Query.Skip):this.Query.Limit&&this.Results.splice(this.Query.Limit-1,this.Results.length),this.OnSuccess(this.Results)))},s.executeWhereJoinLogic=function(t,n){var r,o=this,s=[],u=0,i=(n.Column,o.Results),c=i.length;new e.Instance({From:n.Table,Where:n.Where,Order:n.Order},function(e){e.forEach(function(e,n){for(var o=0;o<c;o++)r=i[o][t.Table][t.Column],a(r,e,o)}),o.Results=s,o.QueryStack.length>o.CurrentQueryStackIndex+1?o.startExecutionJoinLogic():o.onTransactionCompleted(null)},function(e){o.onErrorOccured(e)});var a=function(e,t,r){if(s[u]={},e==t[n.Column]){s[u][n.Table]=t;for(c=0;c<o.CurrentQueryStackIndex;c++)s[u][o.QueryStack[c].Table]=i[r][o.QueryStack[c].Table];++u}else if("left"==n.JoinType){s[u]={},s[u][n.Table]=null;for(var c=0;c<o.CurrentQueryStackIndex;c++)s[u][o.QueryStack[c].Table]=i[r][o.QueryStack[c].Table];++u}}},s.executeRightJoin=function(t,n){var r=this,o=[],s=(n.Column,r.Results),u=s.length,i=0;new e.Instance({From:n.Table,Where:n.Where,Order:n.Order},function(e){!function(c){var a=!1;e.forEach(function(e,c){for(i=0;i<u;i++)if(e[n.Column]==s[i][t.Table][t.Column]){a=!0;break}if(o[c]={},o[c][n.Table]=e,a)for(a=!1,l=0;l<r.CurrentQueryStackIndex;l++)o[c][r.QueryStack[l].Table]=s[i][r.QueryStack[l].Table];else for(var l=0;l<r.CurrentQueryStackIndex;l++)o[c][r.QueryStack[l].Table]=null})}(),r.Results=o,r.QueryStack.length>r.CurrentQueryStackIndex+1?r.startExecutionJoinLogic():r.onTransactionCompleted(null)},function(e){r.ErrorOccured=!0,r.onErrorOccured(e)})},s.executeWhereUndefinedLogicForJoin=function(t,n){var r=this,o=[],s=0,u=(n.Column,r.Results),i=u.length,c=0,a={},l=function(){c<i?r.ErrorOccured||(a[n.Column]=u[c][t.Table][t.Column],new e.Instance({From:n.Table,Where:a,Order:n.Order},function(e){!function(e){if(e.length>0)e.forEach(function(e){o[s]={},o[s][n.Table]=e;for(var t=0;t<r.CurrentQueryStackIndex;t++)o[s][r.QueryStack[t].Table]=u[c][r.QueryStack[t].Table];++s});else if("left"==n.JoinType){o[s]={},o[s][n.Table]=null;for(var t=0;t<r.CurrentQueryStackIndex;t++)o[s][r.QueryStack[t].Table]=u[c][r.QueryStack[t].Table];++s}}(e),++c,l()},function(e){r.ErrorOccured=!0,r.onErrorOccured(e)})):(r.Results=o,r.QueryStack.length>r.CurrentQueryStackIndex+1?r.startExecutionJoinLogic():r.onTransactionCompleted(null))};l()},s.OnSuccess=r,s.OnError=o,s.Query=n;var u=s,i=[],c=function(e){return e.hasOwnProperty("Table1")?(e.Table2.JoinType=void 0==e.Join?"inner":e.Join.toLowerCase(),u.QueryStack.push(e.Table2),u.QueryStack.length%2==0&&(u.QueryStack[u.QueryStack.length-1].NextJoin=e.NextJoin),i.push(e.Table2.Table),c(e.Table1)):(u.QueryStack.push(e),void i.push(e.Table))};return c(n.From),s.QueryStack.reverse(),s.ErrorOccured||new e.Instance({From:s.QueryStack[0].Table,Where:s.QueryStack[0].Where},function(e){var t=u.QueryStack[0].Table;e.forEach(function(e,n){u.Results[n]={},u.Results[n][t]=e}),u.startExecutionJoinLogic()},function(e){u.onErrorOccured(e)}),s}return __extends(n,t),n.prototype.startExecutionJoinLogic=function(){var e;this.CurrentQueryStackIndex>=1&&this.CurrentQueryStackIndex%2==1?(e={Table:this.QueryStack[this.CurrentQueryStackIndex].NextJoin.Table,Column:this.QueryStack[this.CurrentQueryStackIndex].NextJoin.Column},this.CurrentQueryStackIndex++):e=this.QueryStack[this.CurrentQueryStackIndex++];var t=this.QueryStack[this.CurrentQueryStackIndex];"right"==t.JoinType?this.executeRightJoin(e,t):t.Where?this.executeWhereJoinLogic(e,t):this.executeWhereUndefinedLogicForJoin(e,t)},n}(e.BaseSelect);e.Join=t}(e.Select||(e.Select={}))}(e.Business||(e.Business={}))}(JsStore||(JsStore={}));!function(e){!function(e){!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.executeAggregateGroupBy=function(){var e=this.Query.GroupBy,t=this.Results,n={};this.Results=void 0;var r=this.Query.Aggregate;this.Query.Aggregate=void 0;var o,s,u,i,c=function(){for(var e in r)switch(e){case"Count":var c=function(){return u=n[s],u=u?u["Count("+i+")"]:0,u+=t[o][i]?1:0};if("string"==typeof r[e])i=r[e],t[o]["Count("+i+")"]=c();else if(Array.isArray(r[e]))for(var a in r[e])i=r[e][a],t[o]["Count("+i+")"]=c();break;case"Max":var l=function(){return u=n[s],u=u?u["Max("+i+")"]:0,t[o][i]=t[o][i]?t[o][i]:0,u>t[o][i]?u:t[o][i]};if("string"==typeof r[e])i=r[e],t[o]["Max("+i+")"]=l();else if(Array.isArray(r[e]))for(var a in r[e])i=r[e][a],t[o]["Max("+i+")"]=l();break;case"Min":var h=function(){return u=n[s],u=u?u["Min("+i+")"]:1/0,t[o][i]=t[o][i]?t[o][i]:1/0,u<t[o][i]?u:t[o][i]};if("string"==typeof r[e])i=r[e],t[o]["Min("+i+")"]=h();else if(Array.isArray(r[e]))for(var a in r[e])i=r[e][a],t[o]["Min("+i+")"]=h();break;case"Sum":var f=function(){return u=n[s],u=u?u["Sum("+i+")"]:0,u+=t[o][i]?t[o][i]:0};if("string"==typeof r[e])i=r[e],t[o]["Sum("+i+")"]=f();else if(Array.isArray(r[e]))for(var a in r[e])i=r[e][a],t[o]["Sum("+i+")"]=f();break;case"Avg":var d=function(){var e=(u=n[s])?u["Sum("+i+")"]:0;e+=t[o][i]?t[o][i]:0,t[o]["Sum("+i+")"]=e,u=u?u["Count("+i+")"]:0,u+=t[o][i]?1:0,t[o]["Count("+i+")"]=u};if("string"==typeof r[e])i=r[e],d();else if(Array.isArray(r[e]))for(var a in r[e])i=r[e][a],d()}};if("string"==typeof e)for(o in t)s=t[o][e],c(),n[s]=t[o];else for(o in t){s="";for(var a in e)s+=t[o][e[a]];c(),n[s]=t[o]}t=[];for(var l in n)t.push(n[l]);if(r.Avg)if("string"==typeof r.Avg)for(o in t){var h=t[o]["Sum("+r.Avg+")"],f=t[o]["Count("+r.Avg+")"];t[o]["Avg("+r.Avg+")"]=h/f,r.Count!==r.Avg&&delete t[o]["Count("+r.Avg+")"],r.Sum!==r.Avg&&delete t[o]["Sum("+r.Avg+")"]}else{var d=typeof r.Count,g=typeof r.Count;for(o in t)for(var a in r.Avg){var y=r.Avg[a],h=t[o]["Sum("+y+")"],f=t[o]["Count("+y+")"];t[o]["Avg("+y+")"]=h/f,d&&(r.Count!==y?delete t[o]["Count("+y+")"]:-1==r.Count.indexOf(y)&&delete t[o]["Count("+y+")"]),g&&(r.Sum!==y?delete t[o]["Sum("+y+")"]:-1==r.Sum.indexOf(y)&&delete t[o]["Sum("+y+")"])}}this.Results=t},t.processGroupBy=function(){var e=this.Query.GroupBy,t=this.Results,n={};if(this.Results=this.Query.GroupBy=void 0,"string"==typeof e)for(var r in t)n[t[r][e]]=t[r];else{var o;for(var r in t){o="";for(var s in e)o+=t[r][e[s]];n[o]=t[r]}}t=[];for(r in n)t.push(n[r]);this.Results=t},t}return __extends(t,e),t}(e.Where);e.GroupByHelper=t}(e.Select||(e.Select={}))}(e.Business||(e.Business={}))}(JsStore||(JsStore={}));!function(e){!function(e){!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.processOrderBy=function(){var e=this.Query.Order;if(e&&this.Results.length>0&&!this.Sorted&&e.By){e.Type=e.Type?e.Type.toLowerCase():"asc";var t=this,n=e.By;"string"==typeof this.Results[0][n]?"asc"==e.Type?t.Results.sort(function(e,t){return e[n].toLowerCase().localeCompare(t[n].toLowerCase())}):t.Results.sort(function(e,t){return t[n].toLowerCase().localeCompare(e[n].toLowerCase())}):"number"==typeof this.Results[0][n]&&("asc"==e.Type?t.Results.sort(function(e,t){return e[n]-t[n]}):t.Results.sort(function(e,t){return t[n]-e[n]}))}},t.processAggregateQry=function(){var e,t=this.Results,n={};this.Results=void 0;for(var r in this.Query.Aggregate)switch(r){case"Count":var o=function(){var n=0;for(var r in t)n+=t[r][e]?1:0;return n};if("string"==typeof this.Query.Aggregate[r])n["Count("+(e=this.Query.Aggregate[r])+")"]=o();else if(Array.isArray(this.Query.Aggregate[r]))for(var s in this.Query.Aggregate[r])n["Count("+(e=this.Query.Aggregate[r][s])+")"]=o();break;case"Max":var u=function(){var n=0;for(var r in t)n=n>t[r][e]?n:t[r][e];return n};if("string"==typeof this.Query.Aggregate[r])n["Max("+(e=this.Query.Aggregate[r])+")"]=u();else if(Array.isArray(this.Query.Aggregate[r]))for(var s in this.Query.Aggregate[r])n["Max("+(e=this.Query.Aggregate[r][s])+")"]=u();break;case"Min":var i=function(){var n=1/0,r=1/0;for(var o in t)n=n<(r=t[o][e]?t[o][e]:1/0)?n:r;return n};if("string"==typeof this.Query.Aggregate[r])n["Min("+(e=this.Query.Aggregate[r])+")"]=i();else if(Array.isArray(this.Query.Aggregate[r]))for(var s in this.Query.Aggregate[r])n["Min("+(e=this.Query.Aggregate[r][s])+")"]=i();break;case"Sum":var c=function(){var n=0;for(var r in t)n+=t[r][e];return n};if("string"==typeof this.Query.Aggregate[r])n["Sum("+(e=this.Query.Aggregate[r])+")"]=c();else if(Array.isArray(this.Query.Aggregate[r]))for(var s in this.Query.Aggregate[r])n["Sum("+(e=this.Query.Aggregate[r][s])+")"]=c();break;case"Avg":var a=function(){var n=0;for(var r in t)n+=t[r][e];return n/t.length};if("string"==typeof this.Query.Aggregate[r])n["Avg("+(e=this.Query.Aggregate[r])+")"]=a();else if(Array.isArray(this.Query.Aggregate[r]))for(var s in this.Query.Aggregate[r])n["Avg("+(e=this.Query.Aggregate[r][s])+")"]=a()}for(var r in n)t[0][r]=n[r];this.Results=t},t}return __extends(t,e),t}(e.GroupByHelper);e.Helper=t}(e.Select||(e.Select={}))}(e.Business||(e.Business={}))}(JsStore||(JsStore={}));!function(e){!function(t){!function(n){var r=function(n){function r(r,o,s){var u=n.call(this)||this;u.onTransactionCompleted=function(){if(this.SendResultFlag){if(this.processOrderBy(),this.Query.Distinct){var e=[],t=this.Results[0];for(var n in t)e.push(n);var r=this.getPrimaryKey(this.Query.From),o=e.indexOf(r);e.splice(o,1),this.Query.GroupBy=e.length>0?e:null}this.Query.GroupBy?this.Query.Aggregate?this.executeAggregateGroupBy():this.processGroupBy():this.Query.Aggregate&&this.processAggregateQry(),this.OnSuccess(this.Results)}},u.createtransactionForOrLogic=function(e){var n=this;this.Query=e;try{this.Transaction=t.DbConnection.transaction([e.From],"readonly"),this.Transaction.oncomplete=function(e){n.onTransactionCompleted()},this.Transaction.ontimeout=n.onTransactionCompleted,this.ObjectStore=this.Transaction.objectStore(e.From),this.goToWhereLogic()}catch(t){this.onExceptionOccured(t,{TableName:e.From})}},u.orQuerySuccess=function(){this.Results=this.OrInfo.Results,this.OrInfo.Results=void 0,this.removeDuplicates(),this.OrInfo.OnSucess(this.Results)},u.executeOrLogic=function(){this.OrInfo={OrQuery:this.Query.Where.Or,OnSucess:this.OnSuccess,Results:[]},this.TmpQry={From:this.Query.From,Where:{}};this.Query.Where.Or=void 0,this.OnSuccess=function(){if(this.OrInfo.Results=this.OrInfo.Results.concat(this.Results),!this.Query.Limit||this.Query.Limit>this.OrInfo.Results.length){this.Results=[];var t=e.getObjectFirstKey(this.OrInfo.OrQuery);null!=t?(this.TmpQry.Where[t]=this.OrInfo.OrQuery[t],delete this.OrInfo.OrQuery[t],this.createtransactionForOrLogic(this.TmpQry)):this.orQuerySuccess()}else this.orQuerySuccess()}};var i=u;u.Query=r,u.OnSuccess=o,u.OnError=s,u.SkipRecord=u.Query.Skip,u.LimitRecord=u.Query.Limit;try{u.Transaction=t.DbConnection.transaction([r.From],"readonly"),u.Transaction.oncomplete=function(e){i.onTransactionCompleted()},u.Transaction.ontimeout=i.onTransactionCompleted,u.ObjectStore=u.Transaction.objectStore(r.From),r.Where?(r.Where.Or&&u.executeOrLogic(),u.goToWhereLogic()):u.executeWhereUndefinedLogic()}catch(e){u.onExceptionOccured(e,{TableName:r.From})}return u}return __extends(r,n),r}(n.Helper);n.Instance=r}(t.Select||(t.Select={}))}(e.Business||(e.Business={}))}(JsStore||(JsStore={}));!function(e){!function(e){!function(t){var n=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.ResultCount=0,t.CheckFlag=!1,t}return __extends(t,e),t}(e.Base);t.BaseCount=n}(e.Count||(e.Count={}))}(e.Business||(e.Business={}))}(JsStore||(JsStore={}));!function(e){!function(e){!function(e){var t=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.executeWhereUndefinedLogic=function(){var e=this;if(this.ObjectStore.count){var t=this.ObjectStore.count();t.onsuccess=function(){e.ResultCount=t.result},t.onerror=function(t){e.ErrorOccured=!0,e.onErrorOccured(t)}}else{var n,r=this.ObjectStore.openCursor();r.onsuccess=function(t){(n=t.target.result)&&(++e.ResultCount,n.continue())},r.onerror=function(t){e.ErrorOccured=!0,e.onErrorOccured(t)}}},t}return __extends(t,e),t}(e.BaseCount);e.NotWhere=t}(e.Count||(e.Count={}))}(e.Business||(e.Business={}))}(JsStore||(JsStore={}));!function(e){!function(e){!function(e){var t=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.executeInLogic=function(e,t){var n,r,o=this,s=this.ObjectStore.index(e);if(o.CheckFlag)for(var u=0,i=t.length;u<i;u++)o.ErrorOccured||((r=s.openCursor(IDBKeyRange.only(t[u]))).onsuccess=function(e){(n=e.target.result)&&(o.checkForWhereConditionMatch(n.value)&&++o.ResultCount,n.continue())},r.onerror=function(e){o.ErrorOccured=!0,o.onErrorOccured(e)});else if(this.ObjectStore.count)for(var u=0,i=t.length;u<i;u++)o.ErrorOccured||((r=s.count(IDBKeyRange.only(t[u]))).onsuccess=function(e){o.ResultCount+=e.target.result},r.onerror=function(e){o.ErrorOccured=!0,o.onErrorOccured(e)});else for(var u=0,i=t.length;u<i;u++)o.ErrorOccured||((r=s.openCursor(IDBKeyRange.only(t[u]))).onsuccess=function(e){(n=e.target.result)&&(++o.ResultCount,n.continue())},r.onerror=function(e){o.ErrorOccured=!0,o.onErrorOccured(e)});r.onerror=function(e){o.ErrorOccured=!0,o.onErrorOccured(e)}},t}return __extends(t,e),t}(e.NotWhere);e.In=t}(e.Count||(e.Count={}))}(e.Business||(e.Business={}))}(JsStore||(JsStore={}));!function(e){!function(t){!function(t){var n=function(t){function n(){var n=null!==t&&t.apply(this,arguments)||this;return n.filterOnOccurence=function(t){var n=!1;switch(t=t.toLowerCase(),this.CompSymbol){case e.Occurence.Any:t.indexOf(this.CompValue)>=0&&(n=!0);break;case e.Occurence.First:0==t.indexOf(this.CompValue)&&(n=!0);break;default:t.lastIndexOf(this.CompValue)==t.length-this.CompValueLength&&(n=!0)}return n},n.executeLikeLogic=function(e,t,n){var r,o=this;this.CompValue=t.toLowerCase(),this.CompValueLength=this.CompValue.length,this.CompSymbol=n,this.Column=e,this.CursorOpenRequest=this.ObjectStore.index(e).openCursor(),this.CursorOpenRequest.onerror=function(e){o.ErrorOccured=!0,o.onErrorOccured(e)},o.CheckFlag?this.CursorOpenRequest.onsuccess=function(e){(r=e.target.result)&&(o.filterOnOccurence(r.key)&&o.checkForWhereConditionMatch(r.value)&&++o.ResultCount,r.continue())}:this.CursorOpenRequest.onsuccess=function(e){(r=e.target.result)&&(o.filterOnOccurence(r.key)&&++o.ResultCount,r.continue())}},n}return __extends(n,t),n}(t.In);t.Like=n}(t.Count||(t.Count={}))}(e.Business||(e.Business={}))}(JsStore||(JsStore={}));!function(e){!function(e){!function(e){var t=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.executeWhereLogic=function(e,t,n){var r=this;if(t=n?t[n]:t,r.CheckFlag){(u=this.ObjectStore.index(e).openCursor(this.getKeyRange(t,n))).onsuccess=function(e){(s=e.target.result)&&(r.checkForWhereConditionMatch(s.value)&&++r.ResultCount,s.continue())},u.onerror=function(e){r.ErrorOccured=!0,r.onErrorOccured(e)}}else if(this.ObjectStore.count){var o=this.ObjectStore.index(e).count(this.getKeyRange(t,n));o.onsuccess=function(){r.ResultCount=o.result},o.onerror=function(e){r.ErrorOccured=!0,r.onErrorOccured(e)}}else{var s,u=this.ObjectStore.index(e).openCursor(this.getKeyRange(t,n));u.onsuccess=function(e){(s=e.target.result)&&(++r.ResultCount,s.continue())},u.onerror=function(e){r.ErrorOccured=!0,r.onErrorOccured(e)}}},t}return __extends(t,e),t}(e.Like);e.Where=t}(e.Count||(e.Count={}))}(e.Business||(e.Business={}))}(JsStore||(JsStore={}));!function(e){!function(e){!function(t){var n=function(t){function n(n,r,o){var s=t.call(this)||this;s.onTransactionCompleted=function(){this.SendResultFlag&&this.OnSuccess(this.ResultCount)};var u=s;s.Query=n,s.OnSuccess=r,s.OnError=o;try{var i=function(){u.Transaction=e.DbConnection.transaction([n.From],"readonly"),u.ObjectStore=u.Transaction.objectStore(n.From),u.Transaction.oncomplete=function(e){u.onTransactionCompleted()},u.Transaction.ontimeout=u.onTransactionTimeout};void 0!=n.Where?n.Where.Or?new e.Select.Instance(n,function(e){u.ResultCount=e.length,u.onTransactionCompleted()},s.OnError):(i(),s.goToWhereLogic()):(i(),s.executeWhereUndefinedLogic())}catch(e){s.onExceptionOccured(e,{TableName:n.From})}return s}return __extends(n,t),n}(t.Where);t.Instance=n}(e.Count||(e.Count={}))}(e.Business||(e.Business={}))}(JsStore||(JsStore={}));!function(e){!function(e){(e.Update||(e.Update={})).updateValue=function(e,t){for(var n in e)if("object"!=typeof e[n])t[n]=e[n];else for(var r in e[n]){switch(r){case"+":t[n]+=e[n][r];break;case"-":t[n]-=e[n][r];break;case"*":t[n]*=e[n][r];break;case"/":t[n]/=e[n][r];break;default:t[n]=e[n]}break}return t};var t=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.CheckFlag=!1,t}return __extends(t,e),t}(e.Base);e.BaseUpdate=t}(e.Business||(e.Business={}))}(JsStore||(JsStore={}));!function(e){!function(e){!function(t){var n=function(e){function n(){var n=null!==e&&e.apply(this,arguments)||this;return n.executeWhereUndefinedLogic=function(){var e,n=this,r=this.ObjectStore.openCursor();r.onsuccess=function(r){(e=r.target.result)&&(e.update(t.updateValue(n.Query.Set,e.value)),++n.RowAffected,e.continue())},r.onerror=function(e){n.ErrorOccured=!0,n.onErrorOccured(e)}},n}return __extends(n,e),n}(e.BaseUpdate);t.NotWhere=n}(e.Update||(e.Update={}))}(e.Business||(e.Business={}))}(JsStore||(JsStore={}));!function(e){!function(e){!function(e){var t=function(t){function n(){var n=null!==t&&t.apply(this,arguments)||this;return n.executeInLogic=function(t,n){var r,o,s=this,u=this.ObjectStore.index(t);if(s.CheckFlag)for(var i=0,c=n.length;i<c;i++)s.ErrorOccured||((o=u.openCursor(IDBKeyRange.only(n[i]))).onsuccess=function(t){(r=t.target.result)&&(s.checkForWhereConditionMatch(r.value)&&(r.update(e.updateValue(s.Query.Set,r.value)),++s.RowAffected),r.continue())},o.onerror=function(e){s.ErrorOccured=!0,s.onErrorOccured(e)});else for(var i=0,c=n.length;i<c;i++)s.ErrorOccured||((o=u.openCursor(IDBKeyRange.only(n[i]))).onsuccess=function(t){(r=t.target.result)&&(r.update(e.updateValue(s.Query.Set,r.value)),++s.RowAffected,r.continue())},o.onerror=function(e){s.ErrorOccured=!0,s.onErrorOccured(e)});o.onerror=function(e){s.ErrorOccured=!0,s.onErrorOccured(e)}},n}return __extends(n,t),n}(e.NotWhere);e.In=t}(e.Update||(e.Update={}))}(e.Business||(e.Business={}))}(JsStore||(JsStore={}));!function(e){!function(t){!function(t){var n=function(n){function r(){var r=null!==n&&n.apply(this,arguments)||this;return r.filterOnOccurence=function(t){var n=!1;switch(t=t.toLowerCase(),this.CompSymbol){case e.Occurence.Any:t.indexOf(this.CompValue)>=0&&(n=!0);break;case e.Occurence.First:0==t.indexOf(this.CompValue)&&(n=!0);break;default:t.lastIndexOf(this.CompValue)==t.length-this.CompValueLength&&(n=!0)}return n},r.executeLikeLogic=function(e,n,r){var o,s=this;this.CompValue=n.toLowerCase(),this.CompValueLength=this.CompValue.length,this.CompSymbol=r,this.Column=e,this.CursorOpenRequest=this.ObjectStore.index(e).openCursor(),this.CursorOpenRequest.onerror=function(e){s.ErrorOccured=!0,s.onErrorOccured(e)},s.CheckFlag?this.CursorOpenRequest.onsuccess=function(e){(o=e.target.result)&&(s.filterOnOccurence(o.key)&&s.checkForWhereConditionMatch(o.value)&&(o.update(t.updateValue(s.Query.Set,o.value)),++s.RowAffected),o.continue())}:this.CursorOpenRequest.onsuccess=function(e){(o=e.target.result)&&(s.filterOnOccurence(o.key)&&(o.update(t.updateValue(s.Query.Set,o.value)),++s.RowAffected),o.continue())}},r}return __extends(r,n),r}(t.In);t.Like=n}(t.Update||(t.Update={}))}(e.Business||(e.Business={}))}(JsStore||(JsStore={}));!function(e){!function(e){!function(e){var t=function(t){function n(){var n=null!==t&&t.apply(this,arguments)||this;return n.executeWhereLogic=function(t,n,r){var o,s,u=this;n=r?n[r]:n,s=this.ObjectStore.index(t).openCursor(this.getKeyRange(n,r)),u.CheckFlag?s.onsuccess=function(t){(o=t.target.result)&&(u.checkForWhereConditionMatch(o.value)&&(o.update(e.updateValue(u.Query.Set,o.value)),++u.RowAffected),o.continue())}:s.onsuccess=function(t){(o=t.target.result)&&(o.update(e.updateValue(u.Query.Set,o.value)),++u.RowAffected,o.continue())},s.onerror=function(e){u.ErrorOccured=!0,u.onErrorOccured(e)}},n}return __extends(n,t),n}(e.Like);e.Where=t}(e.Update||(e.Update={}))}(e.Business||(e.Business={}))}(JsStore||(JsStore={}));!function(e){!function(t){!function(n){var r=function(n){function r(e,r,o){var s=n.call(this)||this;s.onTransactionCompleted=function(){this.OnSuccess(this.RowAffected)},s.createtransactionForOrLogic=function(e){var n=this;this.Query=e;try{this.Transaction=t.DbConnection.transaction([e.In],"readwrite"),this.Transaction.oncomplete=function(e){n.onTransactionCompleted()},this.Transaction.ontimeout=n.onTransactionCompleted,this.ObjectStore=this.Transaction.objectStore(e.In),this.goToWhereLogic()}catch(t){this.onExceptionOccured(t,{TableName:e.From})}},s.executeOrLogic=function(){var e=this;new t.Select.Instance({From:this.Query.In,Where:this.Query.Where},function(t){var n=e.getPrimaryKey(e.Query.In),r=[],o={};t.forEach(function(e){r.push(e[n])}),o[n]={In:r},e.createtransactionForOrLogic({In:e.Query.In,Where:o,Set:e.Query.Set})},this.OnError)};try{if(s.OnSuccess=r,s.OnError=o,s.checkSchema(e.Set,e.In),s.ErrorOccured)s.onErrorOccured(s.Error,!0);else{s.Query=e;var u=s,i=function(){u.Transaction=t.DbConnection.transaction([e.In],"readwrite"),u.ObjectStore=u.Transaction.objectStore(e.In),u.Transaction.oncomplete=function(e){u.onTransactionCompleted()},u.Transaction.ontimeout=u.onTransactionTimeout};e.Where?e.Where.Or?s.executeOrLogic():(i(),s.goToWhereLogic()):(i(),s.executeWhereUndefinedLogic())}}catch(t){s.onExceptionOccured(t,{TableName:e.In})}return s}return __extends(r,n),r.prototype.checkSchema=function(t,n){if(t){var r=this.getTable(n),o=this;if(r){var s=function(t,n){o.ErrorOccured=!0,o.Error=e.Utils.getError(t,n)};r.Columns.every(function(n){if(o.ErrorOccured)return!1;if(n.Name in t){!function(t){if(n.NotNull&&e.isNull(t)&&s(e.ErrorType.NullValue,{ColumnName:n.Name}),n.DataType){var r=typeof t;if(r!=n.DataType)if("object"!=r)s(e.ErrorType.BadDataType,{ColumnName:n.Name});else{var o=["+","-","*","/"];for(var u in t){o.indexOf(u)<0&&s(e.ErrorType.BadDataType,{ColumnName:n.Name});break}}}}(t[n.Name])}return!0})}else{var u=e.Utils.getError(e.ErrorType.TableNotExist,{TableName:n});e.throwError(u)}}else this.ErrorOccured=!0,this.OnSuccess(0)},r}(n.Where);n.Instance=r}(t.Update||(t.Update={}))}(e.Business||(e.Business={}))}(JsStore||(JsStore={}));!function(e){!function(e){!function(t){var n=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.CheckFlag=!1,t}return __extends(t,e),t}(e.Base);t.BaseDelete=n}(e.Delete||(e.Delete={}))}(e.Business||(e.Business={}))}(JsStore||(JsStore={}));!function(e){!function(e){!function(e){var t=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.executeWhereUndefinedLogic=function(){var e,t=this,n=this.ObjectStore.openCursor();n.onsuccess=function(n){(e=n.target.result)&&(e.delete(),++t.RowAffected,e.continue())},n.onerror=function(e){t.ErrorOccured=!0,t.onErrorOccured(e)}},t}return __extends(t,e),t}(e.BaseDelete);e.NotWhere=t}(e.Delete||(e.Delete={}))}(e.Business||(e.Business={}))}(JsStore||(JsStore={}));!function(e){!function(e){!function(e){var t=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.executeInLogic=function(e,t){var n,r,o=this;this.ObjectStore.index(e);if(o.CheckFlag)for(var s=0,u=t.length;s<u;s++)o.ErrorOccured||((r=this.ObjectStore.index(e).openCursor(IDBKeyRange.only(t[s]))).onsuccess=function(e){(n=e.target.result)&&(o.checkForWhereConditionMatch(n.value)&&(n.delete(),++o.RowAffected),n.continue())},r.onerror=function(e){o.ErrorOccured=!0,o.onErrorOccured(e)});else for(var s=0,u=t.length;s<u;s++)o.ErrorOccured||((r=this.ObjectStore.index(e).openCursor(IDBKeyRange.only(t[s]))).onsuccess=function(e){(n=e.target.result)&&(n.delete(),++o.RowAffected,n.continue())},r.onerror=function(e){o.ErrorOccured=!0,o.onErrorOccured(e)});r.onerror=function(e){o.ErrorOccured=!0,o.onErrorOccured(e)}},t}return __extends(t,e),t}(e.NotWhere);e.In=t}(e.Delete||(e.Delete={}))}(e.Business||(e.Business={}))}(JsStore||(JsStore={}));!function(e){!function(t){!function(t){var n=function(t){function n(){var n=null!==t&&t.apply(this,arguments)||this;return n.filterOnOccurence=function(t){var n=!1;switch(t=t.toLowerCase(),this.CompSymbol){case e.Occurence.Any:t.indexOf(this.CompValue)>=0&&(n=!0);break;case e.Occurence.First:0==t.indexOf(this.CompValue)&&(n=!0);break;default:t.lastIndexOf(this.CompValue)==t.length-this.CompValueLength&&(n=!0)}return n},n.executeLikeLogic=function(e,t,n){var r,o=this;this.CompValue=t.toLowerCase(),this.CompValueLength=this.CompValue.length,this.CompSymbol=n,this.Column=e,this.CursorOpenRequest=this.ObjectStore.index(e).openCursor(),this.CursorOpenRequest.onerror=function(e){o.ErrorOccured=!0,o.onErrorOccured(e)},o.CheckFlag?this.CursorOpenRequest.onsuccess=function(e){(r=e.target.result)&&(o.filterOnOccurence(r.key)&&o.checkForWhereConditionMatch(r.value)&&(r.delete(),++o.RowAffected),r.continue())}:this.CursorOpenRequest.onsuccess=function(e){(r=e.target.result)&&(o.filterOnOccurence(r.key)&&(r.delete(),++o.RowAffected),r.continue())}},n}return __extends(n,t),n}(t.In);t.Like=n}(t.Delete||(t.Delete={}))}(e.Business||(e.Business={}))}(JsStore||(JsStore={}));!function(e){!function(e){!function(e){var t=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.executeWhereLogic=function(e,t,n){var r,o,s=this;t=n?t[n]:t,o=this.ObjectStore.index(e).openCursor(this.getKeyRange(t,n)),s.CheckFlag?o.onsuccess=function(e){(r=e.target.result)&&(s.checkForWhereConditionMatch(r.value)&&(r.delete(),++s.RowAffected),r.continue())}:o.onsuccess=function(e){(r=e.target.result)&&(r.delete(),++s.RowAffected,r.continue())},o.onerror=function(e){s.ErrorOccured=!0,s.onErrorOccured(e)}},t}return __extends(t,e),t}(e.Like);e.Where=t}(e.Delete||(e.Delete={}))}(e.Business||(e.Business={}))}(JsStore||(JsStore={}));!function(e){!function(t){!function(n){var r=function(n){function r(r,o,s){var u=n.call(this)||this;u.onTransactionCompleted=function(){this.OnSuccess(this.RowAffected)},u.createtransactionForOrLogic=function(e){var n=this;this.Query=e;try{this.Transaction=t.DbConnection.transaction([e.From],"readwrite"),this.Transaction.oncomplete=function(e){n.onTransactionCompleted()},this.Transaction.ontimeout=n.onTransactionCompleted,this.ObjectStore=this.Transaction.objectStore(e.From),this.goToWhereLogic()}catch(t){this.onExceptionOccured(t,{TableName:e.From})}},u.executeOrLogic=function(){this.OrInfo={OrQuery:this.Query.Where.Or,OnSucess:this.OnSuccess},this.TmpQry={From:this.Query.From,Where:{}};this.Query.Where.Or=void 0,this.OnSuccess=function(){var t=e.getObjectFirstKey(this.OrInfo.OrQuery);null!=t?(this.TmpQry.Where[t]=this.OrInfo.OrQuery[t],delete this.OrInfo.OrQuery[t],this.createtransactionForOrLogic(this.TmpQry)):this.OrInfo.OnSucess(this.RowAffected)}};try{var i=u;u.Query=r,u.OnSuccess=o,u.OnError=s,u.Transaction=t.DbConnection.transaction([r.From],"readwrite"),u.ObjectStore=u.Transaction.objectStore(r.From),u.Transaction.oncomplete=function(){i.onTransactionCompleted()},u.Transaction.onerror=function(e){i.onErrorOccured(e)},r.Where?(r.Where.Or&&u.executeOrLogic(),u.goToWhereLogic()):u.executeWhereUndefinedLogic()}catch(e){u.onExceptionOccured(e,{TableName:r.From})}return u}return __extends(r,n),r}(n.Where);n.Instance=r}(t.Delete||(t.Delete={}))}(e.Business||(e.Business={}))}(JsStore||(JsStore={}));!function(e){e.WorkerStatus=e.WebWorkerStatus.NotStarted;var t=function(){function t(){this.RequestQueue=[],this.IsCodeExecuting=!1,this.pushApi=function(e,t){if(!0===t){var n=this;return new Promise(function(t,r){e.OnSuccess=function(e){t(e)},e.OnError=function(e){r(e)},n.prcoessExecutionOfCode(e)})}return this.prcoessExecutionOfCode(e),this},this.prcoessExecutionOfCode=function(t){if(e.Status.ConStatus==e.ConnectionStatus.NotStarted)switch(t.Name){case"create_db":case"open_db":this.RequestQueue.splice(0,0,t),e.WorkerStatus!=e.WebWorkerStatus.NotStarted&&this.executeCode(),e.Status.ConStatus=e.ConnectionStatus.Connected;break;default:this.RequestQueue.push(t)}else this.RequestQueue.push(t),1==this.RequestQueue.length&&e.WorkerStatus!=e.WebWorkerStatus.NotStarted&&this.executeCode();e.log("request pushed: "+t.Name)},this.executeCode=function(){if(!this.IsCodeExecuting&&this.RequestQueue.length>0){this.IsCodeExecuting=!0;var t=this.RequestQueue[0],n={Name:t.Name,Query:t.Query};e.log("request executing : "+t.Name),e.WorkerStatus==e.WebWorkerStatus.Registered?this.executeCodeUsingWorker(n):this.executeCodeDirect(n)}},this.executeCodeDirect=function(t){var n=this;new e.Business.Main(function(e){n.processFinishedRequest(e)}).checkConnectionAndExecuteLogic(t)},this.executeCodeUsingWorker=function(t){e.WorkerInstance.postMessage(t)},this.processFinishedRequest=function(t){var n=this.RequestQueue.shift();this.IsCodeExecuting=!1,n&&(e.log("request finished : "+n.Name),t.ErrorOccured?n.OnError&&n.OnError(t.ErrorDetails):n.OnSuccess&&(null!=t.ReturnedValue?n.OnSuccess(t.ReturnedValue):n.OnSuccess()),this.executeCode())},this.onWorkerFailed=function(){e.WorkerStatus=e.WebWorkerStatus.Failed,e.Status.ConStatus==e.ConnectionStatus.NotStarted&&this.executeCode()},this.createWorker=function(){var t=this;try{if(Worker){var n=this.getScriptUrl();n&&n.length>0?(e.WorkerInstance=new Worker(n),e.WorkerInstance.onmessage=function(e){t.onMessageFromWorker(e)},t.executeCodeUsingWorker({Name:"change_log_status",Query:{logging:e.EnableLog}}),setTimeout(function(){e.WorkerStatus!=e.WebWorkerStatus.Failed&&(e.WorkerStatus=e.WebWorkerStatus.Registered),e.Status.ConStatus==e.ConnectionStatus.Connected&&t.executeCode()},100)):t.onWorkerFailed()}else t.onWorkerFailed()}catch(e){t.onWorkerFailed()}},this.onMessageFromWorker=function(e){if("string"==typeof e.data){switch(e.data.split(":")[1]){case"WorkerFailed":this.onWorkerFailed()}}else this.processFinishedRequest(e.data)}}return t.prototype.getScriptUrl=function(e){for(var t="",n=e?e.toLowerCase():"jsstore",r=document.getElementsByTagName("script"),o=r.length-1,s="";o>=0;o--)if(s=r[o].src,(s=s.substring(s.lastIndexOf("/")+1).toLowerCase()).length>0&&s.indexOf(n)>=0)return t=r[o].src;return t},t}();e.CodeExecutionHelper=t}(JsStore||(JsStore={}));var JsStore,Model=JsStore.Model,DataBase=Model.DataBase,Column=Model.Column,Table=Model.Table;!function(e){var t=function(t){function n(n){void 0===n&&(n=null);var r=t.call(this)||this;return r.openDb=function(e,t,n){return void 0===t&&(t=null),void 0===n&&(n=null),this.pushApi({Name:"open_db",Query:e,OnSuccess:t,OnError:n},!1)},r.createDb=function(e,t,n){return void 0===t&&(t=null),void 0===n&&(n=null),this.pushApi({Name:"create_db",OnSuccess:t,OnError:n,Query:e},!1)},r.dropDb=function(e,t){void 0===t&&(t=null);var n=!e;return this.pushApi({Name:"drop_db",OnSuccess:e,OnError:t},n)},r.select=function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=null),t=e.OnSuccess?e.OnSuccess:t,n=e.OnError?e.OnError:n,e.OnSuccess=e.OnError=null;var r=!t;return this.pushApi({Name:"select",Query:e,OnSuccess:t,OnError:n},r)},r.count=function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=null),t=e.OnSuccess?e.OnSuccess:t,n=e.OnError?e.OnError:n,e.OnSuccess=e.OnError=null;var r=!t;return this.pushApi({Name:"count",Query:e,OnSuccess:t,OnError:n},r)},r.insert=function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=null),t=e.OnSuccess?e.OnSuccess:t,n=e.OnError?e.OnError:n,e.OnSuccess=e.OnError=null;var r=!t;return this.pushApi({Name:"insert",Query:e,OnSuccess:t,OnError:n},r)},r.update=function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=null),t=e.OnSuccess?e.OnSuccess:t,n=e.OnError?e.OnError:n,e.OnSuccess=e.OnError=null;var r=!t;return this.pushApi({Name:"update",Query:e,OnSuccess:t,OnError:n},r)},r.delete=function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=null),t=e.OnSuccess?e.OnSuccess:t,n=e.OnError?e.OnError:n,e.OnSuccess=e.OnError=null;var r=!t;return this.pushApi({Name:"delete",Query:e,OnSuccess:t,OnError:n},r)},r.clear=function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=null);var r=!t;return this.pushApi({Name:"clear",Query:e,OnSuccess:t,OnError:onerror},r)},r.bulkInsert=function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=null),t=e.OnSuccess?e.OnSuccess:t,n=e.OnError?e.OnError:n;var r=!t;return e.OnSuccess=e.OnError=null,this.pushApi({Name:"bulk_insert",Query:e,OnSuccess:t,OnError:n},r)},r.exportJson=function(e){var t=function(t){var n=document.createElement("a");n.href=t,n.download=e.From+".json",n.click(),r&&r()},n=e.OnError,r=e.OnSuccess;e.OnSuccess=e.OnError=void 0;var o=!r;if(o)return new Promise(function(r,s){this.pushApi({Name:"export_json",Query:e,OnSuccess:t,OnError:n},o).then(function(e){t(e),r()}).catch(function(e){s(e)})});this.pushApi({Name:"export_json",Query:e,OnSuccess:t,OnError:n},o)},e.WorkerStatus==e.WebWorkerStatus.Registered?e.WorkerInstance.terminate():e.WorkerStatus==e.WebWorkerStatus.NotStarted&&KeyStore.init(),r.createWorker(),n&&r.openDb(n),r}return __extends(n,t),n}(e.CodeExecutionHelper);e.Instance=t}(JsStore||(JsStore={})),self&&!self.alert&&(self.onmessage=function(e){JsStore.log("Request executing from WebWorker, request name: "+e.data.Name);var t=e.data;(new JsStore.Business.Main).checkConnectionAndExecuteLogic(t)},JsStore.WorkerStatus=JsStore.WebWorkerStatus.Registered,KeyStore.init());