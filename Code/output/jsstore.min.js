var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){e(t,r);function n(){this.constructor=t}t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();!function(e){var t=function(){function e(){}return e.setDbType=function(){self.indexedDB=self.indexedDB||self.mozIndexedDB||self.webkitIndexedDB||self.msIndexedDB,indexedDB?(self.IDBTransaction=self.IDBTransaction||self.webkitIDBTransaction||self.msIDBTransaction,self.IDBKeyRange=self.IDBKeyRange||self.webkitIDBKeyRange||self.msIDBKeyRange):self.alert?JsStore.status={ConStatus:JsStore.Connection_Status.UnableToStart,LastError:JsStore.Error_Type.IndexedDbUndefined}:(console.log("worked failed"),self.postMessage("message:WorkerFailed"))},e}();e.Utils=t}(KeyStore||(KeyStore={}));!function(e){(t=e.ConnectionStatus||(e.ConnectionStatus={})).Connected="connected",t.Closed="closed",t.NotStarted="not_connected";var t;e.request_queue=[],e.table_name="LocalStore",e.is_code_executing=!1}(KeyStore||(KeyStore={}));!function(e){e.prcoessExecutionOfCode=function(t){e.request_queue.push(t),1===e.request_queue.length&&e.executeCode()},e.executeCode=function(){if(!e.is_code_executing&&e.request_queue.length>0){e.is_code_executing=!0;var t={Name:e.request_queue[0].Name,Query:e.request_queue[0].Query};e.executeCodeDirect(t)}},e.executeCodeDirect=function(t){new e.Business.Main(function(e){this.processFinishedRequest(e)}.bind(this)).checkConnectionAndExecuteLogic(t)},e.processFinishedRequest=function(t){var r=e.request_queue.shift();e.is_code_executing=!1,t.ErrorOccured?r.OnError?r.OnError(t.ErrorDetails):console.log(t.ErrorDetails):r.OnSuccess&&r.OnSuccess(t.ReturnedValue),this.executeCode()}}(KeyStore||(KeyStore={}));!function(e){!function(e){var t=function(){return function(){this._results=null,this._errorOccured=!1,this._errorCount=0,this.on_errorOccured=function(e){++this._errorCount,1===this._errorCount&&null!=this.OnError&&this.OnError(e.target.error),console.error(e)}}}();e.Base=t}(e.Business||(e.Business={}))}(KeyStore||(KeyStore={}));!function(e){!function(e){var t=function(t){__extends(r,t);function r(r,n,s){var i=t.call(this)||this;return i.get=function(){var e=function(e,t){var r=this._objectStore.index(e).openCursor(IDBKeyRange.only(t));r.onerror=function(e){this._errorOccured=!0,this.on_errorOccured(e)}.bind(this),r.onsuccess=function(e){var t=e.target.result;t&&(this._results=t.value.Value)}.bind(this)}.bind(this);for(var t in this._query.Where){e(t,this._query.Where[t]);break}},i._query=r,i._onError=s,i._transaction=e.db_connection.transaction([r.From],"readonly"),i._objectStore=i._transaction.objectStore(r.From),i._transaction.oncomplete=function(e){null!=n&&n(this._results)}.bind(i),i.get(),i}return r}(e.Base);e.Get=t}(e.Business||(e.Business={}))}(KeyStore||(KeyStore={}));!function(e){!function(e){var t=function(t){__extends(r,t);function r(r,n,s){var i=t.call(this)||this;i.setData=function(e){var t=function(){var t=this._objectStore.index("Key").openCursor(IDBKeyRange.only(e.Key));t.onsuccess=function(t){var n=t.target.result;n?(n.value.Value=e.Value,n.update(n.value)):r()}.bind(this),t.onerror=function(e){this._errorOccured=!0,this.on_errorOccured(e)}.bind(this)}.bind(this),r=function(){this._objectStore.add(e).onerror=function(e){this._errorOccured=!0,this.on_errorOccured(e)}.bind(this)}.bind(this);t()};try{i._onError=s,i._transaction=e.db_connection.transaction([r.TableName],"readwrite"),i._objectStore=i._transaction.objectStore(r.TableName),i._transaction.oncomplete=function(e){null!=n&&n()},i.setData(r.Set)}catch(e){console.error(e)}return i}return r}(e.Base);e.Set=t}(e.Business||(e.Business={}))}(KeyStore||(KeyStore={}));!function(e){!function(e){var t=function(t){__extends(r,t);function r(r,n,s){var i=t.call(this)||this;return i._rowAffected=0,i.remove=function(){var e=function(e,t){var r=this._objectStore.index(e).openCursor(IDBKeyRange.only(t));r.onerror=function(e){this._errorOccured=!0,this.on_errorOccured(e)}.bind(this),r.onsuccess=function(e){var t=e.target.result;t&&(t.delete(),++this._rowAffected,t.continue())}.bind(this)}.bind(this);for(var t in this._query.Where){this._errorOccured||e(t,this._query.Where[t]);break}},i._query=r,i._onError=s,i._transaction=e.db_connection.transaction([r.From],"readwrite"),i._objectStore=i._transaction.objectStore(r.From),i._transaction.oncomplete=function(){null!=n&&n(this._rowAffected)}.bind(i),i._transaction.onerror=function(e){this.on_errorOccured(e)}.bind(i),i.remove(),i}return r}(e.Base);e.Remove=t}(e.Business||(e.Business={}))}(KeyStore||(KeyStore={}));!function(e){!function(t){var r=function(){return function(r,n,s,i){var o=self.indexedDB.open(r,1);o.onerror=function(e){"InvalidStateError"===e.target.error.name&&(JsStore.status={ConStatus:JsStore.Connection_Status.UnableToStart,LastError:JsStore.Error_Type.IndexedDbBlocked}),null!=i&&i(e.target.error)},o.onsuccess=function(r){t.status.ConStatus=e.ConnectionStatus.Connected,t.db_connection=o.result,t.db_connection.onclose=function(){t.status.ConStatus=e.ConnectionStatus.Closed,t.status.LastError="Connection Closed"},t.db_connection.onversionchange=function(e){null===e.newVersion&&e.target.close()},t.db_connection.onerror=function(e){t.status.LastError="Error occured in connection :"+e.target.result},t.db_connection.onabort=function(r){t.status.ConStatus=e.ConnectionStatus.Closed,t.status.LastError="Connection aborted"},null!=s&&s()},o.onupgradeneeded=function(e){e.target.result.createObjectStore(n,{keyPath:"Key"}).createIndex("Key","Key",{unique:!0})}}}();t.InitDb=r}(e.Business||(e.Business={}))}(KeyStore||(KeyStore={}));!function(e){!function(t){t.status={ConStatus:e.ConnectionStatus.NotStarted,LastError:""};var r=function(){return function(r){void 0===r&&(r=null),this.set=function(e,r,n){new t.Set(e,r,n)},this.remove=function(e,r,n){new t.Remove(e,r,n)},this.get=function(e,r,n){new t.Get(e,r,n)},this.createDb=function(e,r,n){new t.InitDb("KeyStore",e,r,n)},this.checkConnectionAndExecuteLogic=function(r){"create_db"===r.Name||"open_db"===r.Name?this.executeLogic(r):t.status.ConStatus===e.ConnectionStatus.Connected?this.executeLogic(r):t.status.ConStatus===e.ConnectionStatus.NotStarted?setTimeout(function(){this.checkConnectionAndExecuteLogic(r)}.bind(this),100):t.status.ConStatus===e.ConnectionStatus.Closed&&this.createDb(e.table_name,function(){this.checkConnectionAndExecuteLogic(r)}.bind(this),100)},this.returnResult=function(e){this._onSuccess&&this._onSuccess(e)},this.executeLogic=function(e){var t=function(e){this.returnResult({ReturnedValue:e})}.bind(this),r=function(e){this.returnResult({ErrorOccured:!0,ErrorDetails:e})}.bind(this);switch(e.Name){case"get":this.get(e.Query,t,r);break;case"set":this.set(e.Query,t,r);break;case"remove":this.remove(e.Query,t,r);break;case"create_db":this.createDb(e.Query,t,r)}},this._onSuccess=r}}();t.Main=r}(e.Business||(e.Business={}))}(KeyStore||(KeyStore={}));var KeyStore;!function(e){e.init=function(){e.Utils.setDbType(),indexedDB&&e.prcoessExecutionOfCode({Name:"create_db",Query:e.table_name})},e.get=function(t,r,n){void 0===n&&(n=null);var s={From:e.table_name,Where:{Key:t}};return e.prcoessExecutionOfCode({Name:"get",Query:s,OnSuccess:r,OnError:n}),this},e.set=function(t,r,n,s){var i={TableName:e.table_name,Set:{Key:t,Value:r}};return e.prcoessExecutionOfCode({Name:"set",Query:i,OnSuccess:n,OnError:s}),this},e.remove=function(t,r,n){void 0===r&&(r=null),void 0===n&&(n=null);var s={From:e.table_name,Where:{Key:t}};return e.prcoessExecutionOfCode({Name:"remove",Query:s,OnSuccess:r,OnError:n}),this}}(KeyStore||(KeyStore={}));!function(e){(t=e.Occurence||(e.Occurence={})).First="f",t.Last="l",t.Any="a";var t;(r=e.WebWorker_Status||(e.WebWorker_Status={})).Registered="registerd",r.Failed="failed",r.NotStarted="not_started";var r;(n=e.Connection_Status||(e.Connection_Status={})).Connected="connected",n.Closed="closed",n.NotStarted="not_started",n.UnableToStart="unable_to_start";var n;(s=e.WhereQryOption||(e.WhereQryOption={})).In="In",s.Like="Like",s.Or="Or";var s;(i=e.DataType||(e.DataType={})).String="string",i.Object="object",i.Array="array";var i}(JsStore||(JsStore={}));!function(e){e.enable_log=!1,e.db_version=0,e.status={ConStatus:e.Connection_Status.NotStarted,LastError:null},e.temp_results=[],e.getObjectFirstKey=function(e){for(var t in e)return t;return null},e.log=function(t){e.enable_log&&console.log(t)},e.logError=function(t){e.enable_log&&console.error(t)}}(JsStore||(JsStore={}));!function(e){var t=function(){function e(){}return e.convertObjectintoLowerCase=function(e){for(var t=Object.keys(e),r=t.length;r--;){var n=t[r];e[n.toLowerCase()]=e[n],delete e[n]}},e}();e.Utils=t}(JsStore||(JsStore={}));!function(e){e.isDbExist=function(t,r,n){void 0===r&&(r=null),void 0===n&&(n=null);var s=!r;if(e.status.ConStatus!==e.Connection_Status.UnableToStart){if(s)return new Promise(function(r,n){"string"==typeof t?e.getDbVersion(t,function(e){r(Boolean(e))}):e.getDbVersion(t.DbName,function(e){r(t.Table.Version<=e)})});"string"==typeof t?e.getDbVersion.call(this,t,function(e){r.call(this,Boolean(e))}):e.getDbVersion.call(this,t.DbName,function(e){r.call(this,t.Table.Version<=e)})}else{var i={_type:e.status.LastError,_message:null};switch(i._type){case e.Error_Type.IndexedDbBlocked:i._message="IndexedDB is blocked";break;case e.Error_Type.IndexedDbUndefined:i._message="IndexedDB is not supported"}if(s)return new Promise(function(e,t){t(i)});n&&n(i)}},e.getDbVersion=function(e,t){KeyStore.get("JsStore_"+e+"_Db_Version",function(e){t.call(this,Number(e))}.bind(this))},e.getDbSchema=function(t,r){r&&KeyStore.get("JsStore_"+t+"_Schema",function(n){if(n)if(n._name)r(n);else{var s=new e.Model.DataBase(n);KeyStore.set("JsStore_"+t+"_Schema",s),r(s)}else r(n)})},e.isNull=function(e){if(null==e)return!0;switch(typeof e){case"string":return 0===e.length;case"number":return isNaN(e)}return!1},e.enableLog=function(){e.enable_log=!0,e.worker_instance&&e.worker_instance.postMessage({Name:"change_log_status",Query:{logging:e.enable_log}})},e.disableLog=function(){e.enable_log=!1,e.worker_instance&&e.worker_instance.postMessage({Name:"change_log_status",Query:{logging:e.enable_log}})}}(JsStore||(JsStore={}));!function(e){var t;(r=t=e.Error_Type||(e.Error_Type={})).UndefinedColumn="undefined_column",r.UndefinedValue="undefined_value",r.UndefinedColumnName="undefined_column_name",r.UndefinedDbName="undefined_database_name",r.UndefinedColumnValue="undefined_column_value",r.NotArray="not_array",r.NoValueSupplied="no_value_supplied",r.ColumnNotExist="column_not_exist",r.InvalidOp="invalid_operator",r.NullValue="null_value",r.BadDataType="bad_data_type",r.NextJoinNotExist="next_join_not_exist",r.TableNotExist="table_not_exist",r.DbNotExist="db_not_exist",r.IndexedDbUndefined="indexeddb_undefined",r.IndexedDbBlocked="indexeddb_blocked",r.ConnectionAborted="connection_aborted",r.ConnectionClosed="connection_closed",r.NotObject="not_object";var r,n=function(){function e(e,r){void 0===r&&(r=null),this.throw=function(){throw this.get()},this.logError=function(){console.error(this.get())},this.logWarning=function(){console.warn(this.get())},this.getMsg=function(){var e;switch(this._type){case t.NotArray:e="Supplied value is not an array";break;case t.UndefinedColumn:e="Column is undefined in Where";break;case t.UndefinedValue:e="Value is undefined in Where";break;case t.UndefinedColumnName:e="Column name is undefined '"+this._info.TableName+"'";break;case t.UndefinedDbName:e="Database name is not supplied";break;case t.UndefinedColumnValue:e="Column value is undefined";break;case t.NoValueSupplied:e="No value supplied";break;case t.InvalidOp:e="Invalid Op Value '"+this._info.Op+"'";break;case t.ColumnNotExist:e="Column '"+this._info.ColumnName+"' does not exist";break;case t.NullValue:e="Null value is not allowed for column '"+this._info.ColumnName+"'";break;case t.BadDataType:e="Supplied value for column '"+this._info.ColumnName+"' does not have valid type";break;case t.NextJoinNotExist:e="Next join details not supplied";break;case t.TableNotExist:e="Table '"+this._info.TableName+"' does not exist";break;case t.DbNotExist:e="Database '"+this._info.DbName+"' does not exist";break;case t.NotObject:e="supplied value is not object";break;default:e=this._message}return e},this._type=e,this._info=r,this._message=this.getMsg()}return e.prototype.get=function(){return{_message:this._message,_type:this._type}},e}();e.Error=n}(JsStore||(JsStore={}));!function(e){!function(t){var r=function(){return function(t,r){null!=t.Name?this._name=t.Name:new e.Error(e.Error_Type.UndefinedColumnName,{TableName:r}).throw();this._autoIncrement=null!=t.AutoIncrement&&t.AutoIncrement,this._primaryKey=null!=t.PrimaryKey&&t.PrimaryKey,this._unique=null!=t.Unique&&t.Unique,this._notNull=null!=t.NotNull&&t.NotNull,this._dataType=null!=t.DataType?t.DataType:t.AutoIncrement?"number":null,this._default=t.Default,this._multiEntry=null!=t.MultiEntry}}();t.Column=r}(e.Model||(e.Model={}))}(JsStore||(JsStore={}));!function(e){!function(e){var t=function(){return function(t){this._columns=[],this._name=t.Name,this._version=null==t.Version?1:t.Version,t.Columns.forEach(function(r){this._columns.push(new e.Column(r,t.Name))},this)}}();e.Table=t}(e.Model||(e.Model={}))}(JsStore||(JsStore={}));!function(e){!function(t){var r=function(){function t(e){this._columns=[],this._requireDelete=!1,this._requireCreation=!1,this.createMetaData=function(e,t){this._callback=t,this.setRequireDelete(e),this.setDbVersion(e)},this._name=e._name,this._version=e._version,this._columns=e._columns,this.setPrimaryKey()}return t.prototype.setPrimaryKey=function(){this._columns.every(function(e){return this._primaryKey=e._primaryKey?e._name:"",!e._primaryKey},this)},t.prototype.setRequireDelete=function(e){KeyStore.get("JsStore_"+e+"_"+this._name+"_Version",function(e){null==e?this._requireCreation=!0:e<this._version&&(this._requireDelete=!0)}.bind(this))},t.prototype.setDbVersion=function(t){e.db_version=e.db_version>this._version?e.db_version:this._version,KeyStore.set("JsStore_"+t+"_Db_Version",e.db_version).set("JsStore_"+t+"_"+this._name+"_Version",e.db_version,this._callback),this._version=e.db_version},t}();t.TableHelper=r}(e.Model||(e.Model={}))}(JsStore||(JsStore={}));!function(e){!function(e){var t=function(){return function(t){this._tables=[],this.createMetaData=function(t){var r=0,n=[],s=function(){if(r<this._tables.length){var i=this._tables[r],o=new e.TableHelper(i);o.createMetaData(this._name,function(){o._callback=null,n.push(o),s()}),++r}else t(n)}.bind(this);s()},this._name=t._name,this._tables=t._tables}}();e.DbHelper=t}(e.Model||(e.Model={}))}(JsStore||(JsStore={}));!function(e){!function(e){var t=function(){return function(t){this._tables=[],this._name=t.Name,t.Tables.forEach(function(t){this._tables.push(new e.Table(t))},this)}}();e.DataBase=t}(e.Model||(e.Model={}))}(JsStore||(JsStore={}));!function(e){!function(t){var r=function(){function r(){this.filterOnOccurence=function(t){var r=!1;switch(t=t.toLowerCase(),this._compSymbol){case e.Occurence.Any:t.indexOf(this._compValue)>=0&&(r=!0);break;case e.Occurence.First:0===t.indexOf(this._compValue)&&(r=!0);break;default:t.lastIndexOf(this._compValue)===t.length-this._compValueLength&&(r=!0)}return r},this.getArrayFromWord=function(e){return e.split(" ")},this.getTable=function(e){var r;return t.active_db._tables.every(function(t){return t._name!==e||(r=t,!1)}),r},this.getKeyRange=function(e,t){var r;switch(t){case"-":r=IDBKeyRange.bound(e.Low,e.High,!1,!1);break;case">":r=IDBKeyRange.lowerBound(e,!0);break;case">=":r=IDBKeyRange.lowerBound(e);break;case"<":r=IDBKeyRange.upperBound(e,!0);break;case"<=":r=IDBKeyRange.upperBound(e);break;default:r=IDBKeyRange.only(e)}return r},this.getObjectSecondKey=function(e){var t=!1;for(var r in e){if(t)return r;t=!0}},this.getPrimaryKey=function(e){var t=this.getTable(e)._primaryKey;return t||this.getKeyPath(e)},this.getKeyPath=function(e){return t.db_connection.transaction([e],"readonly").objectStore(e).keyPath},this.sortNumberInAsc=function(e){return e.sort(function(e,t){return e-t}),e},this.sortNumberInDesc=function(e){return e.sort(function(e,t){return t-e}),e},this.sortAlphabetInAsc=function(e){return e.sort(function(e,t){return e.toLowerCase().localeCompare(t.toLowerCase())}),e},this.sortAlphabetInDesc=function(e){return e.sort(function(e,t){return t.toLowerCase().localeCompare(e.toLowerCase())}),e}}return r.prototype.getAllCombinationOfWord=function(e,t){if(t){for(var r=[],n=0,s=e.length;n<s;n++)r=r.concat(this.getCombination(e[n]));return r}return this.getCombination(e)},r.prototype.getCombination=function(e){var t=[],r=function(e,n,s){if(s===e.length)t.push(n.join(""));else{var i=e.charAt(s);n[s]=i.toLowerCase(),r(e,n,s+1),n[s]=i.toUpperCase(),r(e,n,s+1)}};return r(e,[],0),t},r}();t.BaseHelper=r}(e.Business||(e.Business={}))}(JsStore||(JsStore={}));!function(e){!function(t){var r=function(r){__extends(n,r);function n(){var n=null!==r&&r.apply(this,arguments)||this;return n._errorOccured=!1,n._errorCount=0,n._rowAffected=0,n._sendResultFlag=!0,n.onErrorOccured=function(t,r){if(void 0===r&&(r=!1),++this._errorCount,1===this._errorCount&&null!=this._onError)if(r)this._onError(t),e.logError(t);else{var n={_message:t.target.error.message,_type:t.target.error.name};this._onError(n),e.logError(n)}},n.onTransactionTimeout=function(e){console.error("transaction timed out")},n.onExceptionOccured=function(t,r){switch(t.name){case"NotFoundError":var n=new e.Error(e.Error_Type.TableNotExist,r);this.onErrorOccured(n.get(),!0);break;default:console.error(t)}},n.goToWhereLogic=function(){this._whereChecker=new t.WhereChecker(this._query.Where);var r=e.getObjectFirstKey(this._query.Where);if(!0===this._query.IgnoreCase&&(this._query.Where=this.makeQryInCaseSensitive(this._query.Where)),this._objectStore.indexNames.contains(r)){var n=this._query.Where[r];if("object"==typeof n){this._checkFlag=Boolean(Object.keys(n).length>1||Object.keys(this._query.Where).length>1);var s=e.getObjectFirstKey(n);switch(s){case"Like":var i,o,c=n.Like.split("%");c[1]?(i=c[1],o=c.length>2?e.Occurence.Any:e.Occurence.Last):(i=c[0],o=e.Occurence.First),o===e.Occurence.First?(this.getAllCombinationOfWord(i).forEach(function(e){this.executeWhereLogic(r,{"-":{Low:e,High:e+"￿"}},"-")},this),delete this._query.Where[r].Like):this.executeLikeLogic(r,i,o);break;case"In":this.executeInLogic(r,n.In);break;case"-":case">":case"<":case">=":case"<=":this.executeWhereLogic(r,n,s);break;case"Aggregate":break;default:this.executeWhereLogic(r,n)}}else this._checkFlag=Boolean(Object.keys(this._query.Where).length>1),this.executeWhereLogic(r,n)}else this._errorOccured=!0,this._error=new e.Error(e.Error_Type.ColumnNotExist,{ColumnName:r}),this._error.throw()},n.makeQryInCaseSensitive=function(t){var r,n,s=[];for(var i in t)if("object"==typeof(r=t[i])){for(var o in r)switch(n=r[o],o){case e.WhereQryOption.In:s=s.concat(this.getAllCombinationOfWord(n,!0));break;case e.WhereQryOption.Like:break;default:s=s.concat(this.getAllCombinationOfWord(n))}t[i].In=s}else s=s.concat(this.getAllCombinationOfWord(r)),t[i]={In:s};return t},n}return n}(t.BaseHelper);t.Base=r}(e.Business||(e.Business={}))}(JsStore||(JsStore={}));!function(e){!function(t){var r=function(){return function(r,n,s){var i=[],o=indexedDB.open(t.active_db._name,e.db_version);o.onerror=function(e){null!=s&&s(e.target.error)},o.onsuccess=function(r){e.status.ConStatus=e.Connection_Status.Connected,t.db_connection=o.result,t.db_connection.onclose=function(){e.status.ConStatus=e.Connection_Status.Closed,e.status.LastError=e.Error_Type.ConnectionClosed},t.db_connection.onversionchange=function(e){null===e.newVersion&&e.target.close()},t.db_connection.onerror=function(t){e.status.LastError="Error occured in connection :"+t.target.result},t.db_connection.onabort=function(t){e.status.ConStatus=e.Connection_Status.Closed,e.status.LastError=e.Error_Type.ConnectionAborted},null!=n&&n(i)},o.onupgradeneeded=function(e){t.db_connection=e.target.result,r.forEach(function(e,r){e._requireDelete?(t.db_connection.objectStoreNames.contains(e._name)&&t.db_connection.deleteObjectStore(e._name),c(e,r)):e._requireCreation&&c(e,r)})};var c=function(e,r){try{if(e._primaryKey.length>0){t.active_db._tables[r]._primaryKey=e._primaryKey;var n=t.db_connection.createObjectStore(e._name,{keyPath:e._primaryKey});e._columns.forEach(function(r){var s=r._primaryKey?{unique:!0}:{unique:r._unique};s.multiEntry=r._multiEntry,n.createIndex(r._name,r._name,s),r._autoIncrement&&KeyStore.set("JsStore_"+t.active_db._name+"_"+e._name+"_"+r._name+"_Value",0)})}else n=t.db_connection.createObjectStore(e._name,{autoIncrement:!0}),e._columns.forEach(function(r){var s={unique:r._unique,multiEntry:r._multiEntry};n.createIndex(r._name,r._name,s),r._autoIncrement&&KeyStore.set("JsStore_"+t.active_db._name+"_"+e._name+"_"+r._name+"_Value",0)});i.push(e._name),KeyStore.set("JsStore_"+t.active_db._name+"_"+e._name+"_Version",e._version)}catch(e){console.error(e)}}}}();t.CreateDb=r}(e.Business||(e.Business={}))}(JsStore||(JsStore={}));!function(e){!function(t){var r=function(){return function(r,n,s){this.deleteDb=function(r,n,s){var i=indexedDB.deleteDatabase(r);i.onblocked=function(){null!=s&&s("database is blocked, cant be deleted right now.")},i.onerror=function(e){null!=s&&s(event.target.error)},i.onsuccess=function(){e.status.ConStatus=e.Connection_Status.Closed,KeyStore.remove("JsStore_"+t.active_db._name+"_Db_Version"),t.active_db._tables.forEach(function(e){KeyStore.remove("JsStore_"+t.active_db._name+"_"+e._name+"_Version"),e._columns.forEach(function(r){r._autoIncrement&&KeyStore.remove("JsStore_"+t.active_db._name+"_"+e._name+"_"+r._name+"_Value")})}),KeyStore.remove("JsStore_"+t.active_db._name+"_Schema",n)}},setTimeout(function(){this.deleteDb(r,n,s)}.bind(this),100)}}();t.DropDb=r}(e.Business||(e.Business={}))}(JsStore||(JsStore={}));!function(e){!function(t){var r=function(r){__extends(n,r);function n(n,s,i){var o=r.call(this)||this;o.bulkinsertData=function(){this._transaction=t.db_connection.transaction([this._query.Into],"readwrite"),this._objectStore=this._transaction.objectStore(this._query.Into),this._transaction.oncomplete=function(e){this._onSuccess()}.bind(this),this._query.Values.forEach(function(e){this._objectStore.add(e)},this)};try{if(o._query=n,o._onSuccess=s,o._onError=i,o.getTable(n.Into))o.bulkinsertData();else{new e.Error(e.Error_Type.TableNotExist,{TableName:n.Into}).throw()}}catch(e){o.onExceptionOccured(e,{TableName:n.Into})}return o}return n}(t.Base);t.BulkInsert=r}(e.Business||(e.Business={}))}(JsStore||(JsStore={}));!function(e){!function(t){var r=function(){return function(r,n,s){if(this.setPrimaryKey=function(){t.active_db._tables.forEach(function(e,r){e._columns.every(function(e){return t.active_db._tables[r]._primaryKey=e._primaryKey?e._name:"",!e._primaryKey})})},t.active_db._name.length>0){var i=indexedDB.open(t.active_db._name,r);i.onerror=function(e){null!=s&&s(e.target.error)},i.onsuccess=function(r){e.status.ConStatus=e.Connection_Status.Connected,t.db_connection=i.result,t.db_connection.onclose=function(){e.status.ConStatus=e.Connection_Status.Closed,e.status.LastError=e.Error_Type.ConnectionClosed},t.db_connection.onversionchange=function(e){null===e.newVersion&&e.target.close()},t.db_connection.onerror=function(t){e.status.LastError="Error occured in connection :"+t.target.result},t.db_connection.onabort=function(t){e.status.ConStatus=e.Connection_Status.Closed,e.status.LastError=e.Error_Type.ConnectionAborted},null!=n&&n(),this.setPrimaryKey()}.bind(this)}else new e.Error(e.Error_Type.UndefinedDbName).throw()}}();t.OpenDb=r}(e.Business||(e.Business={}))}(JsStore||(JsStore={}));!function(e){!function(e){var t=function(t){__extends(r,t);function r(r,n,s){var i=t.call(this)||this,o=e.db_connection.transaction([r],"readwrite").objectStore(r).clear();return o.onsuccess=function(t){this.getTable(r)._columns.forEach(function(t){t._autoIncrement&&KeyStore.set("JsStore_"+e.active_db._name+"_"+r+"_"+t._name+"_Value",0)}),null!=n&&n()}.bind(i),o.onerror=function(e){null!=s&&s(e)},i}return r}(e.Base);e.Clear=t}(e.Business||(e.Business={}))}(JsStore||(JsStore={}));!function(e){!function(t){var r=function(){return function(r){void 0===r&&(r=null),this.checkConnectionAndExecuteLogic=function(r){switch(e.log("checking connection and executing request:"+r.Name),r.Name){case"create_db":case"open_db":this.executeLogic(r);break;case"change_log_status":this.changeLogStatus(r);default:switch(e.status.ConStatus){case e.Connection_Status.Connected:this.executeLogic(r);break;case e.Connection_Status.Closed:this.openDb(t.active_db._name,function(){this.checkConnectionAndExecuteLogic(r)}.bind(this))}}},this.changeLogStatus=function(t){!0===t.Query.logging?e.enable_log=!0:e.enable_log=!1},this.returnResult=function(e){this._onSuccess?this._onSuccess(e):self.postMessage(e)},this.executeLogic=function(e){var t=function(e){this.returnResult({ReturnedValue:e})}.bind(this),r=function(e){this.returnResult({ErrorDetails:e,ErrorOccured:!0})}.bind(this);switch(e.Name){case"select":this.select(e.Query,t,r);break;case"insert":this.insert(e.Query,t,r);break;case"update":this.update(e.Query,t,r);break;case"delete":this.delete(e.Query,t,r);break;case"open_db":this.openDb(e.Query,t,r);break;case"create_db":this.createDb(e.Query,t,r);break;case"clear":this.clear(e.Query,t,r);break;case"drop_db":this.dropDb(t,r);break;case"count":this.count(e.Query,t,r);break;case"bulk_insert":this.bulkInsert(e.Query,t,r);break;case"export_json":this.exportJson(e.Query,t,r);break;default:console.error("The Api:-"+e.Name+"does not support")}},this.openDb=function(r,n,s){e.getDbVersion(r,function(i){null!=i?e.getDbSchema(r,function(e){t.active_db=e,new t.OpenDb(i,n,s)}):new e.Error(e.Error_Type.DbNotExist,{DbName:r}).throw()})},this.closeDb=function(){e.status.ConStatus===e.Connection_Status.Connected&&t.db_connection.close()},this.dropDb=function(e,r){this.closeDb(),new t.DropDb(t.active_db._name,e,r)},this.update=function(e,r,n){new t.Update.Instance(e,r,n)},this.insert=function(r,n,s){if(Array.isArray(r.Values))new t.Insert.Instance(r,n,s);else{var i=new e.Error(e.Error_Type.NotArray);i.logError(),s(i.get())}},this.bulkInsert=function(r,n,s){if(Array.isArray(r.Values))new t.BulkInsert(r,n,s);else{var i=new e.Error(e.Error_Type.NotArray);i.logError(),s(i.get())}},this.delete=function(e,r,n){new t.Delete.Instance(e,r,n)},this.select=function(e,r,n){"object"==typeof e.From?new t.Select.Join(e,r,n):new t.Select.Instance(e,r,n)},this.count=function(e,r,n){"object"==typeof e.From?(e.Count=!0,new t.Select.Join(e,r,n)):new t.Count.Instance(e,r,n)},this.createDb=function(r,n,s){this.closeDb(),KeyStore.get("JsStore_"+r.Name+"_Db_Version",function(i){e.db_version=i||1,t.active_db=new e.Model.DataBase(r),KeyStore.set("JsStore_"+t.active_db._name+"_Schema",t.active_db),new e.Model.DbHelper(t.active_db).createMetaData(function(e){new t.CreateDb(e,n,s)})})},this.clear=function(e,r,n){new t.Clear(e,r,n)},this.exportJson=function(e,t,r){this.select(e,function(e){var r=URL.createObjectURL(new Blob([JSON.stringify(e)],{type:"text/json"}));t(r)},function(e){r(e)})},this._onSuccess=r}}();t.Main=r}(e.Business||(e.Business={}))}(JsStore||(JsStore={}));!function(e){!function(t){var r=function(){return function(t){this.check=function(e){this._status=!0;var t;for(var r in this._where){if(!this._status)break;if("object"==typeof(t=this._where[r]))for(var n in t){if(!this._status)break;switch(n){case"In":this.checkIn(r,e[r]);break;case"Like":this.checkLike(r,e[r]);break;case"-":case">":case"<":case">=":case"<=":this.checkComparisionOp(r,e[r],n)}}else if(t!==e[r]){this._status=!1;break}}return this._status},this.checkIn=function(e,t){for(var r=0,n=this._where[e].In,s=n.length;r<s;r++){if(n[r]===t){this._status=!0;break}this._status=!1}},this.checkLike=function(t,r){var n,s,i,o=this._where[t].Like.split("%");switch(o[1]?(s=o[1],n=o.length>2?e.Occurence.Any:e.Occurence.Last):(s=o[0],n=e.Occurence.First),r=r.toLowerCase(),n){case e.Occurence.Any:(i=r.indexOf(s.toLowerCase()))<0&&(this._status=!1);break;case e.Occurence.First:((i=r.indexOf(s.toLowerCase()))>0||i<0)&&(this._status=!1);break;default:(i=r.lastIndexOf(s.toLowerCase()))<r.length-s.length&&(this._status=!1)}},this.checkComparisionOp=function(e,t,r){var n=this._where[e][r];switch(r){case">":t<=n&&(this._status=!1);break;case"<":t>=n&&(this._status=!1);break;case"<=":t>n&&(this._status=!1);break;case">=":t<n&&(this._status=!1);break;case"-":(t<n.Low||t>n.High)&&(this._status=!1)}},this._where=t}}();t.WhereChecker=r}(e.Business||(e.Business={}))}(JsStore||(JsStore={}));!function(e){(function(e){var r=function(e){__extends(t,e);function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._results=[],t._sorted=!1,t._checkFlag=!1,t.removeDuplicates=function(){var e=this._results;this._results=void 0;var t=this.getPrimaryKey(this._query.From),r={};for(var n in e)r[e[n][t]]=e[n];e=[];for(n in r)e.push(r[n]);this._results=e},t}return t}(t.Base);e.BaseSelect=r})((t=e.Business||(e.Business={})).Select||(t.Select={}));var t}(JsStore||(JsStore={}));!function(e){(function(t){var r=function(t){__extends(r,t);function r(){var r=null!==t&&t.apply(this,arguments)||this;return r.executeWhereUndefinedLogic=function(){if(this._query.Order&&this._query.Order.By)if(this._objectStore.indexNames.contains(this._query.Order.By)){var t=this._query.Order.Type&&"desc"===this._query.Order.Type.toLowerCase()?"prev":"next";this._sorted=!0,this._cursorOpenRequest=this._objectStore.index(this._query.Order.By).openCursor(null,t)}else new e.Error(e.Error_Type.ColumnNotExist,{ColumnName:this._query.Order.By}).throw();else this._cursorOpenRequest=this._objectStore.openCursor();this._skipRecord&&this._limitRecord?this.executeSkipAndLimitForNoWhere():this._skipRecord?this.executeSkipForNoWhere():this._limitRecord?this.executeLimitForNotWhere():this.executeSimpleForNotWhere(),this._cursorOpenRequest.onerror=function(e){this._errorOccured=!0,this.onErrorOccured(e)}.bind(this)},r.executeSkipAndLimitForNoWhere=function(){var e,t=!1;this._cursorOpenRequest.onsuccess=function(r){(e=r.target.result)&&(t&&this._results.length!==this._limitRecord?(this._results.push(e.value),e.continue()):(t=!0,e.advance(this._skipRecord)))}.bind(this)},r.executeSkipForNoWhere=function(){var e,t=!1;this._cursorOpenRequest.onsuccess=function(r){(e=r.target.result)&&(t?(this._results.push(e.value),e.continue()):(t=!0,e.advance(this._skipRecord)))}.bind(this)},r.executeSimpleForNotWhere=function(){var e;this._cursorOpenRequest.onsuccess=function(t){(e=t.target.result)&&(this._results.push(e.value),e.continue())}.bind(this)},r.executeLimitForNotWhere=function(){var e;this._cursorOpenRequest.onsuccess=function(t){(e=t.target.result)&&this._results.length!==this._limitRecord&&(this._results.push(e.value),e.continue())}.bind(this)},r}return r}(t.BaseSelect);t.NotWhere=r})((t=e.Business||(e.Business={})).Select||(t.Select={}));var t}(JsStore||(JsStore={}));!function(e){(function(e){var t=function(e){__extends(t,e);function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.executeInLogic=function(e,t){this._skipRecord&&this._limitRecord?this.executeSkipAndLimitForIn(e,t):this._skipRecord?this.executeSkipForIn(e,t):this._limitRecord?this.executeLimitForIn(e,t):this.executeSimpleForIn(e,t)},t.executeSkipAndLimitForIn=function(e,t){var r,n,s=this._skipRecord,i=this._objectStore.index(e),o=function(e){0===s?this._results.push(e):--s}.bind(this);if(this._checkFlag)for(var c=0,u=t.length;c<u;c++)this._errorOccured||((n=i.openCursor(IDBKeyRange.only(t[c]))).onsuccess=function(e){r=e.target.result,this._results.length!==this._limitRecord&&r&&(this._whereChecker.check(r.value)&&o(r.value),r.continue())}.bind(this));else for(c=0,u=t.length;c<u;c++)this._errorOccured||((n=i.openCursor(IDBKeyRange.only(t[c]))).onsuccess=function(e){r=e.target.result,this._results.length!==this._limitRecord&&r&&(o(r.value),r.continue())}.bind(this));n.onerror=function(e){this._errorOccured=!0,this.onErrorOccured(e)}.bind(this)},t.executeSkipForIn=function(e,t){var r,n,s=this._skipRecord,i=this._objectStore.index(e),o=function(e){0===s?this._results.push(e):--s}.bind(this);if(this._checkFlag)for(var c=0,u=t.length;c<u;c++)this._errorOccured||((n=i.openCursor(IDBKeyRange.only(t[c]))).onsuccess=function(e){(r=e.target.result)&&(this._whereChecker.check(r.value)&&o(r.value),r.continue())}.bind(this));else for(c=0,u=t.length;c<u;c++)this._errorOccured||((n=i.openCursor(IDBKeyRange.only(t[c]))).onsuccess=function(e){(r=e.target.result)&&(o(r.value),r.continue())}.bind(this));n.onerror=function(e){this._errorOccured=!0,this.onErrorOccured(e)}.bind(this)},t.executeLimitForIn=function(e,t){var r,n,s=this._objectStore.index(e);if(this._checkFlag)for(var i=0,o=t.length;i<o;i++)this._errorOccured||((n=s.openCursor(IDBKeyRange.only(t[i]))).onsuccess=function(e){(r=e.target.result)&&this._results.length!==this._limitRecord&&(this._whereChecker.check(r.value)&&this._results.push(r.value),r.continue())}.bind(this));else for(i=0,o=t.length;i<o;i++)this._errorOccured||((n=s.openCursor(IDBKeyRange.only(t[i]))).onsuccess=function(e){(r=e.target.result)&&this._results.length!==this._limitRecord&&(this._results.push(r.value),r.continue())}.bind(this));n.onerror=function(e){this._errorOccured=!0,this.onErrorOccured(e)}.bind(this)},t.executeSimpleForIn=function(e,t){var r,n,s=this._objectStore.index(e);if(this._checkFlag)for(var i=0,o=t.length;i<o;i++)this._errorOccured||((n=s.openCursor(IDBKeyRange.only(t[i]))).onsuccess=function(e){(r=e.target.result)&&(this._whereChecker.check(r.value)&&this._results.push(r.value),r.continue())}.bind(this));else for(i=0,o=t.length;i<o;i++)this._errorOccured||((n=s.openCursor(IDBKeyRange.only(t[i]))).onsuccess=function(e){(r=e.target.result)&&(this._results.push(r.value),r.continue())}.bind(this));n.onerror=function(e){this._errorOccured=!0,this.onErrorOccured(e)}.bind(this)},t}return t}(e.NotWhere);e.In=t})((t=e.Business||(e.Business={})).Select||(t.Select={}));var t}(JsStore||(JsStore={}));!function(e){(function(e){var t=function(e){__extends(t,e);function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.executeLikeLogic=function(e,t,r){this._compValue=t.toLowerCase(),this._compValueLength=this._compValue.length,this._compSymbol=r,this._cursorOpenRequest=this._objectStore.index(e).openCursor(),this._cursorOpenRequest.onerror=function(e){this._errorOccured=!0,this.onErrorOccured(e)}.bind(this),this._skipRecord&&this._limitRecord?this.executeSkipAndLimit():this._skipRecord?this.executeSkip():this._limitRecord?this.executeLimit():this.executeSimple()},t.executeSkipAndLimit=function(){var e,t=this._skipRecord,r=function(e){0===t?this._results.push(e):--t}.bind(this);this._checkFlag?this._cursorOpenRequest.onsuccess=function(t){e=t.target.result,this._results.length!==this._limitRecord&&e&&(this.filterOnOccurence(e.key)&&this._whereChecker.check(e.value)&&r(e.value),e.continue())}.bind(this):this._cursorOpenRequest.onsuccess=function(t){e=t.target.result,this._results.length!==this._limitRecord&&e&&(this.filterOnOccurence(e.key)&&r(e.value),e.continue())}.bind(this)},t.executeSkip=function(){var e,t=this._skipRecord,r=function(e){0===t?this._results.push(e):--t}.bind(this);this._checkFlag?this._cursorOpenRequest.onsuccess=function(t){(e=t.target.result)&&(this.filterOnOccurence(e.key)&&this._whereChecker.check(e.value)&&r(e.value),e.continue())}.bind(this):this._cursorOpenRequest.onsuccess=function(t){(e=t.target.result)&&(this.filterOnOccurence(e.key)&&r(e.value),e.continue())}.bind(this)},t.executeLimit=function(){var e;this._checkFlag?this._cursorOpenRequest.onsuccess=function(t){e=t.target.result,this._results.length!==this._limitRecord&&e&&(this.filterOnOccurence(e.key)&&this._whereChecker.check(e.value)&&this._results.push(e.value),e.continue())}.bind(this):this._cursorOpenRequest.onsuccess=function(t){e=t.target.result,this._results.length!==this._limitRecord&&e&&(this.filterOnOccurence(e.key)&&this._results.push(e.value),e.continue())}.bind(this)},t.executeSimple=function(){var e;this._checkFlag?this._cursorOpenRequest.onsuccess=function(t){(e=t.target.result)&&(this.filterOnOccurence(e.key)&&this._whereChecker.check(e.value)&&this._results.push(e.value),e.continue())}.bind(this):this._cursorOpenRequest.onsuccess=function(t){(e=t.target.result)&&(this.filterOnOccurence(e.key)&&this._results.push(e.value),e.continue())}.bind(this)},t}return t}(e.In);e.Like=t})((t=e.Business||(e.Business={})).Select||(t.Select={}));var t}(JsStore||(JsStore={}));!function(e){(function(e){var t=function(e){__extends(t,e);function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.executeSkipAndLimitForWhere=function(){var e,t=!1;this._checkFlag?this._cursorOpenRequest.onsuccess=function(r){(e=r.target.result)&&(t&&this._results.length!==this._limitRecord?(this._whereChecker.check(e.value)&&this._results.push(e.value),e.continue()):(t=!0,e.advance(this._skipRecord)))}.bind(this):this._cursorOpenRequest.onsuccess=function(r){(e=r.target.result)&&(t&&this._results.length!==this._limitRecord?(this._results.push(e.value),e.continue()):(t=!0,e.advance(this._skipRecord)))}.bind(this)},t.executeSkipForWhere=function(){var e,t=!1;this._checkFlag?this._cursorOpenRequest.onsuccess=function(r){(e=r.target.result)&&(t?(this._whereChecker.check(e.value)&&this._results.push(e.value),e.continue()):(t=!0,e.advance(this._skipRecord)))}.bind(this):this._cursorOpenRequest.onsuccess=function(r){(e=r.target.result)&&(t?(this._results.push(e.value),e.continue()):(t=!0,e.advance(this._skipRecord)))}.bind(this)},t.executeLimitForWhere=function(){var e;this._checkFlag?this._cursorOpenRequest.onsuccess=function(t){(e=t.target.result)&&this._results.length!==this._limitRecord&&this._whereChecker.check(e.value)&&(this._results.push(e.value),e.continue())}.bind(this):this._cursorOpenRequest.onsuccess=function(t){(e=t.target.result)&&this._results.length!==this._limitRecord&&(this._results.push(e.value),e.continue())}.bind(this)},t.executeSimpleForWhere=function(){var e;this._checkFlag?this._cursorOpenRequest.onsuccess=function(t){(e=t.target.result)&&(this._whereChecker.check(e.value)&&this._results.push(e.value),e.continue())}.bind(this):this._cursorOpenRequest.onsuccess=function(t){(e=t.target.result)&&(this._results.push(e.value),e.continue())}.bind(this)},t.executeWhereLogic=function(e,t,r,n){t=r?t[r]:t,this._cursorOpenRequest=this._objectStore.index(e).openCursor(this.getKeyRange(t,r),n),this._cursorOpenRequest.onerror=function(e){this._errorOccured=!0,this.onErrorOccured(e)}.bind(this),this._skipRecord&&this._limitRecord?this.executeSkipAndLimitForWhere():this._skipRecord?this.executeSkipForWhere():this._limitRecord?this.executeLimitForWhere():this.executeSimpleForWhere()},t}return t}(e.Like);e.Where=t})((t=e.Business||(e.Business={})).Select||(t.Select={}));var t}(JsStore||(JsStore={}));!function(e){(function(e){var t=function(t){__extends(r,t);function r(r,n,s){var i=t.call(this)||this;i._queryStack=[],i._currentQueryStackIndex=0,i.onTransactionCompleted=function(e){null!=this._onSuccess&&this._queryStack.length===this._currentQueryStackIndex+1&&(this._query.Count?this._onSuccess(this._results.length):(this._query.Skip&&this._query.Limit?(this._results.splice(0,this._query.Skip),this._results.splice(this._query.Limit-1,this._results.length)):this._query.Skip?this._results.splice(0,this._query.Skip):this._query.Limit&&this._results.splice(this._query.Limit-1,this._results.length),this._onSuccess(this._results)))},i.executeWhereJoinLogic=function(t,r){var n,s=[],i=0,o=(r.Column,this._results),c=o.length,u=(new e.Instance({From:r.Table,Where:r.Where,Order:r.Order},function(e){e.forEach(function(e,r){for(var s=0;s<c;s++)n=o[s][t.Table][t.Column],u(n,e,s)}),this._results=s,this._queryStack.length>this._currentQueryStackIndex+1?this.startExecutionJoinLogic():this.onTransactionCompleted(null)}.bind(this),this.onErrorOccured.bind(this)),function(e,t,n){if(s[i]={},e===t[r.Column]){s[i][r.Table]=t;for(var c=0;c<this._currentQueryStackIndex;c++)s[i][this._queryStack[c].Table]=o[n][this._queryStack[c].Table];++i}else if("left"===r.JoinType){for(s[i]={},s[i][r.Table]=null,c=0;c<this._currentQueryStackIndex;c++)s[i][this._queryStack[c].Table]=o[n][this._queryStack[c].Table];++i}}.bind(this))},i.executeRightJoin=function(t,r){var n=[],s=(r.Column,this._results),i=s.length,o=0,c=function(){this._results=n,this._queryStack.length>this._currentQueryStackIndex+1?this.startExecutionJoinLogic():this.onTransactionCompleted(null)}.bind(this),u=function(e){var c=!1;e.forEach(function(e,u){for(o=0;o<i;o++)if(e[r.Column]===s[o][t.Table][t.Column]){c=!0;break}if(n[u]={},n[u][r.Table]=e,c){c=!1;for(var a=0;a<this._currentQueryStackIndex;a++)n[u][this._queryStack[a].Table]=s[o][this._queryStack[a].Table]}else for(a=0;a<this._currentQueryStackIndex;a++)n[u][this._queryStack[a].Table]=null},this)}.bind(this);(function(){new e.Instance({From:r.Table,Where:r.Where,Order:r.Order},function(e){u(e),c()}.bind(this),this.onErrorOccured.bind(this))}).bind(this)()},i.executeWhereUndefinedLogicForJoin=function(t,r){var n=[],s=0,i=(r.Column,this._results),o=i.length,c=0,u={},a=function(){this._results=n,this._queryStack.length>this._currentQueryStackIndex+1?this.startExecutionJoinLogic():this.onTransactionCompleted(null)}.bind(this),h=function(e){if(e.length>0)e.forEach(function(e){n[s]={},n[s][r.Table]=e;for(var t=0;t<this._currentQueryStackIndex;t++)n[s][this._queryStack[t].Table]=i[c][this._queryStack[t].Table];++s},this);else if("left"===r.JoinType){n[s]={},n[s][r.Table]=null;for(var t=0;t<this._currentQueryStackIndex;t++)n[s][this._queryStack[t].Table]=i[c][this._queryStack[t].Table];++s}}.bind(this),l=function(){c<o?this._errorOccured||(u[r.Column]=i[c][t.Table][t.Column],new e.Instance({From:r.Table,Where:u,Order:r.Order},function(e){h(e),++c,l()}.bind(this),this.onErrorOccured.bind(this))):a()}.bind(this);l()},i._onSuccess=n,i._onError=s,i._query=r;var o=[],c=function(e){return e.hasOwnProperty("Table1")?(e.Table2.JoinType=void 0===e.Join?"inner":e.Join.toLowerCase(),this._queryStack.push(e.Table2),this._queryStack.length%2==0&&(this._queryStack[this._queryStack.length-1].NextJoin=e.NextJoin),o.push(e.Table2.Table),c(e.Table1)):(this._queryStack.push(e),void o.push(e.Table))}.bind(i);return c(r.From),i._queryStack.reverse(),i._errorOccured||new e.Instance({From:i._queryStack[0].Table,Where:i._queryStack[0].Where},function(e){var t=this._queryStack[0].Table;e.forEach(function(e,r){this._results[r]={},this._results[r][t]=e},this),this.startExecutionJoinLogic()}.bind(i),i.onErrorOccured.bind(i)),i}return r.prototype.startExecutionJoinLogic=function(){var e;this._currentQueryStackIndex>=1&&this._currentQueryStackIndex%2==1?(e={Table:this._queryStack[this._currentQueryStackIndex].NextJoin.Table,Column:this._queryStack[this._currentQueryStackIndex].NextJoin.Column},this._currentQueryStackIndex++):e=this._queryStack[this._currentQueryStackIndex++];var t=this._queryStack[this._currentQueryStackIndex];"right"===t.JoinType?this.executeRightJoin(e,t):t.Where?this.executeWhereJoinLogic(e,t):this.executeWhereUndefinedLogicForJoin(e,t)},r}(e.BaseSelect);e.Join=t})((t=e.Business||(e.Business={})).Select||(t.Select={}));var t}(JsStore||(JsStore={}));!function(e){(function(e){var t=function(e){__extends(t,e);function t(){var t=e.call(this)||this;return t.processGroupBy=function(){var e=this._query.GroupBy,t=this._results,r={};if(this._results=this._query.GroupBy=void 0,"string"==typeof e)for(var n in t)r[t[n][e]]=t[n];else{var s;for(var n in t){s="";for(var i in e)s+=t[n][e[i]];r[s]=t[n]}}t=[];for(n in r)t.push(r[n]);this._results=t},t.executeAggregateGroupBy=function(){var e=this._query.GroupBy,t=this._results,r={},n=this._query.Aggregate;this._query.Aggregate=void 0,this._results=void 0;var s,i,o,c,u=function(){for(var e in n)switch(e){case"Count":var u=function(){return o=(o=r[i])?o["Count("+c+")"]:0,o+=t[s][c]?1:0};if("string"==typeof n[e])c=n[e],t[s]["Count("+c+")"]=u();else if(Array.isArray(n[e]))for(var a in n[e])c=n[e][a],t[s]["Count("+c+")"]=u();break;case"Max":var h=function(){return o=(o=r[i])?o["Max("+c+")"]:0,t[s][c]=t[s][c]?t[s][c]:0,o>t[s][c]?o:t[s][c]};if("string"==typeof n[e])c=n[e],t[s]["Max("+c+")"]=h();else if(Array.isArray(n[e]))for(var a in n[e])c=n[e][a],t[s]["Max("+c+")"]=h();break;case"Min":var l=function(){return o=(o=r[i])?o["Min("+c+")"]:1/0,t[s][c]=t[s][c]?t[s][c]:1/0,o<t[s][c]?o:t[s][c]};if("string"==typeof n[e])c=n[e],t[s]["Min("+c+")"]=l();else if(Array.isArray(n[e]))for(var a in n[e])c=n[e][a],t[s]["Min("+c+")"]=l();break;case"Sum":var _=function(){return o=(o=r[i])?o["Sum("+c+")"]:0,o+=t[s][c]?t[s][c]:0};if("string"==typeof n[e])c=n[e],t[s]["Sum("+c+")"]=_();else if(Array.isArray(n[e]))for(var a in n[e])c=n[e][a],t[s]["Sum("+c+")"]=_();break;case"Avg":var d=function(){var e=(o=r[i])?o["Sum("+c+")"]:0;e+=t[s][c]?t[s][c]:0,t[s]["Sum("+c+")"]=e,o=o?o["Count("+c+")"]:0,o+=t[s][c]?1:0,t[s]["Count("+c+")"]=o};if("string"==typeof n[e])c=n[e],d();else if(Array.isArray(n[e]))for(var a in n[e])c=n[e][a],d()}};if("string"==typeof e)for(s in t)i=t[s][e],u(),r[i]=t[s];else for(s in t){i="";for(var a in e)i+=t[s][e[a]];u(),r[i]=t[s]}t=[];for(var h in r)t.push(r[h]);if(n.Avg)if("string"==typeof n.Avg)for(s in t){var l=t[s]["Sum("+n.Avg+")"],_=t[s]["Count("+n.Avg+")"];t[s]["Avg("+n.Avg+")"]=l/_,n.Count!==n.Avg&&delete t[s]["Count("+n.Avg+")"],n.Sum!==n.Avg&&delete t[s]["Sum("+n.Avg+")"]}else{var d=typeof n.Count,f=typeof n.Count;for(s in t)for(var a in n.Avg){var y=n.Avg[a],b=t[s]["Sum("+y+")"],g=t[s]["Count("+y+")"];t[s]["Avg("+y+")"]=b/g,d&&(n.Count!==y?delete t[s]["Count("+y+")"]:-1===n.Count.indexOf(y)&&delete t[s]["Count("+y+")"]),f&&(n.Sum!==y?delete t[s]["Sum("+y+")"]:-1===n.Sum.indexOf(y)&&delete t[s]["Sum("+y+")"])}}this._results=t},t}return t}(e.Where);e.GroupByHelper=t})((t=e.Business||(e.Business={})).Select||(t.Select={}));var t}(JsStore||(JsStore={}));!function(e){(function(e){var t=function(e){__extends(t,e);function t(){var t=e.call(this)||this;return t.processOrderBy=function(){var e=this._query.Order;if(e&&this._results.length>0&&!this._sorted&&e.By){e.Type=e.Type?e.Type.toLowerCase():"asc";var t=e.By,r=function(){this._results.sort(function(e,r){return e[t]-r[t]})}.bind(this),n=function(){this._results.sort(function(e,r){return r[t]-e[t]})}.bind(this),s=function(){this._results.sort(function(e,r){return e[t].toLowerCase().localeCompare(r[t].toLowerCase())})}.bind(this),i=function(){this._results.sort(function(e,r){return r[t].toLowerCase().localeCompare(e[t].toLowerCase())})}.bind(this);"string"==typeof this._results[0][t]?"asc"===e.Type?s():i():"number"==typeof this._results[0][t]&&("asc"===e.Type?r():n())}},t.processAggregateQry=function(){var e,t=this._results,r={};this._results=void 0;for(var n in this._query.Aggregate)switch(n){case"Count":var s=function(){var r=0;for(var n in t)r+=t[n][e]?1:0;return r};if("string"==typeof this._query.Aggregate[n])r["Count("+(e=this._query.Aggregate[n])+")"]=s();else if(Array.isArray(this._query.Aggregate[n]))for(var i in this._query.Aggregate[n])r["Count("+(e=this._query.Aggregate[n][i])+")"]=s();break;case"Max":var o=function(){var r=0;for(var n in t)r=r>t[n][e]?r:t[n][e];return r};if("string"==typeof this._query.Aggregate[n])r["Max("+(e=this._query.Aggregate[n])+")"]=o();else if(Array.isArray(this._query.Aggregate[n]))for(var i in this._query.Aggregate[n])r["Max("+(e=this._query.Aggregate[n][i])+")"]=o();break;case"Min":var c=function(){var r=1/0,n=1/0;for(var s in t)r=r<(n=t[s][e]?t[s][e]:1/0)?r:n;return r};if("string"==typeof this._query.Aggregate[n])r["Min("+(e=this._query.Aggregate[n])+")"]=c();else if(Array.isArray(this._query.Aggregate[n]))for(var i in this._query.Aggregate[n])r["Min("+(e=this._query.Aggregate[n][i])+")"]=c();break;case"Sum":var u=function(){var r=0;for(var n in t)r+=t[n][e];return r};if("string"==typeof this._query.Aggregate[n])r["Sum("+(e=this._query.Aggregate[n])+")"]=u();else if(Array.isArray(this._query.Aggregate[n]))for(var i in this._query.Aggregate[n])r["Sum("+(e=this._query.Aggregate[n][i])+")"]=u();break;case"Avg":var a=function(){var r=0;for(var n in t)r+=t[n][e];return r/t.length};if("string"==typeof this._query.Aggregate[n])r["Avg("+(e=this._query.Aggregate[n])+")"]=a();else if(Array.isArray(this._query.Aggregate[n]))for(var i in this._query.Aggregate[n])r["Avg("+(e=this._query.Aggregate[n][i])+")"]=a()}for(var n in r)t[0][n]=r[n];this._results=t},t}return t}(e.GroupByHelper);e.Helper=t})((t=e.Business||(e.Business={})).Select||(t.Select={}));var t}(JsStore||(JsStore={}));!function(e){(function(r){var n=function(r){__extends(n,r);function n(n,s,i){var o=r.call(this)||this;if(o.processWhereArrayQry=function(){var e,r=!0,n=this._onSuccess,s=this._query.Where,i=[],o=this.getPrimaryKey(this._query.From),c=function(){try{this._transaction=t.db_connection.transaction([this._query.From],"readonly"),this._transaction.oncomplete=u,this._transaction.ontimeout=this.onTransactionTimeout.bind(this),this._objectStore=this._transaction.objectStore(this._query.From)}catch(e){this._errorOccured=!0,this.onExceptionOccured.call(this,e,{TableName:this._query.From})}}.bind(this),u=function(){if("and"===e){var t=function(){var e=[];this._results.forEach(function(t){(function(e){var t=!1;return i.every(function(r){return r[o]!==e||(t=!0,!1)}),t})(t[o])&&e.push(t)}),i=e,e=null}.bind(this);i.length>0?t():!0===r?i=this._results:t()}else i.length>0?(this._results=i.concat(this._results),this.removeDuplicates(),i=this._results):i=this._results;this._results=[],s.length>0?a():n(i),r=!1}.bind(this),a=function(){this._query.Where=s.shift(),this._query.Where.Or?1===Object.keys(this._query.Where).length?(e="or",this._query.Where=this._query.Where.Or,c()):(e="and",this._onSuccess=u):(e="and",c()),this.processWhere(!0)}.bind(this);a()},o.createTransaction=function(){this._transaction=t.db_connection.transaction([this._query.From],"readonly"),this._transaction.oncomplete=this.onTransactionCompleted.bind(this),this._transaction.ontimeout=this.onTransactionTimeout.bind(this),this._objectStore=this._transaction.objectStore(this._query.From)},o.processWhere=function(e){this._query.Where.Or?(this.processOrLogic(),this.createTransactionForOrLogic()):e||this.createTransaction(),this.goToWhereLogic()},o.onTransactionCompleted=function(){if(this._sendResultFlag){if(this.processOrderBy(),this._query.Distinct){var e=[],t=this._results[0];for(var r in t)e.push(r);var n=this.getPrimaryKey(this._query.From),s=e.indexOf(n);e.splice(s,1),this._query.GroupBy=e.length>0?e:null}this._query.GroupBy?this._query.Aggregate?this.executeAggregateGroupBy():this.processGroupBy():this._query.Aggregate&&this.processAggregateQry(),this._onSuccess(this._results)}},o.createTransactionForOrLogic=function(){try{this._transaction=t.db_connection.transaction([this._query.From],"readonly"),this._transaction.oncomplete=this.orQuerySuccess.bind(this),this._transaction.ontimeout=this.onTransactionTimeout.bind(this),this._objectStore=this._transaction.objectStore(this._query.From)}catch(e){this._errorOccured=!0,this.onExceptionOccured.call(this,e,{TableName:this._query.From})}},o.orQueryFinish=function(){this._results=this._orInfo.Results,this._orInfo.Results=void 0,this.removeDuplicates(),this._orInfo.OnSucess(this._results)},o.orQuerySuccess=function(){if(this._orInfo.Results=this._orInfo.Results.concat(this._results),!this._query.Limit||this._query.Limit>this._orInfo.Results.length){this._results=[];var t=e.getObjectFirstKey(this._orInfo.OrQuery);if(null!=t){var r={};r[t]=this._orInfo.OrQuery[t],delete this._orInfo.OrQuery[t],this._query.Where=r,this.createTransactionForOrLogic(),this.goToWhereLogic()}else this.orQueryFinish()}else this.orQueryFinish()},o.processOrLogic=function(){this._orInfo={OrQuery:this._query.Where.Or,OnSucess:this._onSuccess,Results:[]},delete this._query.Where.Or},o._onError=i,o.getTable(n.From)){o._onSuccess=s,o._query=n,o._skipRecord=o._query.Skip,o._limitRecord=o._query.Limit,o._tableName=o._query.From;try{n.Where?Array.isArray(n.Where)?o.processWhereArrayQry():o.processWhere(!1):(o.createTransaction(),o.executeWhereUndefinedLogic())}catch(e){o._errorOccured=!0,o.onExceptionOccured.call(o,e,{TableName:n.From})}}else o._errorOccured=!0,o.onErrorOccured(new e.Error(e.Error_Type.TableNotExist,{TableName:n.From}).get(),!0);return o}return n}(r.Helper);r.Instance=n})((t=e.Business||(e.Business={})).Select||(t.Select={}));var t}(JsStore||(JsStore={}));!function(e){(function(e){var r=function(e){__extends(t,e);function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._resultCount=0,t._checkFlag=!1,t}return t}(t.Base);e.BaseCount=r})((t=e.Business||(e.Business={})).Count||(t.Count={}));var t}(JsStore||(JsStore={}));!function(e){(function(e){var t=function(e){__extends(t,e);function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.executeWhereUndefinedLogic=function(){if(this._objectStore.count){var e=this._objectStore.count();e.onsuccess=function(){this._resultCount=e.result}.bind(this),e.onerror=function(e){this._errorOccured=!0,this.onErrorOccured(e)}.bind(this)}else{var t,r=this._objectStore.openCursor();r.onsuccess=function(e){(t=e.target.result)&&(++this._resultCount,t.continue())}.bind(this),r.onerror=function(e){this._errorOccured=!0,this.onErrorOccured(e)}.bind(this)}},t}return t}(e.BaseCount);e.NotWhere=t})((t=e.Business||(e.Business={})).Count||(t.Count={}));var t}(JsStore||(JsStore={}));!function(e){(function(e){var t=function(e){__extends(t,e);function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.executeInLogic=function(e,t){var r,n,s=this._objectStore.index(e);if(this._checkFlag)for(var i=0,o=t.length;i<o;i++)this._errorOccured||((n=s.openCursor(IDBKeyRange.only(t[i]))).onsuccess=function(e){(r=e.target.result)&&(this._whereChecker.check(r.value)&&++this._resultCount,r.continue())}.bind(this));else if(this._objectStore.count)for(i=0,o=t.length;i<o;i++)this._errorOccured||((n=s.count(IDBKeyRange.only(t[i]))).onsuccess=function(e){this._resultCount+=e.target.result}.bind(this));else for(i=0,o=t.length;i<o;i++)this._errorOccured||((n=s.openCursor(IDBKeyRange.only(t[i]))).onsuccess=function(e){(r=e.target.result)&&(++this._resultCount,r.continue())}.bind(this));n.onerror=function(e){this._errorOccured=!0,this.onErrorOccured(e)}.bind(this)},t}return t}(e.NotWhere);e.In=t})((t=e.Business||(e.Business={})).Count||(t.Count={}));var t}(JsStore||(JsStore={}));!function(e){(function(e){var t=function(e){__extends(t,e);function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.executeLikeLogic=function(e,t,r){var n;this._compValue=t.toLowerCase(),this._compValueLength=this._compValue.length,this._compSymbol=r,this.CursorOpenRequest=this._objectStore.index(e).openCursor(),this.CursorOpenRequest.onerror=function(e){this._errorOccured=!0,this.onErrorOccured(e)}.bind(this),this._checkFlag?this.CursorOpenRequest.onsuccess=function(e){(n=e.target.result)&&(this.filterOnOccurence(n.key)&&this._whereChecker.check(n.value)&&++this._resultCount,n.continue())}.bind(this):this.CursorOpenRequest.onsuccess=function(e){(n=e.target.result)&&(this.filterOnOccurence(n.key)&&++this._resultCount,n.continue())}.bind(this)},t}return t}(e.In);e.Like=t})((t=e.Business||(e.Business={})).Count||(t.Count={}));var t}(JsStore||(JsStore={}));!function(e){(function(e){var t=function(e){__extends(t,e);function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.executeWhereLogic=function(e,t,r){t=r?t[r]:t;var n,s;this._checkFlag?(n=this._objectStore.index(e).openCursor(this.getKeyRange(t,r))).onsuccess=function(e){(s=e.target.result)&&(this._whereChecker.check(s.value)&&++this._resultCount,s.continue())}.bind(this):this._objectStore.count?(n=this._objectStore.index(e).count(this.getKeyRange(t,r))).onsuccess=function(){this._resultCount=n.result}.bind(this):(n=this._objectStore.index(e).openCursor(this.getKeyRange(t,r))).onsuccess=function(e){(s=e.target.result)&&(++this._resultCount,s.continue())}.bind(this),n.onerror=function(e){this._errorOccured=!0,this.onErrorOccured(e)}.bind(this)},t}return t}(e.Like);e.Where=t})((t=e.Business||(e.Business={})).Count||(t.Count={}));var t}(JsStore||(JsStore={}));!function(e){(function(r){var n=function(r){__extends(n,r);function n(n,s,i){var o=r.call(this)||this;if(o.onTransactionCompleted=function(){this._sendResultFlag&&this._onSuccess(this._resultCount)},o._onError=i,o.getTable(n.From)){o._onSuccess=s,o._query=n;try{var c=function(){this._transaction=t.db_connection.transaction([n.From],"readonly"),this._objectStore=this._transaction.objectStore(n.From),this._transaction.oncomplete=this.onTransactionCompleted.bind(this),this._transaction.ontimeout=this.onTransactionTimeout.bind(this)};void 0!==n.Where?n.Where.Or||Array.isArray(n.Where)?new t.Select.Instance(n,function(e){this._resultCount=e.length,this.onTransactionCompleted()}.bind(o),o._onError):(c.call(o),o.goToWhereLogic()):(c.call(o),o.executeWhereUndefinedLogic())}catch(e){o.onExceptionOccured(e,{TableName:n.From})}}else o._errorOccured=!0,o.onErrorOccured(new e.Error(e.Error_Type.TableNotExist,{TableName:n.From}).get(),!0);return o}return n}(r.Where);r.Instance=n})((t=e.Business||(e.Business={})).Count||(t.Count={}));var t}(JsStore||(JsStore={}));!function(e){!function(e){(e.Update||(e.Update={})).updateValue=function(e,t){for(var r in e)if("object"!=typeof e[r])t[r]=e[r];else for(var n in e[r]){switch(n){case"+":t[r]+=e[r][n];break;case"-":t[r]-=e[r][n];break;case"*":t[r]*=e[r][n];break;case"/":t[r]/=e[r][n];break;default:t[r]=e[r]}break}return t};var t=function(e){__extends(t,e);function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._checkFlag=!1,t}return t}(e.Base);e.BaseUpdate=t}(e.Business||(e.Business={}))}(JsStore||(JsStore={}));!function(e){(function(e){var r=function(t){__extends(r,t);function r(){var r=null!==t&&t.apply(this,arguments)||this;return r.executeWhereUndefinedLogic=function(){var t,r=this._objectStore.openCursor();r.onsuccess=function(r){(t=r.target.result)&&(t.update(e.updateValue(this._query.Set,t.value)),++this._rowAffected,t.continue())}.bind(this),r.onerror=function(e){this._errorOccured=!0,this.onErrorOccured(e)}.bind(this)},r}return r}(t.BaseUpdate);e.NotWhere=r})((t=e.Business||(e.Business={})).Update||(t.Update={}));var t}(JsStore||(JsStore={}));!function(e){(function(e){var t=function(t){__extends(r,t);function r(){var r=null!==t&&t.apply(this,arguments)||this;return r.executeInLogic=function(t,r){var n,s,i=this._objectStore.index(t);if(this._checkFlag)for(var o=0,c=r.length;o<c;o++)this._errorOccured||((s=i.openCursor(IDBKeyRange.only(r[o]))).onsuccess=function(t){(n=t.target.result)&&(this._whereChecker.check(n.value)&&(n.update(e.updateValue(this._query.Set,n.value)),++this._rowAffected),n.continue())}.bind(this));else for(o=0,c=r.length;o<c;o++)this._errorOccured||((s=i.openCursor(IDBKeyRange.only(r[o]))).onsuccess=function(t){(n=t.target.result)&&(n.update(e.updateValue(this._query.Set,n.value)),++this._rowAffected,n.continue())}.bind(this));s.onerror=function(e){this._errorOccured=!0,this.onErrorOccured(e)}.bind(this)},r}return r}(e.NotWhere);e.In=t})((t=e.Business||(e.Business={})).Update||(t.Update={}));var t}(JsStore||(JsStore={}));!function(e){(function(e){var t=function(t){__extends(r,t);function r(){var r=null!==t&&t.apply(this,arguments)||this;return r.executeLikeLogic=function(t,r,n){var s;this._compValue=r.toLowerCase(),this._compValueLength=this._compValue.length,this._compSymbol=n;var i=this._objectStore.index(t).openCursor();i.onerror=function(e){this._errorOccured=!0,this.onErrorOccured(e)}.bind(this),this._checkFlag?i.onsuccess=function(t){(s=t.target.result)&&(this.filterOnOccurence(s.key)&&this._whereChecker.check(s.value)&&(s.update(e.updateValue(this._query.Set,s.value)),++this._rowAffected),s.continue())}.bind(this):i.onsuccess=function(t){(s=t.target.result)&&(this.filterOnOccurence(s.key)&&(s.update(e.updateValue(this._query.Set,s.value)),++this._rowAffected),s.continue())}.bind(this)},r}return r}(e.In);e.Like=t})((t=e.Business||(e.Business={})).Update||(t.Update={}));var t}(JsStore||(JsStore={}));!function(e){(function(e){var t=function(t){__extends(r,t);function r(){var r=null!==t&&t.apply(this,arguments)||this;return r.executeWhereLogic=function(t,r,n){var s,i;r=n?r[n]:r,i=this._objectStore.index(t).openCursor(this.getKeyRange(r,n)),this._checkFlag?i.onsuccess=function(t){(s=t.target.result)&&(this._whereChecker.check(s.value)&&(s.update(e.updateValue(this._query.Set,s.value)),++this._rowAffected),s.continue())}.bind(this):i.onsuccess=function(t){(s=t.target.result)&&(s.update(e.updateValue(this._query.Set,s.value)),++this._rowAffected,s.continue())}.bind(this),i.onerror=function(e){this._errorOccured=!0,this.onErrorOccured(e)}.bind(this)},r}return r}(e.Like);e.Where=t})((t=e.Business||(e.Business={})).Update||(t.Update={}));var t}(JsStore||(JsStore={}));!function(e){(function(e){var r=function(r){__extends(n,r);function n(n,s,i){var o=r.call(this)||this;o.onTransactionCompleted=function(){this._onSuccess(this._rowAffected)},o.createTransaction=function(){this._transaction=t.db_connection.transaction([this._query.In],"readwrite"),this._objectStore=this._transaction.objectStore(this._query.In),this._transaction.oncomplete=this.onTransactionCompleted.bind(this),this._transaction.ontimeout=this.onTransactionTimeout},o.executeComplexLogic=function(){new t.Select.Instance({From:this._query.In,Where:this._query.Where},function(e){var t=this.getPrimaryKey(this._query.In),r=[],n={};e.forEach(function(e){r.push(e[t])}),e=null,n[t]={In:r},this._query.Where=n,this.createTransaction(),this.goToWhereLogic()}.bind(this),this._onError.bind(this))},o._onSuccess=s,o._onError=i;try{o._error=new e.SchemaChecker(o.getTable(n.In)).check(n.Set,n.In),o._error?(o._errorOccured=!0,o.onErrorOccured(o._error,!0)):(o._query=n,n.Where?n.Where.Or||Array.isArray(n.Where)?o.executeComplexLogic():(o.createTransaction(),o.goToWhereLogic()):(o.createTransaction(),o.executeWhereUndefinedLogic()))}catch(e){o._errorOccured=!0,o.onExceptionOccured.call(o,e,{TableName:n.In})}return o}return n}(e.Where);e.Instance=r})((t=e.Business||(e.Business={})).Update||(t.Update={}));var t}(JsStore||(JsStore={}));!function(e){(function(t){var r=function(t){this.check=function(t,r){var n=null;return"object"==typeof t?this._table?this._table._columns.every(function(e){return null===n&&(e._name in t&&(n=this.checkByColumn(e,t[e._name])),!0)},this):n=new e.Error(e.Error_Type.TableNotExist,{TableName:r}).get():n=new e.Error(e.Error_Type.NotObject).get(),n},this.checkByColumn=function(t,r){var n=null;t._notNull&&e.isNull(r)&&(n=new e.Error(e.Error_Type.NullValue,{ColumnName:t._name}).get());var s=typeof r;if(t._dataType&&s!==t._dataType&&"object"!==s&&(n=new e.Error(e.Error_Type.BadDataType,{ColumnName:t._name}).get()),"object"===s){var i=["+","-","*","/"];for(var o in r){i.indexOf(o)<0&&(n=new e.Error(e.Error_Type.InvalidOp,{Op:o}).get());break}}return n},this._table=t};t.SchemaChecker=r})((t=e.Business||(e.Business={})).Update||(t.Update={}));var t}(JsStore||(JsStore={}));!function(e){(function(e){var r=function(e){__extends(t,e);function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._checkFlag=!1,t}return t}(t.Base);e.BaseDelete=r})((t=e.Business||(e.Business={})).Delete||(t.Delete={}));var t}(JsStore||(JsStore={}));!function(e){(function(e){var t=function(e){__extends(t,e);function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.executeWhereUndefinedLogic=function(){var e,t=this._objectStore.openCursor();t.onsuccess=function(t){(e=t.target.result)&&(e.delete(),++this._rowAffected,e.continue())}.bind(this),t.onerror=function(e){this._errorOccured=!0,this.onErrorOccured(e)}.bind(this)},t}return t}(e.BaseDelete);e.NotWhere=t})((t=e.Business||(e.Business={})).Delete||(t.Delete={}));var t}(JsStore||(JsStore={}));!function(e){(function(e){var t=function(e){__extends(t,e);function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.executeInLogic=function(e,t){var r,n;if(this._checkFlag)for(var s=0,i=t.length;s<i;s++)this._errorOccured||((n=this._objectStore.index(e).openCursor(IDBKeyRange.only(t[s]))).onsuccess=function(e){(r=e.target.result)&&(this._whereChecker.check(r.value)&&(r.delete(),++this._rowAffected),r.continue())}.bind(this));else for(s=0,i=t.length;s<i;s++)this._errorOccured||((n=this._objectStore.index(e).openCursor(IDBKeyRange.only(t[s]))).onsuccess=function(e){(r=e.target.result)&&(r.delete(),++this._rowAffected,r.continue())}.bind(this));n.onerror=function(e){this._errorOccured=!0,this.onErrorOccured(e)}.bind(this)},t}return t}(e.NotWhere);e.In=t})((t=e.Business||(e.Business={})).Delete||(t.Delete={}));var t}(JsStore||(JsStore={}));!function(e){(function(e){var t=function(e){__extends(t,e);function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.executeLikeLogic=function(e,t,r){var n;this._compValue=t.toLowerCase(),this._compValueLength=this._compValue.length,this._compSymbol=r,this.cursor_request=this._objectStore.index(e).openCursor(),this.cursor_request.onerror=function(e){this._errorOccured=!0,this.onErrorOccured(e)}.bind(this),this._checkFlag?this.cursor_request.onsuccess=function(e){(n=e.target.result)&&(this.filterOnOccurence(n.key)&&this._whereChecker.check(n.value)&&(n.delete(),++this._rowAffected),n.continue())}.bind(this):this.cursor_request.onsuccess=function(e){(n=e.target.result)&&(this.filterOnOccurence(n.key)&&(n.delete(),++this._rowAffected),n.continue())}.bind(this)},t}return t}(e.In);e.Like=t})((t=e.Business||(e.Business={})).Delete||(t.Delete={}));var t}(JsStore||(JsStore={}));!function(e){(function(e){var t=function(e){__extends(t,e);function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.executeWhereLogic=function(e,t,r){var n,s;t=r?t[r]:t,s=this._objectStore.index(e).openCursor(this.getKeyRange(t,r)),this._checkFlag?s.onsuccess=function(e){(n=e.target.result)&&(this._whereChecker.check(n.value)&&(n.delete(),++this._rowAffected),n.continue())}.bind(this):s.onsuccess=function(e){(n=e.target.result)&&(n.delete(),++this._rowAffected,n.continue())}.bind(this),s.onerror=function(e){this._errorOccured=!0,this.onErrorOccured(e)}.bind(this)},t}return t}(e.Like);e.Where=t})((t=e.Business||(e.Business={})).Delete||(t.Delete={}));var t}(JsStore||(JsStore={}));!function(e){(function(r){var n=function(r){__extends(n,r);function n(n,s,i){var o=r.call(this)||this;o.processWhereArrayQry=function(){new t.Select.Instance(this._query,function(e){var t=[],r=this.getPrimaryKey(this._query.From);e.forEach(function(e){t.push(e[r])}),e=null,this._query.Where={},this._query.Where[r]={In:t},this.processWhere(!1)}.bind(this),this._onError)},o.processWhere=function(e){this._query.Where.Or?(this.processOrLogic(),this.createTransactionForOrLogic()):!1===e&&this.createTransaction(),this.goToWhereLogic()},o.createTransaction=function(){this._transaction=t.db_connection.transaction([this._query.From],"readwrite"),this._objectStore=this._transaction.objectStore(this._query.From),this._transaction.oncomplete=this.onTransactionCompleted.bind(this),this._transaction.onerror=this.onErrorOccured.bind(this)},o.onTransactionCompleted=function(){this._onSuccess(this._rowAffected)},o.createTransactionForOrLogic=function(){try{this._transaction=t.db_connection.transaction([this._query.From],"readwrite"),this._transaction.oncomplete=this.orQuerySuccess.bind(this),this._transaction.ontimeout=this.onTransactionTimeout.bind(this),this._objectStore=this._transaction.objectStore(this._query.From)}catch(e){this._errorOccured=!0,this.onExceptionOccured(e,{TableName:this._query.From})}},o.orQuerySuccess=function(){var t=e.getObjectFirstKey(this._orInfo.OrQuery);if(null!=t){var r={};r[t]=this._orInfo.OrQuery[t],delete this._orInfo.OrQuery[t],this._query.Where=r,this.createTransactionForOrLogic(),this.goToWhereLogic()}else this._orInfo.OnSucess(this._rowAffected)},o.processOrLogic=function(){this._orInfo={OrQuery:this._query.Where.Or,OnSucess:this._onSuccess},delete this._query.Where.Or},o._query=n,o._onSuccess=s,o._onError=i;try{n.Where?Array.isArray(n.Where)?o.processWhereArrayQry():o.processWhere(!1):(o.createTransaction(),o.executeWhereUndefinedLogic())}catch(e){o._errorOccured=!0,o.onExceptionOccured(e,{TableName:n.From})}return o}return n}(r.Where);r.Instance=n})((t=e.Business||(e.Business={})).Delete||(t.Delete={}));var t}(JsStore||(JsStore={}));!function(e){(function(r){var n=function(n){__extends(s,n);function s(s,i,o){var c=n.call(this)||this;c._valuesAffected=[],c.onTransactionCompleted=function(){this._onSuccess(this._query.Return?this._valuesAffected:this._rowAffected)},c.insertData=function(e){var r,n=0;r=this._query.Return?function(t){if(t){var i=s.add(t);i.onerror=this.onErrorOccured.bind(this),i.onsuccess=function(s){this._valuesAffected.push(t),r.call(this,e[n++])}.bind(this)}}:function(t){if(t){var i=s.add(t);i.onerror=this.onErrorOccured.bind(this),i.onsuccess=function(t){++this._rowAffected,r.call(this,e[n++])}.bind(this)}},this._transaction=t.db_connection.transaction([this._query.Into],"readwrite");var s=this._transaction.objectStore(this._query.Into);this._transaction.oncomplete=this.onTransactionCompleted.bind(this),r.call(this,e[n++])},c._onError=o;var u=c.getTable(s.Into);if(u){c._query=s,c._onSuccess=i,c._tableName=c._query.Into;try{if(c._query.SkipDataCheck)c.insertData(c._query.Values);else{var a=new r.ValuesChecker(u,c._query.Values);a.checkAndModifyValues(function(e){e?this.onErrorOccured(a._error,!0):this.insertData(a._values),a=void 0}.bind(c))}c._query.Values=void 0}catch(e){c.onExceptionOccured(e,{TableName:s.Into})}}else new e.Error(e.Error_Type.TableNotExist,{TableName:s.Into}).throw();return c}return s}(t.Base);r.Instance=n})((t=e.Business||(e.Business={})).Insert||(t.Insert={}));var t}(JsStore||(JsStore={}));!function(e){(function(r){var n=function(r,n,s){this._errorOccured=!1,this.checkAndModifyValue=function(e){this._value=e,this._index=0,this.checkColumnValue()},this.checkColumnValue=function(){var e=this._table._columns[this._index++];e?this.checkAndModifyColumnValue(e,this._value):this.onFinish()},this.checkAndModifyColumnValue=function(r,n){if(!0===this._errorOccured)this.onError(this._error);else{var s=function(){r._notNull&&e.isNull(n[r._name])?this.onValidationError(e.Error_Type.NullValue,{ColumnName:r._name}):r._dataType&&typeof n[r._name]!==r._dataType?this.onValidationError(e.Error_Type.BadDataType,{ColumnName:r._name}):this.checkColumnValue()}.bind(this),i=function(){var e="JsStore_"+t.active_db._name+"_"+this._table._name+"_"+r._name+"_Value";KeyStore.get(e,function(t){n[r._name]=++t,KeyStore.set(e,t),s()})}.bind(this);r._autoIncrement?i():r._default&&e.isNull(n[r._name])?(n[r._name]=r._default,s()):s()}},this.onValidationError=function(t,r){this._errorOccured=!0,this._error=new e.Error(t,r).get(),this.onError(this._error)},this._table=r,this.onFinish=n,this.onError=s};r.ValueChecker=n})((t=e.Business||(e.Business={})).Insert||(t.Insert={}));var t}(JsStore||(JsStore={}));!function(e){(function(e){var t=function(t,r){this._index=0,this.checkAndModifyValues=function(e){this.onFinish=e,this.checkRowValue()},this.checkRowValue=function(){var t=this._values[this._index];if(t){var r=new e.ValueChecker(this._table,function(){this._values[this._index++]=r._value,this.checkRowValue()}.bind(this),function(e){this._error=e,this.onFinish(!0)}.bind(this));r.checkAndModifyValue(t)}else this.onFinish(!1)},this._table=t,this._values=r};e.ValuesChecker=t})((t=e.Business||(e.Business={})).Insert||(t.Insert={}));var t}(JsStore||(JsStore={}));!function(e){e.worker_status=e.WebWorker_Status.NotStarted;var t=function(){function t(){this._requestQueue=[],this._isCodeExecuting=!1,this.pushApi=function(e,t){return!0===t?new Promise(function(t,r){e.OnSuccess=function(e){t(e)},e.OnError=function(e){r(e)},this.prcoessExecutionOfCode(e)}.bind(this)):(this.prcoessExecutionOfCode(e),this)},this.createWorker=function(){try{if(Worker){var t=this.getScriptUrl();t&&t.length>0?(e.worker_instance=new Worker(t),e.worker_instance.onmessage=function(e){this.onMessageFromWorker(e)}.bind(this),this.executeCodeUsingWorker({Name:"change_log_status",Query:{logging:e.enable_log}}),setTimeout(function(){e.worker_status!==e.WebWorker_Status.Failed&&(e.worker_status=e.WebWorker_Status.Registered),e.status.ConStatus===e.Connection_Status.Connected&&this.executeCode()}.bind(this),100)):this.onWorkerFailed()}else this.onWorkerFailed()}catch(e){this.onWorkerFailed()}},this.prcoessExecutionOfCode=function(t){if(e.status.ConStatus===e.Connection_Status.NotStarted)switch(t.Name){case"create_db":case"open_db":this._requestQueue.splice(0,0,t),e.worker_status!==e.WebWorker_Status.NotStarted&&this.executeCode(),e.status.ConStatus=e.Connection_Status.Connected;break;default:this._requestQueue.push(t)}else this._requestQueue.push(t),1===this._requestQueue.length&&e.worker_status!==e.WebWorker_Status.NotStarted&&this.executeCode();e.log("request pushed: "+t.Name)},this.executeCode=function(){if(!this._isCodeExecuting&&this._requestQueue.length>0){this._isCodeExecuting=!0;var t=this._requestQueue[0],r={Name:t.Name,Query:t.Query};e.log("request executing : "+t.Name),e.worker_status===e.WebWorker_Status.Registered?this.executeCodeUsingWorker(r):this.executeCodeDirect(r)}},this.executeCodeDirect=function(t){new e.Business.Main(function(e){this.processFinishedRequest(e)}.bind(this)).checkConnectionAndExecuteLogic(t)},this.executeCodeUsingWorker=function(t){e.worker_instance.postMessage(t)},this.processFinishedRequest=function(t){var r=this._requestQueue.shift();this._isCodeExecuting=!1,r&&(e.log("request finished : "+r.Name),t.ErrorOccured?r.OnError&&r.OnError(t.ErrorDetails):r.OnSuccess&&r.OnSuccess(t.ReturnedValue),this.executeCode())},this.onWorkerFailed=function(){console.warn("JsStore is not runing in web worker"),e.worker_status=e.WebWorker_Status.Failed,e.status.ConStatus===e.Connection_Status.NotStarted&&this.executeCode()},this.onMessageFromWorker=function(e){if("string"==typeof e.data){switch(e.data.split(":")[1]){case"WorkerFailed":this.onWorkerFailed()}}else this.processFinishedRequest(e.data)}}return t.prototype.getScriptUrl=function(e){for(var t="",r=e?e.toLowerCase():"jsstore",n=document.getElementsByTagName("script"),s=n.length-1,i="";s>=0;s--)if((i=(i=n[s].src).substring(i.lastIndexOf("/")+1).toLowerCase()).length>0&&i.indexOf(r)>=0)return t=n[s].src;return t},t}();e.CodeExecutionHelper=t}(JsStore||(JsStore={}));var JsStore,Model=JsStore.Model,DataBase=Model.DataBase,Column=Model.Column,Table=Model.Table;!function(e){var t=function(t){__extends(r,t);function r(r){void 0===r&&(r=null);var n=t.call(this)||this;return n.openDb=function(e,t,r){return this.pushApi({Name:"open_db",Query:e,OnSuccess:t,OnError:r},!1)},n.createDb=function(e,t,r){return this.pushApi({Name:"create_db",OnSuccess:t,OnError:r,Query:e},!1)},n.dropDb=function(e,t){var r=!e;return this.pushApi({Name:"drop_db",Query:null,OnSuccess:e,OnError:t},r)},n.select=function(e,t,r){t=e.OnSuccess?e.OnSuccess:t,r=e.OnError?e.OnError:r,e.OnSuccess=e.OnError=null;var n=!t;return this.pushApi({Name:"select",Query:e,OnSuccess:t,OnError:r},n)},n.count=function(e,t,r){t=e.OnSuccess?e.OnSuccess:t,r=e.OnError?e.OnError:r,e.OnSuccess=e.OnError=null;var n=!t;return this.pushApi({Name:"count",Query:e,OnSuccess:t,OnError:r},n)},n.insert=function(e,t,r){t=e.OnSuccess?e.OnSuccess:t,r=e.OnError?e.OnError:r,e.OnSuccess=e.OnError=null;var n=!t;return this.pushApi({Name:"insert",Query:e,OnSuccess:t,OnError:r},n)},n.update=function(e,t,r){t=e.OnSuccess?e.OnSuccess:t,r=e.OnError?e.OnError:r,e.OnSuccess=e.OnError=null;var n=!t;return this.pushApi({Name:"update",Query:e,OnSuccess:t,OnError:r},n)},n.delete=function(e,t,r){t=e.OnSuccess?e.OnSuccess:t,r=e.OnError?e.OnError:r,e.OnSuccess=e.OnError=null;var n=!t;return this.pushApi({Name:"delete",Query:e,OnSuccess:t,OnError:r},n)},n.clear=function(e,t,r){var n=!t;return this.pushApi({Name:"clear",Query:e,OnSuccess:t,OnError:r},n)},n.bulkInsert=function(e,t,r){t=e.OnSuccess?e.OnSuccess:t,r=e.OnError?e.OnError:r;var n=!t;return e.OnSuccess=e.OnError=null,this.pushApi({Name:"bulk_insert",Query:e,OnSuccess:t,OnError:r},n)},n.exportJson=function(e){var t=function(t){var r=document.createElement("a");r.href=t,r.download=e.From+".json",r.click(),n&&n(null)},r=e.OnError,n=e.OnSuccess;e.OnSuccess=e.OnError=void 0;var s=!n;if(s)return new Promise(function(n,i){this.pushApi({Name:"export_json",Query:e,OnSuccess:t,OnError:r},s).then(function(e){t(e),n()}).catch(function(e){i(e)})});this.pushApi({Name:"export_json",Query:e,OnSuccess:t,OnError:r},s)},e.worker_status===e.WebWorker_Status.Registered?e.worker_instance.terminate():e.worker_status===e.WebWorker_Status.NotStarted&&KeyStore.init(),n.createWorker(),r&&n.openDb(r,null,null),n}return r}(e.CodeExecutionHelper);e.Instance=t}(JsStore||(JsStore={})),self&&!self.alert&&(self.onmessage=function(e){JsStore.log("Request executing from WebWorker, request name: "+e.data.Name);var t=e.data;(new JsStore.Business.Main).checkConnectionAndExecuteLogic(t)},JsStore.worker_status=JsStore.WebWorker_Status.Registered,KeyStore.init());