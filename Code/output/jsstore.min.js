var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){e(t,n);function r(){this.constructor=t}t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();!function(e){var t=function(){function e(){}return e.setDbType=function(){self.indexedDB=self.indexedDB||self.mozIndexedDB||self.webkitIndexedDB||self.msIndexedDB,indexedDB?(self.IDBTransaction=self.IDBTransaction||self.webkitIDBTransaction||self.msIDBTransaction,self.IDBKeyRange=self.IDBKeyRange||self.webkitIDBKeyRange||self.msIDBKeyRange):self.alert?JsStore.status={ConStatus:JsStore.Connection_Status.UnableToStart,LastError:JsStore.Error_Type.IndexedDbUndefined}:(console.log("worked failed"),self.postMessage("message:WorkerFailed"))},e}();e.Utils=t}(KeyStore||(KeyStore={}));!function(e){(t=e.ConnectionStatus||(e.ConnectionStatus={})).Connected="connected",t.Closed="closed",t.NotStarted="not_connected";var t;e.request_queue=[],e.table_name="LocalStore",e.is_code_executing=!1}(KeyStore||(KeyStore={}));!function(e){e.prcoessExecutionOfCode=function(t){e.request_queue.push(t),1===e.request_queue.length&&e.executeCode()},e.executeCode=function(){if(!e.is_code_executing&&e.request_queue.length>0){e.is_code_executing=!0;var t={Name:e.request_queue[0].Name,Query:e.request_queue[0].Query};e.executeCodeDirect(t)}},e.executeCodeDirect=function(t){new e.Business.Main(function(e){this.processFinishedRequest(e)}.bind(this)).checkConnectionAndExecuteLogic(t)},e.processFinishedRequest=function(t){var n=e.request_queue.shift();e.is_code_executing=!1,t.ErrorOccured?n.OnError?n.OnError(t.ErrorDetails):console.log(t.ErrorDetails):n.OnSuccess&&n.OnSuccess(t.ReturnedValue),this.executeCode()}}(KeyStore||(KeyStore={}));!function(e){!function(e){var t=function(){return function(){this._results=null,this._errorOccured=!1,this._errorCount=0,this.on_errorOccured=function(e){++this._errorCount,1===this._errorCount&&null!=this.OnError&&this.OnError(e.target.error),console.error(e)}}}();e.Base=t}(e.Business||(e.Business={}))}(KeyStore||(KeyStore={}));!function(e){!function(e){var t=function(t){__extends(n,t);function n(n,r,s){var i=t.call(this)||this;return i.get=function(){var e=function(e,t){var n=this._objectStore.index(e).openCursor(IDBKeyRange.only(t));n.onerror=function(e){this._errorOccured=!0,this.on_errorOccured(e)}.bind(this),n.onsuccess=function(e){var t=e.target.result;t&&(this._results=t.value.Value)}.bind(this)}.bind(this);for(var t in this._query.Where){e(t,this._query.Where[t]);break}},i._query=n,i._onError=s,i._transaction=e.db_connection.transaction([n.From],"readonly"),i._objectStore=i._transaction.objectStore(n.From),i._transaction.oncomplete=function(e){null!=r&&r(this._results)}.bind(i),i.get(),i}return n}(e.Base);e.Get=t}(e.Business||(e.Business={}))}(KeyStore||(KeyStore={}));!function(e){!function(e){var t=function(t){__extends(n,t);function n(n,r,s){var i=t.call(this)||this;i.setData=function(e){var t=function(){var t=this._objectStore.index("Key").openCursor(IDBKeyRange.only(e.Key));t.onsuccess=function(t){var r=t.target.result;r?(r.value.Value=e.Value,r.update(r.value)):n()}.bind(this),t.onerror=function(e){this._errorOccured=!0,this.on_errorOccured(e)}.bind(this)}.bind(this),n=function(){this._objectStore.add(e).onerror=function(e){this._errorOccured=!0,this.on_errorOccured(e)}.bind(this)}.bind(this);t()};try{i._onError=s,i._transaction=e.db_connection.transaction([n.TableName],"readwrite"),i._objectStore=i._transaction.objectStore(n.TableName),i._transaction.oncomplete=function(e){null!=r&&r()},i.setData(n.Set)}catch(e){console.error(e)}return i}return n}(e.Base);e.Set=t}(e.Business||(e.Business={}))}(KeyStore||(KeyStore={}));!function(e){!function(e){var t=function(t){__extends(n,t);function n(n,r,s){var i=t.call(this)||this;return i._rowAffected=0,i.remove=function(){var e=function(e,t){var n=this._objectStore.index(e).openCursor(IDBKeyRange.only(t));n.onerror=function(e){this._errorOccured=!0,this.on_errorOccured(e)}.bind(this),n.onsuccess=function(e){var t=e.target.result;t&&(t.delete(),++this._rowAffected,t.continue())}.bind(this)}.bind(this);for(var t in this._query.Where){this._errorOccured||e(t,this._query.Where[t]);break}},i._query=n,i._onError=s,i._transaction=e.db_connection.transaction([n.From],"readwrite"),i._objectStore=i._transaction.objectStore(n.From),i._transaction.oncomplete=function(){null!=r&&r(this._rowAffected)}.bind(i),i._transaction.onerror=function(e){this.on_errorOccured(e)}.bind(i),i.remove(),i}return n}(e.Base);e.Remove=t}(e.Business||(e.Business={}))}(KeyStore||(KeyStore={}));!function(e){!function(t){var n=function(){return function(n,r,s,i){var o=self.indexedDB.open(n,1);o.onerror=function(e){"InvalidStateError"===e.target.error.name&&(JsStore.status={ConStatus:JsStore.Connection_Status.UnableToStart,LastError:JsStore.Error_Type.IndexedDbBlocked}),null!=i&&i(e.target.error)},o.onsuccess=function(n){t.status.ConStatus=e.ConnectionStatus.Connected,t.db_connection=o.result,t.db_connection.onclose=function(){t.status.ConStatus=e.ConnectionStatus.Closed,t.status.LastError="Connection Closed"},t.db_connection.onversionchange=function(e){null===e.newVersion&&e.target.close()},t.db_connection.onerror=function(e){t.status.LastError="Error occured in connection :"+e.target.result},t.db_connection.onabort=function(n){t.status.ConStatus=e.ConnectionStatus.Closed,t.status.LastError="Connection aborted"},null!=s&&s()},o.onupgradeneeded=function(e){e.target.result.createObjectStore(r,{keyPath:"Key"}).createIndex("Key","Key",{unique:!0})}}}();t.InitDb=n}(e.Business||(e.Business={}))}(KeyStore||(KeyStore={}));!function(e){!function(t){t.status={ConStatus:e.ConnectionStatus.NotStarted,LastError:""};var n=function(){return function(n){void 0===n&&(n=null),this.set=function(e,n,r){new t.Set(e,n,r)},this.remove=function(e,n,r){new t.Remove(e,n,r)},this.get=function(e,n,r){new t.Get(e,n,r)},this.createDb=function(e,n,r){new t.InitDb("KeyStore",e,n,r)},this.checkConnectionAndExecuteLogic=function(n){"create_db"===n.Name||"open_db"===n.Name?this.executeLogic(n):t.status.ConStatus===e.ConnectionStatus.Connected?this.executeLogic(n):t.status.ConStatus===e.ConnectionStatus.NotStarted?setTimeout(function(){this.checkConnectionAndExecuteLogic(n)}.bind(this),100):t.status.ConStatus===e.ConnectionStatus.Closed&&this.createDb(e.table_name,function(){this.checkConnectionAndExecuteLogic(n)}.bind(this),100)},this.returnResult=function(e){this._onSuccess&&this._onSuccess(e)},this.executeLogic=function(e){var t=function(e){this.returnResult({ReturnedValue:e})}.bind(this),n=function(e){this.returnResult({ErrorOccured:!0,ErrorDetails:e})}.bind(this);switch(e.Name){case"get":this.get(e.Query,t,n);break;case"set":this.set(e.Query,t,n);break;case"remove":this.remove(e.Query,t,n);break;case"create_db":this.createDb(e.Query,t,n)}},this._onSuccess=n}}();t.Main=n}(e.Business||(e.Business={}))}(KeyStore||(KeyStore={}));var KeyStore;!function(e){e.init=function(){e.Utils.setDbType(),indexedDB&&e.prcoessExecutionOfCode({Name:"create_db",Query:e.table_name})},e.get=function(t,n,r){void 0===r&&(r=null);var s={From:e.table_name,Where:{Key:t}};return e.prcoessExecutionOfCode({Name:"get",Query:s,OnSuccess:n,OnError:r}),this},e.set=function(t,n,r,s){var i={TableName:e.table_name,Set:{Key:t,Value:n}};return e.prcoessExecutionOfCode({Name:"set",Query:i,OnSuccess:r,OnError:s}),this},e.remove=function(t,n,r){void 0===n&&(n=null),void 0===r&&(r=null);var s={From:e.table_name,Where:{Key:t}};return e.prcoessExecutionOfCode({Name:"remove",Query:s,OnSuccess:n,OnError:r}),this}}(KeyStore||(KeyStore={}));!function(e){(t=e.Occurence||(e.Occurence={})).First="f",t.Last="l",t.Any="a";var t;(n=e.WebWorker_Status||(e.WebWorker_Status={})).Registered="registerd",n.Failed="failed",n.NotStarted="not_started";var n;(r=e.Connection_Status||(e.Connection_Status={})).Connected="connected",r.Closed="closed",r.NotStarted="not_started",r.UnableToStart="unable_to_start";var r;(s=e.WhereQryOption||(e.WhereQryOption={})).In="In",s.Like="Like",s.Or="Or";var s;(i=e.DataType||(e.DataType={})).String="string",i.Object="object",i.Array="array";var i}(JsStore||(JsStore={}));!function(e){e.enable_log=!1,e.db_version=0,e.status={ConStatus:e.Connection_Status.NotStarted,LastError:null},e.temp_results=[],e.getObjectFirstKey=function(e){for(var t in e)return t;return null},e.log=function(t){e.enable_log&&console.log(t)},e.logError=function(t){e.enable_log&&console.error(t)}}(JsStore||(JsStore={}));!function(e){var t=function(){function e(){}return e.convertObjectintoLowerCase=function(e){for(var t=Object.keys(e),n=t.length;n--;){var r=t[n];e[r.toLowerCase()]=e[r],delete e[r]}},e}();e.Utils=t}(JsStore||(JsStore={}));!function(e){e.isDbExist=function(t,n,r){void 0===n&&(n=null),void 0===r&&(r=null);var s=!n;if(e.status.ConStatus!==e.Connection_Status.UnableToStart){if(s)return new Promise(function(n,r){"string"==typeof t?e.getDbVersion(t,function(e){n(Boolean(e))}):e.getDbVersion(t.DbName,function(e){n(t.Table.Version<=e)})});"string"==typeof t?e.getDbVersion.call(this,t,function(e){n.call(this,Boolean(e))}):e.getDbVersion.call(this,t.DbName,function(e){n.call(this,t.Table.Version<=e)})}else{var i={_type:e.status.LastError,_message:null};switch(i._type){case e.Error_Type.IndexedDbBlocked:i._message="IndexedDB is blocked";break;case e.Error_Type.IndexedDbUndefined:i._message="IndexedDB is not supported"}if(s)return new Promise(function(e,t){t(i)});r&&r(i)}},e.getDbVersion=function(e,t){KeyStore.get("JsStore_"+e+"_Db_Version",function(e){t.call(this,Number(e))}.bind(this))},e.getDbSchema=function(t,n){n&&KeyStore.get("JsStore_"+t+"_Schema",function(r){if(r._name)n(r);else{var s=new e.Model.DataBase(r);KeyStore.set("JsStore_"+t+"_Schema",s),n(s)}})},e.isNull=function(e){if(null==e)return!0;switch(typeof e){case"string":return 0===e.length;case"number":return isNaN(e)}return!1},e.enableLog=function(){e.enable_log=!0,e.worker_instance&&e.worker_instance.postMessage({Name:"change_log_status",Query:{logging:e.enable_log}})},e.disableLog=function(){e.enable_log=!1,e.worker_instance&&e.worker_instance.postMessage({Name:"change_log_status",Query:{logging:e.enable_log}})}}(JsStore||(JsStore={}));!function(e){var t;(n=t=e.Error_Type||(e.Error_Type={})).UndefinedColumn="undefined_column",n.UndefinedValue="undefined_value",n.UndefinedColumnName="undefined_column_name",n.UndefinedDbName="undefined_database_name",n.UndefinedColumnValue="undefined_column_value",n.NotArray="not_array",n.NoValueSupplied="no_value_supplied",n.ColumnNotExist="column_not_exist",n.InvalidOp="invalid_operator",n.NullValue="null_value",n.BadDataType="bad_data_type",n.NextJoinNotExist="next_join_not_exist",n.TableNotExist="table_not_exist",n.DbNotExist="db_not_exist",n.IndexedDbUndefined="indexeddb_undefined",n.IndexedDbBlocked="indexeddb_blocked",n.ConnectionAborted="connection_aborted",n.ConnectionClosed="connection_closed",n.NotObject="not_object";var n,r=function(){function e(e,n){void 0===n&&(n=null),this.throw=function(){throw this.get()},this.logError=function(){console.error(this.get())},this.logWarning=function(){console.warn(this.get())},this.getMsg=function(){var e;switch(this._type){case t.NotArray:e="Supplied value is not an array";break;case t.UndefinedColumn:e="Column is undefined in Where";break;case t.UndefinedValue:e="Value is undefined in Where";break;case t.UndefinedColumnName:e="Column name is undefined '"+this._info.TableName+"'";break;case t.UndefinedDbName:e="Database name is not supplied";break;case t.UndefinedColumnValue:e="Column value is undefined";break;case t.NoValueSupplied:e="No value supplied";break;case t.InvalidOp:e="Invalid Op Value '"+this._info.Op+"'";break;case t.ColumnNotExist:e="Column '"+this._info.ColumnName+"' does not exist";break;case t.NullValue:e="Null value is not allowed for column '"+this._info.ColumnName+"'";break;case t.BadDataType:e="Supplied value for column '"+this._info.ColumnName+"' does not have valid type";break;case t.NextJoinNotExist:e="Next join details not supplied";break;case t.TableNotExist:e="Table '"+this._info.TableName+"' does not exist";break;case t.DbNotExist:e="Database '"+this._info.DbName+"' does not exist";break;case t.NotObject:e="supplied value is not object";break;default:e=this._message}return e},this._type=e,this._info=n,this._message=this.getMsg()}return e.prototype.get=function(){return{_message:this._message,_type:this._type}},e}();e.Error=r}(JsStore||(JsStore={}));!function(e){!function(t){var n=function(){return function(t,n){null!=t.Name?this._name=t.Name:new e.Error(e.Error_Type.UndefinedColumnName,{TableName:n}).throw();this._autoIncrement=null!=t.AutoIncrement&&t.AutoIncrement,this._primaryKey=null!=t.PrimaryKey&&t.PrimaryKey,this._unique=null!=t.Unique&&t.Unique,this._notNull=null!=t.NotNull&&t.NotNull,this._dataType=null!=t.DataType?t.DataType:t.AutoIncrement?"number":null,this._default=t.Default,this._multiEntry=null!=t.MultiEntry}}();t.Column=n}(e.Model||(e.Model={}))}(JsStore||(JsStore={}));!function(e){!function(t){var n=function(){function n(e,n){this._columns=[],this._requireDelete=!1,this._requireCreation=!1,this._primaryKey="",this._name=e.Name,this._version=null==e.Version?1:e.Version,e.Columns.forEach(function(n){this._columns.push(new t.Column(n,e.Name))},this),this.setRequireDelete(n),this.setDbVersion(n),this.setPrimaryKey(n)}return n.prototype.setPrimaryKey=function(e){this._columns.every(function(e){return this._primaryKey=e._primaryKey?e._name:"",!e._primaryKey},this)},n.prototype.setRequireDelete=function(e){KeyStore.get("JsStore_"+e+"_"+this._name+"_Version",function(e){null==e?this._requireCreation=!0:e<this._version&&(this._requireDelete=!0)}.bind(this))},n.prototype.setDbVersion=function(t){e.db_version=e.db_version>this._version?e.db_version:this._version,KeyStore.set("JsStore_"+t+"_Db_Version",e.db_version).set("JsStore_"+t+"_"+this._name+"_Version",e.db_version),this._version=e.db_version},n}();t.Table=n}(e.Model||(e.Model={}))}(JsStore||(JsStore={}));!function(e){!function(e){var t=function(){return function(t){this._tables=[],this._name=t.Name,t.Tables.forEach(function(t){this._tables.push(new e.Table(t,this._name))},this)}}();e.DataBase=t}(e.Model||(e.Model={}))}(JsStore||(JsStore={}));!function(e){!function(e){var t=function(){function t(){this.getTable=function(t){var n;return e.active_db._tables.every(function(e){return e._name!==t||(n=e,!1)}),n},this.getKeyRange=function(e,t){var n;switch(t){case"-":n=IDBKeyRange.bound(e.Low,e.High,!1,!1);break;case">":n=IDBKeyRange.lowerBound(e,!0);break;case">=":n=IDBKeyRange.lowerBound(e);break;case"<":n=IDBKeyRange.upperBound(e,!0);break;case"<=":n=IDBKeyRange.upperBound(e);break;default:n=IDBKeyRange.only(e)}return n},this.getObjectSecondKey=function(e){var t=!1;for(var n in e){if(t)return n;t=!0}},this.getPrimaryKey=function(e){var t=this.getTable(e)._primaryKey;return t||this.getKeyPath(e)},this.getKeyPath=function(t){return e.db_connection.transaction([t],"readonly").objectStore(t).keyPath},this.sortNumberInAsc=function(e){return e.sort(function(e,t){return e-t}),e},this.sortNumberInDesc=function(e){return e.sort(function(e,t){return t-e}),e},this.sortAlphabetInAsc=function(e){return e.sort(function(e,t){return e.toLowerCase().localeCompare(t.toLowerCase())}),e},this.sortAlphabetInDesc=function(e){return e.sort(function(e,t){return t.toLowerCase().localeCompare(e.toLowerCase())}),e}}return t.prototype.getAllCombinationOfWord=function(e,t){if(t){for(var n=[],r=0,s=e.length;r<s;r++)n=n.concat(this.getCombination(e[r]));return n}return this.getCombination(e)},t.prototype.getCombination=function(e){var t=[],n=function(e,r,s){if(s===e.length)t.push(r.join(""));else{var i=e.charAt(s);r[s]=i.toLowerCase(),n(e,r,s+1),r[s]=i.toUpperCase(),n(e,r,s+1)}};return n(e,[],0),t},t}();e.BaseHelper=t}(e.Business||(e.Business={}))}(JsStore||(JsStore={}));!function(e){!function(t){var n=function(t){__extends(n,t);function n(){var n=null!==t&&t.apply(this,arguments)||this;return n._errorOccured=!1,n._errorCount=0,n._rowAffected=0,n._sendResultFlag=!0,n.onErrorOccured=function(t,n){if(void 0===n&&(n=!1),++this._errorCount,1===this._errorCount&&null!=this._onError)if(n)this._onError(t),e.logError(t);else{var r={_message:t.target.error.message,_type:t.target.error.name};this._onError(r),e.logError(r)}},n.onTransactionTimeout=function(e){console.error("transaction timed out")},n.onExceptionOccured=function(t,n){switch(t.name){case"NotFoundError":var r=new e.Error(e.Error_Type.TableNotExist,n);this.onErrorOccured(r.get(),!0);break;default:console.error(t)}},n.goToWhereLogic=function(){var t=e.getObjectFirstKey(this._query.Where);if(!0===this._query.IgnoreCase&&(this._query.Where=this.makeQryInCaseSensitive(this._query.Where)),this._objectStore.indexNames.contains(t)){var n=this._query.Where[t];if("object"==typeof n){this._checkFlag=Boolean(Object.keys(n).length>1||Object.keys(this._query.Where).length>1);var r=e.getObjectFirstKey(n);switch(r){case"Like":var s=n.Like.split("%");s[1]?s.length>2?this.executeLikeLogic(t,s[1],e.Occurence.Any):this.executeLikeLogic(t,s[1],e.Occurence.Last):this.executeLikeLogic(t,s[0],e.Occurence.First);break;case"In":this.executeInLogic(t,n.In);break;case"-":case">":case"<":case">=":case"<=":this.executeWhereLogic(t,n,r);break;case"Aggregate":break;default:this.executeWhereLogic(t,n)}}else this._checkFlag=Boolean(Object.keys(this._query.Where).length>1),this.executeWhereLogic(t,n)}else this._errorOccured=!0,this.Error=new e.Error(e.Error_Type.ColumnNotExist,{ColumnName:t}),this.Error.throw()},n.makeQryInCaseSensitive=function(t){var n,r,s=[];for(var i in t)if("object"==typeof(n=t[i])){for(var o in n)switch(r=n[o],o){case e.WhereQryOption.In:s=s.concat(this.getAllCombinationOfWord(r,!0));break;case e.WhereQryOption.Like:break;default:s=s.concat(this.getAllCombinationOfWord(r))}t[i].In=s}else s=s.concat(this.getAllCombinationOfWord(n)),t[i]={In:s};return t},n}return n.prototype.checkForWhereConditionMatch=function(t){var n=this._query.Where,r=!0,s=function(e,t){for(var s=n[e].In,i=0,o=s.length;i<o;i++){if(s[i]===t){r=!0;break}r=!1}},i=function(t,s){var i,o,c,u=n[t].Like.split("%");switch(u[1]?(o=u[1],i=u.length>2?e.Occurence.Any:e.Occurence.Last):(o=u[0],i=e.Occurence.First),s=s.toLowerCase(),i){case e.Occurence.Any:(c=s.indexOf(o.toLowerCase()))<0&&(r=!1);break;case e.Occurence.First:((c=s.indexOf(o.toLowerCase()))>0||c<0)&&(r=!1);break;default:(c=s.lastIndexOf(o.toLowerCase()))<s.length-o.length&&(r=!1)}},o=function(e,t,s){var i=n[e][s];switch(s){case">":t<=i&&(r=!1);break;case"<":t>=i&&(r=!1);break;case"<=":t>i&&(r=!1);break;case">=":t<i&&(r=!1);break;case"-":(t<i.Low||t>i.High)&&(r=!1)}};for(var c in n){var u=n[c];if(!r)break;if("object"==typeof u)for(var a in u){if(!r)break;switch(a){case"In":s(c,t[c]);break;case"Like":i(c,t[c]);break;case"-":case">":case"<":case">=":case"<=":o(c,t[c],a)}}else if(u!==t[c]){r=!1;break}}return r},n}(t.BaseHelper);t.Base=n}(e.Business||(e.Business={}))}(JsStore||(JsStore={}));!function(e){!function(t){var n=function(){return function(n,r,s){var i=[],o=indexedDB.open(t.active_db._name,n);o.onerror=function(e){null!=s&&s(e.target.error)},o.onsuccess=function(n){e.status.ConStatus=e.Connection_Status.Connected,t.db_connection=o.result,t.db_connection.onclose=function(){e.status.ConStatus=e.Connection_Status.Closed,e.status.LastError=e.Error_Type.ConnectionClosed},t.db_connection.onversionchange=function(e){null===e.newVersion&&e.target.close()},t.db_connection.onerror=function(t){e.status.LastError="Error occured in connection :"+t.target.result},t.db_connection.onabort=function(t){e.status.ConStatus=e.Connection_Status.Closed,e.status.LastError=e.Error_Type.ConnectionAborted},null!=r&&r(i),KeyStore.set("JsStore_"+t.active_db._name+"_Schema",t.active_db)},o.onupgradeneeded=function(e){var n=e.target.result;t.active_db._tables.forEach(function(e){e._requireDelete?(n.objectStoreNames.contains(e._name)&&n.deleteObjectStore(e._name),c(n,e)):e._requireCreation&&c(n,e)})};var c=function(e,n){try{if(n._primaryKey.length>0){var r=e.createObjectStore(n._name,{keyPath:n._primaryKey});n._columns.forEach(function(e){var s=e._primaryKey?{unique:!0}:{unique:e._unique};s.multiEntry=e._multiEntry,r.createIndex(e._name,e._name,s),e._autoIncrement&&KeyStore.set("JsStore_"+t.active_db._name+"_"+n._name+"_"+e._name+"_Value",0)})}else r=e.createObjectStore(n._name,{autoIncrement:!0}),n._columns.forEach(function(e){var s={unique:e._unique,multiEntry:e._multiEntry};r.createIndex(e._name,e._name,s),e._autoIncrement&&KeyStore.set("JsStore_"+t.active_db._name+"_"+n._name+"_"+e._name+"_Value",0)});i.push(n._name),KeyStore.set("JsStore_"+t.active_db._name+"_"+n._name+"_Version",n._version)}catch(e){console.error(e)}}}}();t.CreateDb=n}(e.Business||(e.Business={}))}(JsStore||(JsStore={}));!function(e){!function(t){var n=function(){return function(n,r,s){this.deleteDb=function(n,r,s){var i=indexedDB.deleteDatabase(n);i.onblocked=function(){null!=s&&s("database is blocked, cant be deleted right now.")},i.onerror=function(e){null!=s&&s(event.target.error)},i.onsuccess=function(){e.status.ConStatus=e.Connection_Status.Closed,KeyStore.remove("JsStore_"+t.active_db._name+"_Db_Version"),t.active_db._tables.forEach(function(e){KeyStore.remove("JsStore_"+t.active_db._name+"_"+e._name+"_Version"),e._columns.forEach(function(n){n._autoIncrement&&KeyStore.remove("JsStore_"+t.active_db._name+"_"+e._name+"_"+n._name+"_Value")})}),KeyStore.remove("JsStore_"+t.active_db._name+"_Schema"),r()}},t.db_connection.close(),setTimeout(function(){this.deleteDb(n,r,s)}.bind(this),100)}}();t.DropDb=n}(e.Business||(e.Business={}))}(JsStore||(JsStore={}));!function(e){!function(t){var n=function(n){__extends(r,n);function r(r,s,i){var o=n.call(this)||this;o.bulkinsertData=function(){this._transaction=t.db_connection.transaction([this._query.Into],"readwrite"),this._objectStore=this._transaction.objectStore(this._query.Into),this._transaction.oncomplete=function(e){this._onSuccess()}.bind(this),this._query.Values.forEach(function(e){this._objectStore.add(e)},this)};try{if(o._query=r,o._onSuccess=s,o._onError=i,o.getTable(r.Into))o.bulkinsertData();else{new e.Error(e.Error_Type.TableNotExist,{TableName:r.Into}).throw()}}catch(e){o.onExceptionOccured(e,{TableName:r.Into})}return o}return r}(t.Base);t.BulkInsert=n}(e.Business||(e.Business={}))}(JsStore||(JsStore={}));!function(e){!function(t){var n=function(){return function(n,r,s){if(t.active_db._name.length>0){var i=indexedDB.open(t.active_db._name,n);i.onerror=function(e){null!=s&&s(e.target.error)},i.onsuccess=function(n){e.status.ConStatus=e.Connection_Status.Connected,t.db_connection=i.result,t.db_connection.onclose=function(){e.status.ConStatus=e.Connection_Status.Closed,e.status.LastError=e.Error_Type.ConnectionClosed},t.db_connection.onversionchange=function(e){null===e.newVersion&&e.target.close()},t.db_connection.onerror=function(t){e.status.LastError="Error occured in connection :"+t.target.result},t.db_connection.onabort=function(t){e.status.ConStatus=e.Connection_Status.Closed,e.status.LastError=e.Error_Type.ConnectionAborted},null!=r&&r()}.bind(this)}else new e.Error(e.Error_Type.UndefinedDbName).throw()}}();t.OpenDb=n}(e.Business||(e.Business={}))}(JsStore||(JsStore={}));!function(e){!function(e){var t=function(t){__extends(n,t);function n(n,r,s){var i=t.call(this)||this,o=e.db_connection.transaction([n],"readwrite").objectStore(n).clear();return o.onsuccess=function(t){this.getTable(n)._columns.forEach(function(t){t._autoIncrement&&KeyStore.set("JsStore_"+e.active_db._name+"_"+n+"_"+t._name+"_Value",0)}),null!=r&&r()}.bind(i),o.onerror=function(e){null!=s&&s(e)},i}return n}(e.Base);e.Clear=t}(e.Business||(e.Business={}))}(JsStore||(JsStore={}));!function(e){!function(t){var n=function(){return function(n){void 0===n&&(n=null),this.checkConnectionAndExecuteLogic=function(n){switch(e.log("checking connection and executing request:"+n.Name),n.Name){case"create_db":case"open_db":this.executeLogic(n);break;case"change_log_status":this.changeLogStatus(n);default:switch(e.status.ConStatus){case e.Connection_Status.Connected:this.executeLogic(n);break;case e.Connection_Status.Closed:this.openDb(t.active_db._name,function(){this.checkConnectionAndExecuteLogic(n)}.bind(this))}}},this.changeLogStatus=function(t){!0===t.Query.logging?e.enable_log=!0:e.enable_log=!1},this.returnResult=function(e){this._onSuccess?this._onSuccess(e):self.postMessage(e)},this.executeLogic=function(e){var t=function(e){this.returnResult({ReturnedValue:e})}.bind(this),n=function(e){this.returnResult({ErrorDetails:e,ErrorOccured:!0})}.bind(this);switch(e.Name){case"select":this.select(e.Query,t,n);break;case"insert":this.insert(e.Query,t,n);break;case"update":this.update(e.Query,t,n);break;case"delete":this.delete(e.Query,t,n);break;case"open_db":this.openDb(e.Query,t,n);break;case"create_db":this.createDb(e.Query,t,n);break;case"clear":this.clear(e.Query,t,n);break;case"drop_db":this.dropDb(t,n);break;case"count":this.count(e.Query,t,n);break;case"bulk_insert":this.bulkInsert(e.Query,t,n);break;case"export_json":this.exportJson(e.Query,t,n);break;default:console.error("The Api:-"+e.Name+"does not support")}},this.openDb=function(n,r,s){e.getDbVersion(n,function(i){null!=i?e.getDbSchema(n,function(e){t.active_db=e,new t.OpenDb(i,r,s)}):new e.Error(e.Error_Type.DbNotExist,{DbName:n}).throw()})},this.closeDb=function(){e.status.ConStatus===e.Connection_Status.Connected&&t.db_connection.close()},this.dropDb=function(e,n){new t.DropDb(t.active_db._name,e,n)},this.update=function(e,n,r){new t.Update.Instance(e,n,r)},this.insert=function(n,r,s){if(Array.isArray(n.Values))new t.Insert.Instance(n,r,s);else{var i=new e.Error(e.Error_Type.NotArray);i.logError(),s(i.get())}},this.bulkInsert=function(n,r,s){if(Array.isArray(n.Values))new t.BulkInsert(n,r,s);else{var i=new e.Error(e.Error_Type.NotArray);i.logError(),s(i.get())}},this.delete=function(e,n,r){new t.Delete.Instance(e,n,r)},this.select=function(e,n,r){"object"==typeof e.From?new t.Select.Join(e,n,r):new t.Select.Instance(e,n,r)},this.count=function(e,n,r){"object"==typeof e.From?(e.Count=!0,new t.Select.Join(e,n,r)):new t.Count.Instance(e,n,r)},this.createDb=function(n,r,s){this.closeDb(),KeyStore.get("JsStore_"+n.Name+"_Db_Version",function(i){e.db_version=i||1,t.active_db=new e.Model.DataBase(n);var o=function(){setTimeout(function(){var n=t.active_db._tables[t.active_db._tables.length-1];KeyStore.get("JsStore_"+t.active_db._name+"_"+n._name+"_Version",function(i){i===n._version?new t.CreateDb(e.db_version,r,s):o()})},200)};o()})},this.clear=function(e,n,r){new t.Clear(e,n,r)},this.exportJson=function(e,t,n){this.select(e,function(e){var n=URL.createObjectURL(new Blob([JSON.stringify(e)],{type:"text/json"}));t(n)},function(e){n(e)})},this._onSuccess=n}}();t.Main=n}(e.Business||(e.Business={}))}(JsStore||(JsStore={}));!function(e){(function(e){var n=function(e){__extends(t,e);function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._results=[],t._sorted=!1,t._checkFlag=!1,t.removeDuplicates=function(){var e=this._results;this._results=void 0;var t=this.getPrimaryKey(this._query.From),n={};for(var r in e)n[e[r][t]]=e[r];e=[];for(r in n)e.push(n[r]);this._results=e},t}return t}(t.Base);e.BaseSelect=n})((t=e.Business||(e.Business={})).Select||(t.Select={}));var t}(JsStore||(JsStore={}));!function(e){(function(t){var n=function(t){__extends(n,t);function n(){var n=null!==t&&t.apply(this,arguments)||this;return n.executeWhereUndefinedLogic=function(){if(this._query.Order&&this._query.Order.By)if(this._objectStore.indexNames.contains(this._query.Order.By)){var t=this._query.Order.Type&&"desc"===this._query.Order.Type.toLowerCase()?"prev":"next";this._sorted=!0,this._cursorOpenRequest=this._objectStore.index(this._query.Order.By).openCursor(null,t)}else new e.Error(e.Error_Type.ColumnNotExist,{ColumnName:this._query.Order.By}).throw();else this._cursorOpenRequest=this._objectStore.openCursor();this._skipRecord&&this._limitRecord?this.executeSkipAndLimitForNoWhere():this._skipRecord?this.executeSkipForNoWhere():this._limitRecord?this.executeLimitForNotWhere():this.executeSimpleForNotWhere(),this._cursorOpenRequest.onerror=function(e){this._errorOccured=!0,this.onErrorOccured(e)}.bind(this)},n.executeSkipAndLimitForNoWhere=function(){var e,t=!1;this._cursorOpenRequest.onsuccess=function(n){(e=n.target.result)&&(t&&this._results.length!==this._limitRecord?(this._results.push(e.value),e.continue()):(t=!0,e.advance(this._skipRecord)))}.bind(this)},n.executeSkipForNoWhere=function(){var e,t=!1;this._cursorOpenRequest.onsuccess=function(n){(e=n.target.result)&&(t?(this._results.push(e.value),e.continue()):(t=!0,e.advance(this._skipRecord)))}.bind(this)},n.executeSimpleForNotWhere=function(){var e;this._cursorOpenRequest.onsuccess=function(t){(e=t.target.result)&&(this._results.push(e.value),e.continue())}.bind(this)},n.executeLimitForNotWhere=function(){var e;this._cursorOpenRequest.onsuccess=function(t){(e=t.target.result)&&this._results.length!==this._limitRecord&&(this._results.push(e.value),e.continue())}.bind(this)},n}return n}(t.BaseSelect);t.NotWhere=n})((t=e.Business||(e.Business={})).Select||(t.Select={}));var t}(JsStore||(JsStore={}));!function(e){(function(e){var t=function(e){__extends(t,e);function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.executeInLogic=function(e,t){this._skipRecord&&this._limitRecord?this.executeSkipAndLimitForIn(e,t):this._skipRecord?this.executeSkipForIn(e,t):this._limitRecord?this.executeLimitForIn(e,t):this.executeSimpleForIn(e,t)},t.executeSkipAndLimitForIn=function(e,t){var n,r,s=this._skipRecord,i=this._objectStore.index(e),o=function(e){0===s?this._results.push(e):--s}.bind(this);if(this._checkFlag)for(var c=0,u=t.length;c<u;c++)this._errorOccured||((r=i.openCursor(IDBKeyRange.only(t[c]))).onsuccess=function(e){n=e.target.result,this._results.length!==this._limitRecord&&n&&(this.checkForWhereConditionMatch(n.value)&&o(n.value),n.continue())}.bind(this));else for(c=0,u=t.length;c<u;c++)this._errorOccured||((r=i.openCursor(IDBKeyRange.only(t[c]))).onsuccess=function(e){n=e.target.result,this._results.length!==this._limitRecord&&n&&(o(n.value),n.continue())}.bind(this));r.onerror=function(e){this._errorOccured=!0,this.onErrorOccured(e)}.bind(this)},t.executeSkipForIn=function(e,t){var n,r,s=this._skipRecord,i=this._objectStore.index(e),o=function(e){0===s?this._results.push(e):--s}.bind(this);if(this._checkFlag)for(var c=0,u=t.length;c<u;c++)this._errorOccured||((r=i.openCursor(IDBKeyRange.only(t[c]))).onsuccess=function(e){(n=e.target.result)&&(this.checkForWhereConditionMatch(n.value)&&o(n.value),n.continue())}.bind(this));else for(c=0,u=t.length;c<u;c++)this._errorOccured||((r=i.openCursor(IDBKeyRange.only(t[c]))).onsuccess=function(e){(n=e.target.result)&&(o(n.value),n.continue())}.bind(this));r.onerror=function(e){this._errorOccured=!0,this.onErrorOccured(e)}.bind(this)},t.executeLimitForIn=function(e,t){var n,r,s=this._objectStore.index(e);if(this._checkFlag)for(var i=0,o=t.length;i<o;i++)this._errorOccured||((r=s.openCursor(IDBKeyRange.only(t[i]))).onsuccess=function(e){(n=e.target.result)&&this._results.length!==this._limitRecord&&(this.checkForWhereConditionMatch(n.value)&&this._results.push(n.value),n.continue())}.bind(this));else for(i=0,o=t.length;i<o;i++)this._errorOccured||((r=s.openCursor(IDBKeyRange.only(t[i]))).onsuccess=function(e){(n=e.target.result)&&this._results.length!==this._limitRecord&&(this._results.push(n.value),n.continue())}.bind(this));r.onerror=function(e){this._errorOccured=!0,this.onErrorOccured(e)}.bind(this)},t.executeSimpleForIn=function(e,t){var n,r,s=this._objectStore.index(e);if(this._checkFlag)for(var i=0,o=t.length;i<o;i++)this._errorOccured||((r=s.openCursor(IDBKeyRange.only(t[i]))).onsuccess=function(e){(n=e.target.result)&&(this.checkForWhereConditionMatch(n.value)&&this._results.push(n.value),n.continue())}.bind(this));else for(i=0,o=t.length;i<o;i++)this._errorOccured||((r=s.openCursor(IDBKeyRange.only(t[i]))).onsuccess=function(e){(n=e.target.result)&&(this._results.push(n.value),n.continue())}.bind(this));r.onerror=function(e){this._errorOccured=!0,this.onErrorOccured(e)}.bind(this)},t}return t}(e.NotWhere);e.In=t})((t=e.Business||(e.Business={})).Select||(t.Select={}));var t}(JsStore||(JsStore={}));!function(e){(function(t){var n=function(t){__extends(n,t);function n(){var n=null!==t&&t.apply(this,arguments)||this;return n.executeLikeLogic=function(e,t,n){this._compValue=t.toLowerCase(),this._compValueLength=this._compValue.length,this._compSymbol=n,this._cursorOpenRequest=this._objectStore.index(e).openCursor(),this._cursorOpenRequest.onerror=function(e){this._errorOccured=!0,this.onErrorOccured(e)}.bind(this),this._skipRecord&&this._limitRecord?this.executeSkipAndLimit():this._skipRecord?this.executeSkip():this._limitRecord?this.executeLimit():this.executeSimple()},n.filterOnOccurence=function(t){var n=!1;switch(t=t.toLowerCase(),this._compSymbol){case e.Occurence.Any:t.indexOf(this._compValue)>=0&&(n=!0);break;case e.Occurence.First:0===t.indexOf(this._compValue)&&(n=!0);break;default:t.lastIndexOf(this._compValue)===t.length-this._compValueLength&&(n=!0)}return n},n.executeSkipAndLimit=function(){var e,t=this._skipRecord,n=function(e){0===t?this._results.push(e):--t}.bind(this);this._checkFlag?this._cursorOpenRequest.onsuccess=function(t){e=t.target.result,this._results.length!==this._limitRecord&&e&&(this.filterOnOccurence(e.key)&&this.checkForWhereConditionMatch(e.value)&&n(e.value),e.continue())}.bind(this):this._cursorOpenRequest.onsuccess=function(t){e=t.target.result,this._results.length!==this._limitRecord&&e&&(this.filterOnOccurence(e.key)&&n(e.value),e.continue())}.bind(this)},n.executeSkip=function(){var e,t=this._skipRecord,n=function(e){0===t?this._results.push(e):--t}.bind(this);this._checkFlag?this._cursorOpenRequest.onsuccess=function(t){(e=t.target.result)&&(this.filterOnOccurence(e.key)&&this.checkForWhereConditionMatch(e.value)&&n(e.value),e.continue())}.bind(this):this._cursorOpenRequest.onsuccess=function(t){(e=t.target.result)&&(this.filterOnOccurence(e.key)&&n(e.value),e.continue())}.bind(this)},n.executeLimit=function(){var e;this._checkFlag?this._cursorOpenRequest.onsuccess=function(t){e=t.target.result,this._results.length!==this._limitRecord&&e&&(this.filterOnOccurence(e.key)&&this.checkForWhereConditionMatch(e.value)&&this._results.push(e.value),e.continue())}.bind(this):this._cursorOpenRequest.onsuccess=function(t){e=t.target.result,this._results.length!==this._limitRecord&&e&&(this.filterOnOccurence(e.key)&&this._results.push(e.value),e.continue())}.bind(this)},n.executeSimple=function(){var e;this._checkFlag?this._cursorOpenRequest.onsuccess=function(t){(e=t.target.result)&&(this.filterOnOccurence(e.key)&&this.checkForWhereConditionMatch(e.value)&&this._results.push(e.value),e.continue())}.bind(this):this._cursorOpenRequest.onsuccess=function(t){(e=t.target.result)&&(this.filterOnOccurence(e.key)&&this._results.push(e.value),e.continue())}.bind(this)},n}return n}(t.In);t.Like=n})((t=e.Business||(e.Business={})).Select||(t.Select={}));var t}(JsStore||(JsStore={}));!function(e){(function(e){var t=function(e){__extends(t,e);function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.executeSkipAndLimitForWhere=function(){var e,t=!1;this._checkFlag?this._cursorOpenRequest.onsuccess=function(n){(e=n.target.result)&&(t&&this._results.length!==this._limitRecord?(this.checkForWhereConditionMatch(e.value)&&this._results.push(e.value),e.continue()):(t=!0,e.advance(this._skipRecord)))}.bind(this):this._cursorOpenRequest.onsuccess=function(n){(e=n.target.result)&&(t&&this._results.length!==this._limitRecord?(this._results.push(e.value),e.continue()):(t=!0,e.advance(this._skipRecord)))}.bind(this)},t.executeSkipForWhere=function(){var e,t=!1;this._checkFlag?this._cursorOpenRequest.onsuccess=function(n){(e=n.target.result)&&(t?(this.checkForWhereConditionMatch(e.value)&&this._results.push(e.value),e.continue()):(t=!0,e.advance(this._skipRecord)))}.bind(this):this._cursorOpenRequest.onsuccess=function(n){(e=n.target.result)&&(t?(this._results.push(e.value),e.continue()):(t=!0,e.advance(this._skipRecord)))}.bind(this)},t.executeLimitForWhere=function(){var e;this._checkFlag?this._cursorOpenRequest.onsuccess=function(t){(e=t.target.result)&&this._results.length!==this._limitRecord&&this.checkForWhereConditionMatch(e.value)&&(this._results.push(e.value),e.continue())}.bind(this):this._cursorOpenRequest.onsuccess=function(t){(e=t.target.result)&&this._results.length!==this._limitRecord&&(this._results.push(e.value),e.continue())}.bind(this)},t.executeSimpleForWhere=function(){var e;this._checkFlag?this._cursorOpenRequest.onsuccess=function(t){(e=t.target.result)&&(this.checkForWhereConditionMatch(e.value)&&this._results.push(e.value),e.continue())}.bind(this):this._cursorOpenRequest.onsuccess=function(t){(e=t.target.result)&&(this._results.push(e.value),e.continue())}.bind(this)},t.executeWhereLogic=function(e,t,n){t=n?t[n]:t,this._cursorOpenRequest=this._objectStore.index(e).openCursor(this.getKeyRange(t,n)),this._cursorOpenRequest.onerror=function(e){this._errorOccured=!0,this.onErrorOccured(e)}.bind(this),this._skipRecord&&this._limitRecord?this.executeSkipAndLimitForWhere():this._skipRecord?this.executeSkipForWhere():this._limitRecord?this.executeLimitForWhere():this.executeSimpleForWhere()},t}return t}(e.Like);e.Where=t})((t=e.Business||(e.Business={})).Select||(t.Select={}));var t}(JsStore||(JsStore={}));!function(e){(function(e){var t=function(t){__extends(n,t);function n(n,r,s){var i=t.call(this)||this;i._queryStack=[],i._currentQueryStackIndex=0,i.onTransactionCompleted=function(e){null!=this._onSuccess&&this._queryStack.length===this._currentQueryStackIndex+1&&(this._query.Count?this._onSuccess(this._results.length):(this._query.Skip&&this._query.Limit?(this._results.splice(0,this._query.Skip),this._results.splice(this._query.Limit-1,this._results.length)):this._query.Skip?this._results.splice(0,this._query.Skip):this._query.Limit&&this._results.splice(this._query.Limit-1,this._results.length),this._onSuccess(this._results)))},i.executeWhereJoinLogic=function(t,n){var r,s=[],i=0,o=(n.Column,this._results),c=o.length,u=(new e.Instance({From:n.Table,Where:n.Where,Order:n.Order},function(e){e.forEach(function(e,n){for(var s=0;s<c;s++)r=o[s][t.Table][t.Column],u(r,e,s)}),this._results=s,this._queryStack.length>this._currentQueryStackIndex+1?this.startExecutionJoinLogic():this.onTransactionCompleted(null)}.bind(this),this.onErrorOccured.bind(this)),function(e,t,r){if(s[i]={},e===t[n.Column]){s[i][n.Table]=t;for(var c=0;c<this._currentQueryStackIndex;c++)s[i][this._queryStack[c].Table]=o[r][this._queryStack[c].Table];++i}else if("left"===n.JoinType){for(s[i]={},s[i][n.Table]=null,c=0;c<this._currentQueryStackIndex;c++)s[i][this._queryStack[c].Table]=o[r][this._queryStack[c].Table];++i}}.bind(this))},i.executeRightJoin=function(t,n){var r=[],s=(n.Column,this._results),i=s.length,o=0,c=function(){this._results=r,this._queryStack.length>this._currentQueryStackIndex+1?this.startExecutionJoinLogic():this.onTransactionCompleted(null)}.bind(this),u=function(e){var c=!1;e.forEach(function(e,u){for(o=0;o<i;o++)if(e[n.Column]===s[o][t.Table][t.Column]){c=!0;break}if(r[u]={},r[u][n.Table]=e,c){c=!1;for(var a=0;a<this._currentQueryStackIndex;a++)r[u][this._queryStack[a].Table]=s[o][this._queryStack[a].Table]}else for(a=0;a<this._currentQueryStackIndex;a++)r[u][this._queryStack[a].Table]=null},this)}.bind(this);(function(){new e.Instance({From:n.Table,Where:n.Where,Order:n.Order},function(e){u(e),c()}.bind(this),this.onErrorOccured.bind(this))}).bind(this)()},i.executeWhereUndefinedLogicForJoin=function(t,n){var r=[],s=0,i=(n.Column,this._results),o=i.length,c=0,u={},a=function(){this._results=r,this._queryStack.length>this._currentQueryStackIndex+1?this.startExecutionJoinLogic():this.onTransactionCompleted(null)}.bind(this),h=function(e){if(e.length>0)e.forEach(function(e){r[s]={},r[s][n.Table]=e;for(var t=0;t<this._currentQueryStackIndex;t++)r[s][this._queryStack[t].Table]=i[c][this._queryStack[t].Table];++s},this);else if("left"===n.JoinType){r[s]={},r[s][n.Table]=null;for(var t=0;t<this._currentQueryStackIndex;t++)r[s][this._queryStack[t].Table]=i[c][this._queryStack[t].Table];++s}}.bind(this),l=function(){c<o?this._errorOccured||(u[n.Column]=i[c][t.Table][t.Column],new e.Instance({From:n.Table,Where:u,Order:n.Order},function(e){h(e),++c,l()}.bind(this),this.onErrorOccured.bind(this))):a()}.bind(this);l()},i._onSuccess=r,i._onError=s,i._query=n;var o=[],c=function(e){return e.hasOwnProperty("Table1")?(e.Table2.JoinType=void 0===e.Join?"inner":e.Join.toLowerCase(),this._queryStack.push(e.Table2),this._queryStack.length%2==0&&(this._queryStack[this._queryStack.length-1].NextJoin=e.NextJoin),o.push(e.Table2.Table),c(e.Table1)):(this._queryStack.push(e),void o.push(e.Table))}.bind(i);return c(n.From),i._queryStack.reverse(),i._errorOccured||new e.Instance({From:i._queryStack[0].Table,Where:i._queryStack[0].Where},function(e){var t=this._queryStack[0].Table;e.forEach(function(e,n){this._results[n]={},this._results[n][t]=e},this),this.startExecutionJoinLogic()}.bind(i),i.onErrorOccured.bind(i)),i}return n.prototype.startExecutionJoinLogic=function(){var e;this._currentQueryStackIndex>=1&&this._currentQueryStackIndex%2==1?(e={Table:this._queryStack[this._currentQueryStackIndex].NextJoin.Table,Column:this._queryStack[this._currentQueryStackIndex].NextJoin.Column},this._currentQueryStackIndex++):e=this._queryStack[this._currentQueryStackIndex++];var t=this._queryStack[this._currentQueryStackIndex];"right"===t.JoinType?this.executeRightJoin(e,t):t.Where?this.executeWhereJoinLogic(e,t):this.executeWhereUndefinedLogicForJoin(e,t)},n}(e.BaseSelect);e.Join=t})((t=e.Business||(e.Business={})).Select||(t.Select={}));var t}(JsStore||(JsStore={}));!function(e){(function(e){var t=function(e){__extends(t,e);function t(){var t=e.call(this)||this;return t.processGroupBy=function(){var e=this._query.GroupBy,t=this._results,n={};if(this._results=this._query.GroupBy=void 0,"string"==typeof e)for(var r in t)n[t[r][e]]=t[r];else{var s;for(var r in t){s="";for(var i in e)s+=t[r][e[i]];n[s]=t[r]}}t=[];for(r in n)t.push(n[r]);this._results=t},t.executeAggregateGroupBy=function(){var e=this._query.GroupBy,t=this._results,n={},r=this._query.Aggregate;this._query.Aggregate=void 0,this._results=void 0;var s,i,o,c,u=function(){for(var e in r)switch(e){case"Count":var u=function(){return o=(o=n[i])?o["Count("+c+")"]:0,o+=t[s][c]?1:0};if("string"==typeof r[e])c=r[e],t[s]["Count("+c+")"]=u();else if(Array.isArray(r[e]))for(var a in r[e])c=r[e][a],t[s]["Count("+c+")"]=u();break;case"Max":var h=function(){return o=(o=n[i])?o["Max("+c+")"]:0,t[s][c]=t[s][c]?t[s][c]:0,o>t[s][c]?o:t[s][c]};if("string"==typeof r[e])c=r[e],t[s]["Max("+c+")"]=h();else if(Array.isArray(r[e]))for(var a in r[e])c=r[e][a],t[s]["Max("+c+")"]=h();break;case"Min":var l=function(){return o=(o=n[i])?o["Min("+c+")"]:1/0,t[s][c]=t[s][c]?t[s][c]:1/0,o<t[s][c]?o:t[s][c]};if("string"==typeof r[e])c=r[e],t[s]["Min("+c+")"]=l();else if(Array.isArray(r[e]))for(var a in r[e])c=r[e][a],t[s]["Min("+c+")"]=l();break;case"Sum":var _=function(){return o=(o=n[i])?o["Sum("+c+")"]:0,o+=t[s][c]?t[s][c]:0};if("string"==typeof r[e])c=r[e],t[s]["Sum("+c+")"]=_();else if(Array.isArray(r[e]))for(var a in r[e])c=r[e][a],t[s]["Sum("+c+")"]=_();break;case"Avg":var d=function(){var e=(o=n[i])?o["Sum("+c+")"]:0;e+=t[s][c]?t[s][c]:0,t[s]["Sum("+c+")"]=e,o=o?o["Count("+c+")"]:0,o+=t[s][c]?1:0,t[s]["Count("+c+")"]=o};if("string"==typeof r[e])c=r[e],d();else if(Array.isArray(r[e]))for(var a in r[e])c=r[e][a],d()}};if("string"==typeof e)for(s in t)i=t[s][e],u(),n[i]=t[s];else for(s in t){i="";for(var a in e)i+=t[s][e[a]];u(),n[i]=t[s]}t=[];for(var h in n)t.push(n[h]);if(r.Avg)if("string"==typeof r.Avg)for(s in t){var l=t[s]["Sum("+r.Avg+")"],_=t[s]["Count("+r.Avg+")"];t[s]["Avg("+r.Avg+")"]=l/_,r.Count!==r.Avg&&delete t[s]["Count("+r.Avg+")"],r.Sum!==r.Avg&&delete t[s]["Sum("+r.Avg+")"]}else{var d=typeof r.Count,f=typeof r.Count;for(s in t)for(var a in r.Avg){var b=r.Avg[a],y=t[s]["Sum("+b+")"],g=t[s]["Count("+b+")"];t[s]["Avg("+b+")"]=y/g,d&&(r.Count!==b?delete t[s]["Count("+b+")"]:-1===r.Count.indexOf(b)&&delete t[s]["Count("+b+")"]),f&&(r.Sum!==b?delete t[s]["Sum("+b+")"]:-1===r.Sum.indexOf(b)&&delete t[s]["Sum("+b+")"])}}this._results=t},t}return t}(e.Where);e.GroupByHelper=t})((t=e.Business||(e.Business={})).Select||(t.Select={}));var t}(JsStore||(JsStore={}));!function(e){(function(e){var t=function(e){__extends(t,e);function t(){var t=e.call(this)||this;return t.processOrderBy=function(){var e=this._query.Order;if(e&&this._results.length>0&&!this._sorted&&e.By){e.Type=e.Type?e.Type.toLowerCase():"asc";var t=e.By,n=function(){this._results.sort(function(e,n){return e[t]-n[t]})}.bind(this),r=function(){this._results.sort(function(e,n){return n[t]-e[t]})}.bind(this),s=function(){this._results.sort(function(e,n){return e[t].toLowerCase().localeCompare(n[t].toLowerCase())})}.bind(this),i=function(){this._results.sort(function(e,n){return n[t].toLowerCase().localeCompare(e[t].toLowerCase())})}.bind(this);"string"==typeof this._results[0][t]?"asc"===e.Type?s():i():"number"==typeof this._results[0][t]&&("asc"===e.Type?n():r())}},t.processAggregateQry=function(){var e,t=this._results,n={};this._results=void 0;for(var r in this._query.Aggregate)switch(r){case"Count":var s=function(){var n=0;for(var r in t)n+=t[r][e]?1:0;return n};if("string"==typeof this._query.Aggregate[r])n["Count("+(e=this._query.Aggregate[r])+")"]=s();else if(Array.isArray(this._query.Aggregate[r]))for(var i in this._query.Aggregate[r])n["Count("+(e=this._query.Aggregate[r][i])+")"]=s();break;case"Max":var o=function(){var n=0;for(var r in t)n=n>t[r][e]?n:t[r][e];return n};if("string"==typeof this._query.Aggregate[r])n["Max("+(e=this._query.Aggregate[r])+")"]=o();else if(Array.isArray(this._query.Aggregate[r]))for(var i in this._query.Aggregate[r])n["Max("+(e=this._query.Aggregate[r][i])+")"]=o();break;case"Min":var c=function(){var n=1/0,r=1/0;for(var s in t)n=n<(r=t[s][e]?t[s][e]:1/0)?n:r;return n};if("string"==typeof this._query.Aggregate[r])n["Min("+(e=this._query.Aggregate[r])+")"]=c();else if(Array.isArray(this._query.Aggregate[r]))for(var i in this._query.Aggregate[r])n["Min("+(e=this._query.Aggregate[r][i])+")"]=c();break;case"Sum":var u=function(){var n=0;for(var r in t)n+=t[r][e];return n};if("string"==typeof this._query.Aggregate[r])n["Sum("+(e=this._query.Aggregate[r])+")"]=u();else if(Array.isArray(this._query.Aggregate[r]))for(var i in this._query.Aggregate[r])n["Sum("+(e=this._query.Aggregate[r][i])+")"]=u();break;case"Avg":var a=function(){var n=0;for(var r in t)n+=t[r][e];return n/t.length};if("string"==typeof this._query.Aggregate[r])n["Avg("+(e=this._query.Aggregate[r])+")"]=a();else if(Array.isArray(this._query.Aggregate[r]))for(var i in this._query.Aggregate[r])n["Avg("+(e=this._query.Aggregate[r][i])+")"]=a()}for(var r in n)t[0][r]=n[r];this._results=t},t}return t}(e.GroupByHelper);e.Helper=t})((t=e.Business||(e.Business={})).Select||(t.Select={}));var t}(JsStore||(JsStore={}));!function(e){(function(n){var r=function(n){__extends(r,n);function r(r,s,i){var o=n.call(this)||this;o.onTransactionCompleted=function(){if(this._sendResultFlag){if(this.processOrderBy(),this._query.Distinct){var e=[],t=this._results[0];for(var n in t)e.push(n);var r=this.getPrimaryKey(this._query.From),s=e.indexOf(r);e.splice(s,1),this._query.GroupBy=e.length>0?e:null}this._query.GroupBy?this._query.Aggregate?this.executeAggregateGroupBy():this.processGroupBy():this._query.Aggregate&&this.processAggregateQry(),this._onSuccess(this._results)}},o.createtransactionForOrLogic=function(e){this._query=e;try{this._transaction=t.db_connection.transaction([e.From],"readonly"),this._transaction.oncomplete=this.onTransactionCompleted.bind(this),this._transaction.ontimeout=this.onTransactionTimeout.bind(this),this._objectStore=this._transaction.objectStore(e.From),this.goToWhereLogic()}catch(t){this._errorOccured=!0,this.onExceptionOccured.call(this,t,{TableName:e.From})}},o.orQuerySuccess=function(){this._results=this.OrInfo._results,this.OrInfo._results=void 0,this.removeDuplicates(),this.OrInfo.OnSucess(this._results)},o.executeOrLogic=function(){this.OrInfo={OrQuery:this._query.Where.Or,OnSucess:this._onSuccess,_results:[]},this.TmpQry={From:this._query.From,Where:{}},this._query.Where.Or=void 0,this._onSuccess=function(){if(this.OrInfo._results=this.OrInfo._results.concat(this._results),!this._query.Limit||this._query.Limit>this.OrInfo._results.length){this._results=[];var t=e.getObjectFirstKey(this.OrInfo.OrQuery);null!=t?(this.TmpQry.Where[t]=this.OrInfo.OrQuery[t],delete this.OrInfo.OrQuery[t],this.createtransactionForOrLogic(this.TmpQry)):this.orQuerySuccess()}else this.orQuerySuccess()}},o._query=r,o._onSuccess=s,o._onError=i,o._skipRecord=o._query.Skip,o._limitRecord=o._query.Limit;try{o._transaction=t.db_connection.transaction([r.From],"readonly"),o._transaction.oncomplete=o.onTransactionCompleted.bind(o),o._transaction.ontimeout=o.onTransactionTimeout.bind(o),o._objectStore=o._transaction.objectStore(r.From),r.Where?(r.Where.Or&&o.executeOrLogic(),o.goToWhereLogic()):o.executeWhereUndefinedLogic()}catch(e){o._errorOccured=!0,o.onExceptionOccured.call(o,e,{TableName:r.From})}return o}return r}(n.Helper);n.Instance=r})((t=e.Business||(e.Business={})).Select||(t.Select={}));var t}(JsStore||(JsStore={}));!function(e){(function(e){var n=function(e){__extends(t,e);function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._resultCount=0,t._checkFlag=!1,t}return t}(t.Base);e.BaseCount=n})((t=e.Business||(e.Business={})).Count||(t.Count={}));var t}(JsStore||(JsStore={}));!function(e){(function(e){var t=function(e){__extends(t,e);function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.executeWhereUndefinedLogic=function(){if(this._objectStore.count){var e=this._objectStore.count();e.onsuccess=function(){this._resultCount=e.result}.bind(this),e.onerror=function(e){this._errorOccured=!0,this.onErrorOccured(e)}.bind(this)}else{var t,n=this._objectStore.openCursor();n.onsuccess=function(e){(t=e.target.result)&&(++this._resultCount,t.continue())}.bind(this),n.onerror=function(e){this._errorOccured=!0,this.onErrorOccured(e)}.bind(this)}},t}return t}(e.BaseCount);e.NotWhere=t})((t=e.Business||(e.Business={})).Count||(t.Count={}));var t}(JsStore||(JsStore={}));!function(e){(function(e){var t=function(e){__extends(t,e);function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.executeInLogic=function(e,t){var n,r,s=this._objectStore.index(e);if(this._checkFlag)for(var i=0,o=t.length;i<o;i++)this._errorOccured||((r=s.openCursor(IDBKeyRange.only(t[i]))).onsuccess=function(e){(n=e.target.result)&&(this.checkForWhereConditionMatch(n.value)&&++this._resultCount,n.continue())}.bind(this));else if(this._objectStore.count)for(i=0,o=t.length;i<o;i++)this._errorOccured||((r=s.count(IDBKeyRange.only(t[i]))).onsuccess=function(e){this._resultCount+=e.target.result}.bind(this));else for(i=0,o=t.length;i<o;i++)this._errorOccured||((r=s.openCursor(IDBKeyRange.only(t[i]))).onsuccess=function(e){(n=e.target.result)&&(++this._resultCount,n.continue())}.bind(this));r.onerror=function(e){this._errorOccured=!0,this.onErrorOccured(e)}.bind(this)},t}return t}(e.NotWhere);e.In=t})((t=e.Business||(e.Business={})).Count||(t.Count={}));var t}(JsStore||(JsStore={}));!function(e){(function(t){var n=function(t){__extends(n,t);function n(){var n=null!==t&&t.apply(this,arguments)||this;return n.executeLikeLogic=function(e,t,n){var r;this._compValue=t.toLowerCase(),this._compValueLength=this._compValue.length,this._compSymbol=n,this.CursorOpenRequest=this._objectStore.index(e).openCursor(),this.CursorOpenRequest.onerror=function(e){this._errorOccured=!0,this.onErrorOccured(e)}.bind(this),this._checkFlag?this.CursorOpenRequest.onsuccess=function(e){(r=e.target.result)&&(this.filterOnOccurence(r.key)&&this.checkForWhereConditionMatch(r.value)&&++this._resultCount,r.continue())}.bind(this):this.CursorOpenRequest.onsuccess=function(e){(r=e.target.result)&&(this.filterOnOccurence(r.key)&&++this._resultCount,r.continue())}.bind(this)},n.filterOnOccurence=function(t){var n=!1;switch(t=t.toLowerCase(),this._compSymbol){case e.Occurence.Any:t.indexOf(this._compValue)>=0&&(n=!0);break;case e.Occurence.First:0===t.indexOf(this._compValue)&&(n=!0);break;default:t.lastIndexOf(this._compValue)===t.length-this.CompValueLength&&(n=!0)}return n},n}return n}(t.In);t.Like=n})((t=e.Business||(e.Business={})).Count||(t.Count={}));var t}(JsStore||(JsStore={}));!function(e){(function(e){var t=function(e){__extends(t,e);function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.executeWhereLogic=function(e,t,n){t=n?t[n]:t;var r,s;this._checkFlag?(r=this._objectStore.index(e).openCursor(this.getKeyRange(t,n))).onsuccess=function(e){(s=e.target.result)&&(this.checkForWhereConditionMatch(s.value)&&++this._resultCount,s.continue())}.bind(this):this._objectStore.count?(r=this._objectStore.index(e).count(this.getKeyRange(t,n))).onsuccess=function(){this._resultCount=r.result}.bind(this):(r=this._objectStore.index(e).openCursor(this.getKeyRange(t,n))).onsuccess=function(e){(s=e.target.result)&&(++this._resultCount,s.continue())}.bind(this),r.onerror=function(e){this._errorOccured=!0,this.onErrorOccured(e)}.bind(this)},t}return t}(e.Like);e.Where=t})((t=e.Business||(e.Business={})).Count||(t.Count={}));var t}(JsStore||(JsStore={}));!function(e){(function(e){var n=function(e){__extends(n,e);function n(n,r,s){var i=e.call(this)||this;i.onTransactionCompleted=function(){this._sendResultFlag&&this._onSuccess(this._resultCount)},i._query=n,i._onSuccess=r,i._onError=s;try{var o=function(){this._transaction=t.db_connection.transaction([n.From],"readonly"),this._objectStore=this._transaction.objectStore(n.From),this._transaction.oncomplete=this.onTransactionCompleted.bind(this),this._transaction.ontimeout=this.onTransactionTimeout.bind(this)};void 0!==n.Where?n.Where.Or?new t.Select.Instance(n,function(e){this._resultCount=e.length,this.onTransactionCompleted()}.bind(i),i._onError):(o.call(i),i.goToWhereLogic()):(o.call(i),i.executeWhereUndefinedLogic())}catch(e){i.onExceptionOccured(e,{TableName:n.From})}return i}return n}(e.Where);e.Instance=n})((t=e.Business||(e.Business={})).Count||(t.Count={}));var t}(JsStore||(JsStore={}));!function(e){!function(e){(e.Update||(e.Update={})).updateValue=function(e,t){for(var n in e)if("object"!=typeof e[n])t[n]=e[n];else for(var r in e[n]){switch(r){case"+":t[n]+=e[n][r];break;case"-":t[n]-=e[n][r];break;case"*":t[n]*=e[n][r];break;case"/":t[n]/=e[n][r];break;default:t[n]=e[n]}break}return t};var t=function(e){__extends(t,e);function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._checkFlag=!1,t}return t}(e.Base);e.BaseUpdate=t}(e.Business||(e.Business={}))}(JsStore||(JsStore={}));!function(e){(function(e){var n=function(t){__extends(n,t);function n(){var n=null!==t&&t.apply(this,arguments)||this;return n.executeWhereUndefinedLogic=function(){var t,n=this._objectStore.openCursor();n.onsuccess=function(n){(t=n.target.result)&&(t.update(e.updateValue(this._query.Set,t.value)),++this._rowAffected,t.continue())}.bind(this),n.onerror=function(e){this._errorOccured=!0,this.onErrorOccured(e)}.bind(this)},n}return n}(t.BaseUpdate);e.NotWhere=n})((t=e.Business||(e.Business={})).Update||(t.Update={}));var t}(JsStore||(JsStore={}));!function(e){(function(e){var t=function(t){__extends(n,t);function n(){var n=null!==t&&t.apply(this,arguments)||this;return n.executeInLogic=function(t,n){var r,s,i=this._objectStore.index(t);if(this._checkFlag)for(var o=0,c=n.length;o<c;o++)this._errorOccured||((s=i.openCursor(IDBKeyRange.only(n[o]))).onsuccess=function(t){(r=t.target.result)&&(this.checkForWhereConditionMatch(r.value)&&(r.update(e.updateValue(this._query.Set,r.value)),++this._rowAffected),r.continue())}.bind(this));else for(o=0,c=n.length;o<c;o++)this._errorOccured||((s=i.openCursor(IDBKeyRange.only(n[o]))).onsuccess=function(t){(r=t.target.result)&&(r.update(e.updateValue(this._query.Set,r.value)),++this._rowAffected,r.continue())}.bind(this));s.onerror=function(e){this._errorOccured=!0,this.onErrorOccured(e)}.bind(this)},n}return n}(e.NotWhere);e.In=t})((t=e.Business||(e.Business={})).Update||(t.Update={}));var t}(JsStore||(JsStore={}));!function(e){(function(t){var n=function(n){__extends(r,n);function r(){var r=null!==n&&n.apply(this,arguments)||this;return r.executeLikeLogic=function(e,n,r){var s;this._compValue=n.toLowerCase(),this._compValueLength=this._compValue.length,this._compSymbol=r;var i=this._objectStore.index(e).openCursor();i.onerror=function(e){this._errorOccured=!0,this.onErrorOccured(e)}.bind(this),this._checkFlag?i.onsuccess=function(e){(s=e.target.result)&&(this.filterOnOccurence(s.key)&&this.checkForWhereConditionMatch(s.value)&&(s.update(t.updateValue(this._query.Set,s.value)),++this._rowAffected),s.continue())}.bind(this):i.onsuccess=function(e){(s=e.target.result)&&(this.filterOnOccurence(s.key)&&(s.update(t.updateValue(this._query.Set,s.value)),++this._rowAffected),s.continue())}.bind(this)},r.filterOnOccurence=function(t){var n=!1;switch(t=t.toLowerCase(),this._compSymbol){case e.Occurence.Any:t.indexOf(this._compValue)>=0&&(n=!0);break;case e.Occurence.First:0===t.indexOf(this._compValue)&&(n=!0);break;default:t.lastIndexOf(this._compValue)===t.length-this._compValueLength&&(n=!0)}return n},r}return r}(t.In);t.Like=n})((t=e.Business||(e.Business={})).Update||(t.Update={}));var t}(JsStore||(JsStore={}));!function(e){(function(e){var t=function(t){__extends(n,t);function n(){var n=null!==t&&t.apply(this,arguments)||this;return n.executeWhereLogic=function(t,n,r){var s,i;n=r?n[r]:n,i=this._objectStore.index(t).openCursor(this.getKeyRange(n,r)),this._checkFlag?i.onsuccess=function(t){(s=t.target.result)&&(this.checkForWhereConditionMatch(s.value)&&(s.update(e.updateValue(this._query.Set,s.value)),++this._rowAffected),s.continue())}.bind(this):i.onsuccess=function(t){(s=t.target.result)&&(s.update(e.updateValue(this._query.Set,s.value)),++this._rowAffected,s.continue())}.bind(this),i.onerror=function(e){this._errorOccured=!0,this.onErrorOccured(e)}.bind(this)},n}return n}(e.Like);e.Where=t})((t=e.Business||(e.Business={})).Update||(t.Update={}));var t}(JsStore||(JsStore={}));!function(e){(function(n){var r=function(n){__extends(r,n);function r(e,r,s){var i=n.call(this)||this;i.onTransactionCompleted=function(){this._onSuccess(this._rowAffected)},i.createtransactionForOrLogic=function(e){this._query=e;try{this._transaction=t.db_connection.transaction([e.In],"readwrite"),this._transaction.oncomplete=this.onTransactionCompleted.bind(this),this._transaction.ontimeout=this.onTransactionTimeout.bind(this),this._objectStore=this._transaction.objectStore(e.In),this.goToWhereLogic()}catch(t){this._errorOccured=!0,this.onExceptionOccured.call(this,t,{TableName:e.From})}},i.executeOrLogic=function(){new t.Select.Instance({From:this._query.In,Where:this._query.Where},function(e){var t=this.getPrimaryKey(this._query.In),n=[],r={};e.forEach(function(e){n.push(e[t])}),r[t]={In:n},this.createtransactionForOrLogic({In:this._query.In,Where:r,Set:this._query.Set})}.bind(this),this.OnError)};try{if(i._onSuccess=r,i._onError=s,i.checkSchema(e.Set,e.In),i._errorOccured)i.onErrorOccured(i._error,!0);else{i._query=e;var o=function(){this._transaction=t.db_connection.transaction([e.In],"readwrite"),this._objectStore=this._transaction.objectStore(e.In),this._transaction.oncomplete=this.onTransactionCompleted.bind(this),this._transaction.ontimeout=this.onTransactionTimeout}.bind(i);e.Where?e.Where.Or?i.executeOrLogic():(o(),i.goToWhereLogic()):(o(),i.executeWhereUndefinedLogic())}}catch(t){i._errorOccured=!0,i.onExceptionOccured.call(i,t,{TableName:e.In})}return i}return r.prototype.checkSchema=function(t,n){if("object"==typeof t){var r=this.getTable(n);if(r){var s=function(t,n){this._errorOccured=!0,this._error=new e.Error(t,n)}.bind(this);r._columns.every(function(n){return!this._errorOccured&&(n._name in t&&function(t){if(n._notNull&&e.isNull(t)&&s(e.Error_Type.NullValue,{ColumnName:n._name}),n._dataType){var r=typeof t;if(r!==n._dataType)if("object"!==r)s(e.Error_Type.BadDataType,{ColumnName:n._name});else{var i=["+","-","*","/"];for(var o in t){i.indexOf(o)<0&&s(e.Error_Type.BadDataType,{ColumnName:n._name});break}}}}(t[n._name]),!0)},this)}else this._error=new e.Error(e.Error_Type.TableNotExist,{TableName:n}).get(),this._errorOccured=!0}else this._error=new e.Error(e.Error_Type.NotObject).get(),this._errorOccured=!0},r}(n.Where);n.Instance=r})((t=e.Business||(e.Business={})).Update||(t.Update={}));var t}(JsStore||(JsStore={}));!function(e){(function(e){var n=function(e){__extends(t,e);function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._checkFlag=!1,t}return t}(t.Base);e.BaseDelete=n})((t=e.Business||(e.Business={})).Delete||(t.Delete={}));var t}(JsStore||(JsStore={}));!function(e){(function(e){var t=function(e){__extends(t,e);function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.executeWhereUndefinedLogic=function(){var e,t=this._objectStore.openCursor();t.onsuccess=function(t){(e=t.target.result)&&(e.delete(),++this._rowAffected,e.continue())}.bind(this),t.onerror=function(e){this._errorOccured=!0,this.onErrorOccured(e)}.bind(this)},t}return t}(e.BaseDelete);e.NotWhere=t})((t=e.Business||(e.Business={})).Delete||(t.Delete={}));var t}(JsStore||(JsStore={}));!function(e){(function(e){var t=function(e){__extends(t,e);function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.executeInLogic=function(e,t){var n,r;if(this._checkFlag)for(var s=0,i=t.length;s<i;s++)this._errorOccured||((r=this._objectStore.index(e).openCursor(IDBKeyRange.only(t[s]))).onsuccess=function(e){(n=e.target.result)&&(this.checkForWhereConditionMatch(n.value)&&(n.delete(),++this._rowAffected),n.continue())}.bind(this));else for(s=0,i=t.length;s<i;s++)this._errorOccured||((r=this._objectStore.index(e).openCursor(IDBKeyRange.only(t[s]))).onsuccess=function(e){(n=e.target.result)&&(n.delete(),++this._rowAffected,n.continue())}.bind(this));r.onerror=function(e){this._errorOccured=!0,this.onErrorOccured(e)}.bind(this)},t}return t}(e.NotWhere);e.In=t})((t=e.Business||(e.Business={})).Delete||(t.Delete={}));var t}(JsStore||(JsStore={}));!function(e){(function(t){var n=function(t){__extends(n,t);function n(){var n=null!==t&&t.apply(this,arguments)||this;return n.executeLikeLogic=function(e,t,n){var r;this._compValue=t.toLowerCase(),this._compValueLength=this._compValue.length,this._compSymbol=n,this.cursor_request=this._objectStore.index(e).openCursor(),this.cursor_request.onerror=function(e){this._errorOccured=!0,this.onErrorOccured(e)}.bind(this),this._checkFlag?this.cursor_request.onsuccess=function(e){(r=e.target.result)&&(this.filterOnOccurence(r.key)&&this.checkForWhereConditionMatch(r.value)&&(r.delete(),++this._rowAffected),r.continue())}.bind(this):this.cursor_request.onsuccess=function(e){(r=e.target.result)&&(this.filterOnOccurence(r.key)&&(r.delete(),++this._rowAffected),r.continue())}.bind(this)},n.filterOnOccurence=function(t){var n=!1;switch(t=t.toLowerCase(),this._compSymbol){case e.Occurence.Any:t.indexOf(this._compValue)>=0&&(n=!0);break;case e.Occurence.First:0===t.indexOf(this._compValue)&&(n=!0);break;default:t.lastIndexOf(this._compValue)===t.length-this._compValueLength&&(n=!0)}return n},n}return n}(t.In);t.Like=n})((t=e.Business||(e.Business={})).Delete||(t.Delete={}));var t}(JsStore||(JsStore={}));!function(e){(function(e){var t=function(e){__extends(t,e);function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.executeWhereLogic=function(e,t,n){var r,s;t=n?t[n]:t,s=this._objectStore.index(e).openCursor(this.getKeyRange(t,n)),this._checkFlag?s.onsuccess=function(e){(r=e.target.result)&&(this.checkForWhereConditionMatch(r.value)&&(r.delete(),++this._rowAffected),r.continue())}.bind(this):s.onsuccess=function(e){(r=e.target.result)&&(r.delete(),++this._rowAffected,r.continue())}.bind(this),s.onerror=function(e){this._errorOccured=!0,this.onErrorOccured(e)}.bind(this)},t}return t}(e.Like);e.Where=t})((t=e.Business||(e.Business={})).Delete||(t.Delete={}));var t}(JsStore||(JsStore={}));!function(e){(function(n){var r=function(n){__extends(r,n);function r(r,s,i){var o=n.call(this)||this;o.onTransactionCompleted=function(){this._onSuccess(this._rowAffected)},o.createtransactionForOrLogic=function(e){this._query=e;try{this._transaction=t.db_connection.transaction([e.From],"readwrite"),this._transaction.oncomplete=this.onTransactionCompleted.bind(this),this._transaction.ontimeout=this.onTransactionTimeout.bind(this),this._objectStore=this._transaction.objectStore(e.From),this.goToWhereLogic()}catch(t){this.onExceptionOccured(t,{TableName:e.From})}},o.executeOrLogic=function(){this.OrInfo={OrQuery:this._query.Where.Or,OnSucess:this._onSuccess},this.TmpQry={From:this._query.From,Where:{}},this._query.Where.Or=void 0,this._onSuccess=function(){var t=e.getObjectFirstKey(this.OrInfo.OrQuery);null!=t?(this.TmpQry.Where[t]=this.OrInfo.OrQuery[t],delete this.OrInfo.OrQuery[t],this.createtransactionForOrLogic(this.TmpQry)):this.OrInfo.OnSucess(this._rowAffected)}};try{o._query=r,o._onSuccess=s,o._onError=i,o._transaction=t.db_connection.transaction([r.From],"readwrite"),o._objectStore=o._transaction.objectStore(r.From),o._transaction.oncomplete=o.onTransactionCompleted.bind(o),o._transaction.onerror=o.onErrorOccured.bind(o),r.Where?(r.Where.Or&&o.executeOrLogic(),o.goToWhereLogic()):o.executeWhereUndefinedLogic()}catch(e){o.onExceptionOccured(e,{TableName:r.From})}return o}return r}(n.Where);n.Instance=r})((t=e.Business||(e.Business={})).Delete||(t.Delete={}));var t}(JsStore||(JsStore={}));!function(e){(function(n){var r=function(r){__extends(s,r);function s(s,i,o){var c=r.call(this)||this;c._valuesAffected=[],c.onTransactionCompleted=function(){this._onSuccess(this._query.Return?this._valuesAffected:this._rowAffected)},c.insertData=function(e){var n,r=0,s=this._query.Return;n=s?function(t){if(t){var s=i.add(t);s.onerror=this.onErrorOccured.bind(this),s.onsuccess=function(s){this.ValuesAffected.push(t),n(e[r++])}.bind(this)}}.bind(this):function(t){if(t){var s=i.add(t);s.onerror=this.onErrorOccured.bind(this),s.onsuccess=function(t){++this._rowAffected,n(e[r++])}.bind(this)}}.bind(this),this._transaction=t.db_connection.transaction([this._query.Into],"readwrite");var i=this._transaction.objectStore(this._query.Into);this._transaction.oncomplete=this.onTransactionCompleted.bind(this),n(e[r++])};try{c._query=s,c._onSuccess=i,c._onError=o;var u=c.getTable(s.Into);if(u){if(c._query.SkipDataCheck)c.insertData(c._query.Values);else{var a=new n.ValuesChecker(u,c._query.Values);a.checkAndModifyValues(function(e){e?this.onErrorOccured(a._error,!0):this.insertData(a._values),a=void 0}.bind(c))}c._query.Values=void 0}else new e.Error(e.Error_Type.TableNotExist,{TableName:s.Into}).throw()}catch(e){c.onExceptionOccured(e,{TableName:s.Into})}return c}return s}(t.Base);n.Instance=r})((t=e.Business||(e.Business={})).Insert||(t.Insert={}));var t}(JsStore||(JsStore={}));!function(e){(function(n){var r=function(n,r,s){this._errorOccured=!1,this.checkAndModifyValue=function(e){this._value=e,this._index=0,this.checkColumnValue()},this.checkColumnValue=function(){var e=this._table._columns[this._index++];e?this.checkAndModifyColumnValue(e,this._value):this.onFinish()},this.checkAndModifyColumnValue=function(n,r){if(!0===this._errorOccured)this.onError(this._error);else{var s=function(){n._notNull&&e.isNull(r[n._name])?this.onValidationError(e.Error_Type.NullValue,{ColumnName:n._name}):n._dataType&&typeof r[n._name]!==n._dataType?this.onValidationError(e.Error_Type.BadDataType,{ColumnName:n._name}):this.checkColumnValue()}.bind(this),i=function(){var e="JsStore_"+t.active_db._name+"_"+this._table._name+"_"+n._name+"_Value";KeyStore.get(e,function(t){r[n._name]=++t,KeyStore.set(e,t),s()})}.bind(this);n._autoIncrement?i():n._default&&e.isNull(r[n._name])?(r[n._name]=n._default,s()):s()}},this.onValidationError=function(t,n){this._errorOccured=!0,this._error=new e.Error(t,n).get(),this.onError(this._error)},this._table=n,this.onFinish=r,this.onError=s};n.ValueChecker=r})((t=e.Business||(e.Business={})).Insert||(t.Insert={}));var t}(JsStore||(JsStore={}));!function(e){(function(e){var t=function(t,n){this._index=0,this.checkAndModifyValues=function(e){this.onFinish=e,this.checkRowValue()},this.checkRowValue=function(){var t=this._values[this._index];if(t){var n=new e.ValueChecker(this._table,function(){this._values[this._index++]=n._value,this.checkRowValue()}.bind(this),function(e){this._error=e,this.onFinish(!0)}.bind(this));n.checkAndModifyValue(t)}else this.onFinish(!1)},this._table=t,this._values=n};e.ValuesChecker=t})((t=e.Business||(e.Business={})).Insert||(t.Insert={}));var t}(JsStore||(JsStore={}));!function(e){e.worker_status=e.WebWorker_Status.NotStarted;var t=function(){function t(){this._requestQueue=[],this._isCodeExecuting=!1,this.pushApi=function(e,t){return!0===t?new Promise(function(t,n){e.OnSuccess=function(e){t(e)},e.OnError=function(e){n(e)},this.prcoessExecutionOfCode(e)}.bind(this)):(this.prcoessExecutionOfCode(e),this)},this.createWorker=function(){try{if(Worker){var t=this.getScriptUrl();t&&t.length>0?(e.worker_instance=new Worker(t),e.worker_instance.onmessage=function(e){this.onMessageFromWorker(e)}.bind(this),this.executeCodeUsingWorker({Name:"change_log_status",Query:{logging:e.enable_log}}),setTimeout(function(){e.worker_status!==e.WebWorker_Status.Failed&&(e.worker_status=e.WebWorker_Status.Registered),e.status.ConStatus===e.Connection_Status.Connected&&this.executeCode()}.bind(this),100)):this.onWorkerFailed()}else this.onWorkerFailed()}catch(e){this.onWorkerFailed()}},this.prcoessExecutionOfCode=function(t){if(e.status.ConStatus===e.Connection_Status.NotStarted)switch(t.Name){case"create_db":case"open_db":this._requestQueue.splice(0,0,t),e.worker_status!==e.WebWorker_Status.NotStarted&&this.executeCode(),e.status.ConStatus=e.Connection_Status.Connected;break;default:this._requestQueue.push(t)}else this._requestQueue.push(t),1===this._requestQueue.length&&e.worker_status!==e.WebWorker_Status.NotStarted&&this.executeCode();e.log("request pushed: "+t.Name)},this.executeCode=function(){if(!this._isCodeExecuting&&this._requestQueue.length>0){this._isCodeExecuting=!0;var t=this._requestQueue[0],n={Name:t.Name,Query:t.Query};e.log("request executing : "+t.Name),e.worker_status===e.WebWorker_Status.Registered?this.executeCodeUsingWorker(n):this.executeCodeDirect(n)}},this.executeCodeDirect=function(t){new e.Business.Main(function(e){this.processFinishedRequest(e)}.bind(this)).checkConnectionAndExecuteLogic(t)},this.executeCodeUsingWorker=function(t){e.worker_instance.postMessage(t)},this.processFinishedRequest=function(t){var n=this._requestQueue.shift();this._isCodeExecuting=!1,n&&(e.log("request finished : "+n.Name),t.ErrorOccured?n.OnError&&n.OnError(t.ErrorDetails):n.OnSuccess&&n.OnSuccess(t.ReturnedValue),this.executeCode())},this.onWorkerFailed=function(){console.warn("JsStore is not runing in web worker"),e.worker_status=e.WebWorker_Status.Failed,e.status.ConStatus===e.Connection_Status.NotStarted&&this.executeCode()},this.onMessageFromWorker=function(e){if("string"==typeof e.data){switch(e.data.split(":")[1]){case"WorkerFailed":this.onWorkerFailed()}}else this.processFinishedRequest(e.data)}}return t.prototype.getScriptUrl=function(e){for(var t="",n=e?e.toLowerCase():"jsstore",r=document.getElementsByTagName("script"),s=r.length-1,i="";s>=0;s--)if((i=(i=r[s].src).substring(i.lastIndexOf("/")+1).toLowerCase()).length>0&&i.indexOf(n)>=0)return t=r[s].src;return t},t}();e.CodeExecutionHelper=t}(JsStore||(JsStore={}));var JsStore,Model=JsStore.Model,DataBase=Model.DataBase,Column=Model.Column,Table=Model.Table;!function(e){var t=function(t){__extends(n,t);function n(n){void 0===n&&(n=null);var r=t.call(this)||this;return r.openDb=function(e,t,n){return this.pushApi({Name:"open_db",Query:e,OnSuccess:t,OnError:n},!1)},r.createDb=function(e,t,n){return this.pushApi({Name:"create_db",OnSuccess:t,OnError:n,Query:e},!1)},r.dropDb=function(e,t){var n=!e;return this.pushApi({Name:"drop_db",Query:null,OnSuccess:e,OnError:t},n)},r.select=function(e,t,n){t=e.OnSuccess?e.OnSuccess:t,n=e.OnError?e.OnError:n,e.OnSuccess=e.OnError=null;var r=!t;return this.pushApi({Name:"select",Query:e,OnSuccess:t,OnError:n},r)},r.count=function(e,t,n){t=e.OnSuccess?e.OnSuccess:t,n=e.OnError?e.OnError:n,e.OnSuccess=e.OnError=null;var r=!t;return this.pushApi({Name:"count",Query:e,OnSuccess:t,OnError:n},r)},r.insert=function(e,t,n){t=e.OnSuccess?e.OnSuccess:t,n=e.OnError?e.OnError:n,e.OnSuccess=e.OnError=null;var r=!t;return this.pushApi({Name:"insert",Query:e,OnSuccess:t,OnError:n},r)},r.update=function(e,t,n){t=e.OnSuccess?e.OnSuccess:t,n=e.OnError?e.OnError:n,e.OnSuccess=e.OnError=null;var r=!t;return this.pushApi({Name:"update",Query:e,OnSuccess:t,OnError:n},r)},r.delete=function(e,t,n){t=e.OnSuccess?e.OnSuccess:t,n=e.OnError?e.OnError:n,e.OnSuccess=e.OnError=null;var r=!t;return this.pushApi({Name:"delete",Query:e,OnSuccess:t,OnError:n},r)},r.clear=function(e,t,n){var r=!t;return this.pushApi({Name:"clear",Query:e,OnSuccess:t,OnError:n},r)},r.bulkInsert=function(e,t,n){t=e.OnSuccess?e.OnSuccess:t,n=e.OnError?e.OnError:n;var r=!t;return e.OnSuccess=e.OnError=null,this.pushApi({Name:"bulk_insert",Query:e,OnSuccess:t,OnError:n},r)},r.exportJson=function(e){var t=function(t){var n=document.createElement("a");n.href=t,n.download=e.From+".json",n.click(),r&&r(null)},n=e.OnError,r=e.OnSuccess;e.OnSuccess=e.OnError=void 0;var s=!r;if(s)return new Promise(function(r,i){this.pushApi({Name:"export_json",Query:e,OnSuccess:t,OnError:n},s).then(function(e){t(e),r()}).catch(function(e){i(e)})});this.pushApi({Name:"export_json",Query:e,OnSuccess:t,OnError:n},s)},e.worker_status===e.WebWorker_Status.Registered?e.worker_instance.terminate():e.worker_status===e.WebWorker_Status.NotStarted&&KeyStore.init(),r.createWorker(),n&&r.openDb(n,null,null),r}return n}(e.CodeExecutionHelper);e.Instance=t}(JsStore||(JsStore={})),self&&!self.alert&&(self.onmessage=function(e){JsStore.log("Request executing from WebWorker, request name: "+e.data.Name);var t=e.data;(new JsStore.Business.Main).checkConnectionAndExecuteLogic(t)},JsStore.worker_status=JsStore.WebWorker_Status.Registered,KeyStore.init());