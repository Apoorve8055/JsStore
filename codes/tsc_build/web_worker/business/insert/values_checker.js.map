{"version":3,"file":"values_checker.js","sourceRoot":"","sources":["../../../../web_worker/business/insert/values_checker.ts"],"names":[],"mappings":"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","sourcesContent":["import { Table } from \"../../model/table\";\r\nimport { IError } from \"../../interfaces\";\r\nimport { ValueChecker } from \"./value_checker\";\r\nimport { IdbHelper } from \"../../index\";\r\nimport * as KeyStore from \"../../keystore/index\";\r\n\r\nexport class ValuesChecker {\r\n    _table: Table;\r\n    _values: any[];\r\n    _error: IError;\r\n    _onFinish: (isError: boolean) => void;\r\n    _valueCheckerObj: ValueChecker;\r\n\r\n    constructor(table: Table, values: any[]) {\r\n        this._table = table;\r\n        this._values = values;\r\n    }\r\n\r\n    public checkAndModifyValues(onFinish: (isError: boolean) => void) {\r\n        this._onFinish = onFinish;\r\n        var auto_inc_columns = this._table._columns.filter((col) => {\r\n            return col._autoIncrement;\r\n        });\r\n        var auto_inc_values = {};\r\n        auto_inc_columns.forEach((column) => {\r\n            var auto_increment_key = `JsStore_${IdbHelper._activeDb._name}_${this._table._name}_${column._name}_Value`;\r\n            KeyStore.get(auto_increment_key, (val) => {\r\n                auto_inc_values[column._name] = val;\r\n            });\r\n        });\r\n        KeyStore.get('dumy_key', (val) => {\r\n            this._valueCheckerObj = new ValueChecker(this._table, auto_inc_values);\r\n            this.startChecking();\r\n        }, (err) => {\r\n            this._error = err as any;\r\n            this._onFinish(true);\r\n        });\r\n\r\n    }\r\n\r\n    private startChecking() {\r\n        var is_error: boolean = false;\r\n        this._values.every(function (item) {\r\n            is_error = this._valueCheckerObj.checkAndModifyValue(item);\r\n            return !is_error;\r\n        }, this);\r\n        if (is_error) {\r\n            this._error = this._valueCheckerObj._error;\r\n            this._onFinish(true);\r\n        }\r\n        else {\r\n            for (var prop in this._valueCheckerObj._autoIncrementValue) {\r\n                var auto_increment_key = `JsStore_${IdbHelper._activeDb._name}_${this._table._name}_${prop}_Value`;\r\n                KeyStore.set(auto_increment_key, this._valueCheckerObj._autoIncrementValue[prop]);\r\n            }\r\n            KeyStore.get('dumy_key', (val) => {\r\n                this._onFinish(false);\r\n            },\r\n                (err) => {\r\n                    this._error = err as any;\r\n                    this._onFinish(true);\r\n                });\r\n        }\r\n    }\r\n}"]}